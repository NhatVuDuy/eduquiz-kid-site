{"version":3,"file":"LessonSelectScreen-B0pF4EGU.js","sources":["../../src/screens/LessonSelectScreen.jsx"],"sourcesContent":["import React, { useState, useEffect } from 'react';\nimport { useFlowStore } from '../store/flowStore';\nimport { useQuizStore } from '../store/quizStore';\nimport { soundService } from '../services/soundService';\nimport { loadAllQuestions, loadQuestionsForSubject } from '../services/googleSheetService';\n// Fallback imports\nimport mathQuestionsFallback from '../data/questions-math-grade3.json';\nimport vietnameseQuestionsFallback from '../data/questions-vietnamese-grade3.json';\nimport englishQuestionsFallback from '../data/questions-english-mover.json';\nimport { shuffleArray } from '../utils';\nimport { ScreenContainer, Header, SubjectCard, BackButton } from '../components/screen';\n\n/**\n * LessonSelectScreen Component\n * M√†n h√¨nh ch·ªçn m√¥n h·ªçc\n * Refactored to use theme and screen components\n * Now loads questions from Google Sheets\n */\nexport const LessonSelectScreen = () => {\n  const { goToNext } = useFlowStore();\n  const { setCurrentLesson } = useQuizStore();\n  const [questions, setQuestions] = useState({\n    math: [],\n    vietnamese: [],\n    english: [],\n  });\n  const [loading, setLoading] = useState(true);\n  const [error, setError] = useState(null);\n  \n  // Load questions khi component mount\n  useEffect(() => {\n    loadQuestions();\n  }, []);\n\n  const loadQuestions = async () => {\n    try {\n      setLoading(true);\n      setError(null);\n      \n      // Load t·ª´ Google Sheets ho·∫∑c fallback\n      const loadedQuestions = await loadAllQuestions();\n      \n      // N·∫øu kh√¥ng load ƒë∆∞·ª£c t·ª´ Google Sheets, d√πng fallback\n      if (!loadedQuestions.math || loadedQuestions.math.length === 0) {\n        console.warn('Using fallback JSON data');\n        setQuestions({\n          math: mathQuestionsFallback,\n          vietnamese: vietnameseQuestionsFallback,\n          english: englishQuestionsFallback,\n        });\n      } else {\n        setQuestions(loadedQuestions);\n      }\n    } catch (err) {\n      console.error('Error loading questions:', err);\n      setError(err.message);\n      // Fallback v·ªÅ JSON local\n      setQuestions({\n        math: mathQuestionsFallback,\n        vietnamese: vietnameseQuestionsFallback,\n        english: englishQuestionsFallback,\n      });\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const subjects = [\n    { id: 'math', name: 'To√°n', description: 'To√°n l·ªõp 3', icon: 'üî¢' },\n    { id: 'vietnamese', name: 'Ti·∫øng Vi·ªát', description: 'Ti·∫øng Vi·ªát l·ªõp 3', icon: 'üìù' },\n    { id: 'english', name: 'Ti·∫øng Anh', description: 'Ti·∫øng Anh Mover', icon: 'üá¨üáß' },\n    { id: 'mixed', name: 'T·ªïng h·ª£p', description: 'T·∫•t c·∫£ c√°c m√¥n', icon: 'üéØ' },\n  ];\n\n  const handleSelectSubject = async (subject) => {\n    soundService.playClick();\n    \n    try {\n      let subjectQuestions;\n      \n      if (subject.id === 'mixed') {\n        // Tr·ªôn t·∫•t c·∫£ c√¢u h·ªèi t·ª´ 3 m√¥n\n        const allQuestions = [\n          ...questions.math,\n          ...questions.vietnamese,\n          ...questions.english,\n        ];\n        subjectQuestions = shuffleArray(allQuestions);\n      } else {\n        // Load l·∫°i t·ª´ Google Sheet n·∫øu c·∫ßn (ho·∫∑c d√πng cached)\n        if (questions[subject.id] && questions[subject.id].length > 0) {\n          subjectQuestions = questions[subject.id];\n        } else {\n          // Try to load on demand\n          subjectQuestions = await loadQuestionsForSubject(subject.id);\n          if (subjectQuestions.length === 0) {\n            // Use fallback\n            const fallbacks = {\n              math: mathQuestionsFallback,\n              vietnamese: vietnameseQuestionsFallback,\n              english: englishQuestionsFallback,\n            };\n            subjectQuestions = fallbacks[subject.id] || [];\n          }\n        }\n      }\n      \n      if (subjectQuestions.length === 0) {\n        alert('Kh√¥ng c√≥ c√¢u h·ªèi n√†o cho m√¥n n√†y!');\n        return;\n      }\n      \n      setCurrentLesson({\n        id: subject.id,\n        name: subject.name,\n        description: subject.description,\n        icon: subject.icon,\n        questions: subjectQuestions,\n      });\n      \n      goToNext('questionCount');\n    } catch (error) {\n      console.error('Error loading subject:', error);\n      alert('C√≥ l·ªói khi t·∫£i c√¢u h·ªèi. Vui l√≤ng th·ª≠ l·∫°i!');\n    }\n  };\n\n  if (loading) {\n    return (\n      <ScreenContainer className=\"flex items-center justify-center\">\n        <div className=\"text-center\">\n          <div className=\"text-6xl mb-4 animate-spin\">‚è≥</div>\n          <p className=\"text-xl text-gray-600\">ƒêang t·∫£i c√¢u h·ªèi...</p>\n        </div>\n      </ScreenContainer>\n    );\n  }\n\n  return (\n    <ScreenContainer>\n      <BackButton\n        inline\n        variant=\"ghost\"\n        label=\"‚Üê Quay l·∫°i\"\n        onClick={() => goToNext('home')}\n        className=\"mb-2\"\n      />\n      <Header\n        title=\"Ch·ªçn m√¥n h·ªçc\"\n        titleClassName=\"text-4xl\"\n      />\n\n      {error && (\n        <div className=\"mb-4 p-4 bg-yellow-50 border border-yellow-200 rounded-xl text-yellow-800 text-sm\">\n          ‚ö†Ô∏è {error} - ƒêang s·ª≠ d·ª•ng d·ªØ li·ªáu local\n        </div>\n      )}\n\n      <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n        {subjects.map((subject, index) => {\n          const questionCount = subject.id === 'mixed'\n            ? questions.math.length + questions.vietnamese.length + questions.english.length\n            : questions[subject.id]?.length || 0;\n          \n          return (\n            <SubjectCard\n              key={subject.id}\n              icon={subject.icon}\n              title={subject.name}\n              description={`${subject.description} (${questionCount} c√¢u h·ªèi)`}\n              onClick={() => handleSelectSubject(subject)}\n              delay={index * 0.1}\n            />\n          );\n        })}\n      </div>\n\n      <BackButton onClick={() => goToNext('home')} />\n    </ScreenContainer>\n  );\n};\n\n"],"names":["LessonSelectScreen","goToNext","useFlowStore","setCurrentLesson","useQuizStore","questions","setQuestions","useState","loading","setLoading","error","setError","useEffect","loadQuestions","loadedQuestions","loadAllQuestions","mathQuestionsFallback","vietnameseQuestionsFallback","englishQuestionsFallback","err","subjects","handleSelectSubject","subject","soundService","subjectQuestions","allQuestions","shuffleArray","loadQuestionsForSubject","ScreenContainer","jsxs","jsx","BackButton","Header","index","questionCount","SubjectCard"],"mappings":"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"}