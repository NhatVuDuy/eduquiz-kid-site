{"version":3,"file":"SubjectSelectScreen-Chn3aMFv.js","sources":["../../src/screens/SubjectSelectScreen.jsx"],"sourcesContent":["import React, { useEffect, useState } from 'react';\nimport { useFlowStore } from '../store/flowStore';\nimport { useLevelStore } from '../store/levelStore';\nimport { loadSubjectsForLevel } from '../services/levelService.js';\nimport { getSubjectStatsMap } from '../services/quizStatsService.js';\nimport { soundService } from '../services/soundService';\nimport { formatCompactNumber, formatRatingValue } from '../utils/numberFormat.js';\nimport { ScreenContainer, Header, SubjectCard, BackButton } from '../components/screen';\n\n/**\n * SubjectSelectScreen Component\n * Màn hình chọn môn học trong cấp độ đã chọn\n */\nexport const SubjectSelectScreen = () => {\n  const { goToNext } = useFlowStore();\n  const { currentLevel, setCurrentSubject } = useLevelStore();\n  const [subjects, setSubjects] = useState([]);\n  const [loading, setLoading] = useState(true);\n  const [subjectStats, setSubjectStats] = useState({});\n  const [statsLoading, setStatsLoading] = useState(true);\n\n  useEffect(() => {\n    if (currentLevel) {\n      loadSubjectsData();\n      loadSubjectsStats(currentLevel.id);\n    }\n  }, [currentLevel]);\n\n  const loadSubjectsData = async () => {\n    try {\n      setLoading(true);\n      const loadedSubjects = await loadSubjectsForLevel(currentLevel.id);\n      setSubjects(loadedSubjects);\n    } catch (error) {\n      console.error('Error loading subjects:', error);\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const loadSubjectsStats = async (levelId) => {\n    try {\n      setStatsLoading(true);\n      const stats = await getSubjectStatsMap(levelId);\n      setSubjectStats(stats || {});\n    } catch (error) {\n      console.error('Error loading subject stats:', error);\n    } finally {\n      setStatsLoading(false);\n    }\n  };\n\n  const handleSelectSubject = (subject) => {\n    soundService.playClick();\n    setCurrentSubject(subject);\n    goToNext('quizTypeSelect');\n  };\n\n  if (!currentLevel) {\n    return (\n      <ScreenContainer className=\"flex items-center justify-center\">\n        <div className=\"text-center\">\n          <p className=\"text-xl text-gray-600 mb-4\">Chưa chọn cấp độ!</p>\n          <BackButton onClick={() => goToNext('levelSelect')} />\n        </div>\n      </ScreenContainer>\n    );\n  }\n\n  if (loading) {\n    return (\n      <ScreenContainer className=\"flex items-center justify-center\">\n        <div className=\"text-center\">\n          <div className=\"text-6xl mb-4 animate-spin\">⏳</div>\n          <p className=\"text-xl text-gray-600\">Đang tải môn học...</p>\n        </div>\n      </ScreenContainer>\n    );\n  }\n\n  return (\n    <ScreenContainer>\n      <BackButton\n        inline\n        variant=\"ghost\"\n        label=\"← Quay lại\"\n        onClick={() => goToNext('levelSelect')}\n        className=\"mb-2\"\n      />\n      <Header\n        title=\"Chọn môn học\"\n        subtitle={`Cấp độ: ${currentLevel.name}`}\n        titleClassName=\"text-4xl\"\n      />\n\n      <div className=\"grid grid-cols-2 md:grid-cols-3 gap-4\">\n        {subjects.map((subject, index) => {\n          const stats = subjectStats[subject.id] || {};\n          const statItems = [\n            { label: 'Bài test', value: statsLoading ? '…' : formatCompactNumber(stats.quizCount) },\n            { label: 'Lượt làm', value: statsLoading ? '…' : formatCompactNumber(stats.totalUsage) },\n            { label: 'Người học', value: statsLoading ? '…' : formatCompactNumber(stats.playerCount) },\n            { label: 'Đánh giá', value: statsLoading ? '…' : formatRatingValue(stats.averageRating) },\n          ];\n\n          return (\n            <SubjectCard\n              key={subject.id}\n              icon={subject.icon}\n              title={subject.name}\n              description={subject.description || ''}\n              onClick={() => handleSelectSubject(subject)}\n              delay={index * 0.1}\n              stats={statItems}\n            />\n          );\n        })}\n      </div>\n\n      {/* Nút Back ở footer */}\n      <div className=\"mt-8 text-center\">\n        <BackButton\n          onClick={() => goToNext('levelSelect')}\n          label=\"← Quay lại\"\n        />\n      </div>\n    </ScreenContainer>\n  );\n};\n"],"names":["SubjectSelectScreen","goToNext","useFlowStore","currentLevel","setCurrentSubject","useLevelStore","subjects","setSubjects","useState","loading","setLoading","subjectStats","setSubjectStats","statsLoading","setStatsLoading","useEffect","loadSubjectsData","loadSubjectsStats","loadedSubjects","loadSubjectsForLevel","error","levelId","stats","getSubjectStatsMap","handleSelectSubject","subject","soundService","ScreenContainer","jsxs","jsx","BackButton","Header","index","statItems","formatCompactNumber","formatRatingValue","SubjectCard"],"mappings":"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"}