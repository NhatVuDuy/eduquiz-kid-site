{"version":3,"file":"googleSheetService-mjZez5jn.js","sources":["../../src/config/sheets.config.js","../../src/services/googleSheetService.js"],"sourcesContent":["/**\n * Google Sheets Configuration\n * Cấu hình các Google Sheets URLs cho từng môn học\n * \n * Cách lấy URL:\n * 1. Mở Google Sheet\n * 2. File > Share > Publish to web > Chọn \"Comma-separated values (.csv)\"\n * 3. Copy link và paste vào đây\n * \n * Hoặc sử dụng format:\n * https://docs.google.com/spreadsheets/d/{SHEET_ID}/export?format=csv&gid={GID}\n */\n\nexport const sheetsConfig = {\n  math: {\n    // URL Google Sheet cho Toán\n    // Thay bằng URL thực tế của bạn\n    url: import.meta.env.VITE_SHEET_MATH_URL || '',\n    // Hoặc dùng Sheet ID và GID\n    sheetId: import.meta.env.VITE_SHEET_MATH_ID || '',\n    gid: import.meta.env.VITE_SHEET_MATH_GID || '0',\n    // Fallback về JSON local nếu không có URL\n    fallback: '/src/data/questions-math-grade3.json',\n  },\n  vietnamese: {\n    url: import.meta.env.VITE_SHEET_VIETNAMESE_URL || '',\n    sheetId: import.meta.env.VITE_SHEET_VIETNAMESE_ID || '',\n    gid: import.meta.env.VITE_SHEET_VIETNAMESE_GID || '0',\n    fallback: '/src/data/questions-vietnamese-grade3.json',\n  },\n  english: {\n    url: import.meta.env.VITE_SHEET_ENGLISH_URL || '',\n    sheetId: import.meta.env.VITE_SHEET_ENGLISH_ID || '',\n    gid: import.meta.env.VITE_SHEET_ENGLISH_GID || '0',\n    fallback: '/src/data/questions-english-mover.json',\n  },\n};\n\n/**\n * Helper function để build Google Sheets CSV URL từ Sheet ID và GID\n */\nexport const buildSheetUrl = (sheetId, gid = '0') => {\n  if (!sheetId) return null;\n  return `https://docs.google.com/spreadsheets/d/${sheetId}/export?format=csv&gid=${gid}`;\n};\n\n/**\n * Helper function để build Google Sheets published CSV URL\n * (Nếu sheet đã được publish to web)\n */\nexport const buildPublishedSheetUrl = (sheetId, sheetName = 'Sheet1') => {\n  if (!sheetId) return null;\n  return `https://docs.google.com/spreadsheets/d/${sheetId}/gviz/tq?tqx=out:csv&sheet=${encodeURIComponent(sheetName)}`;\n};\n\n","/**\n * Google Sheet Service\n * Service để load câu hỏi từ Google Spreadsheet\n * Hỗ trợ cả CSV export và JSON format\n */\n\nimport { sheetsConfig, buildSheetUrl, buildPublishedSheetUrl } from '../config/sheets.config.js';\n\nconst STANDARD_COLUMNS = new Set([\n  'id',\n  'question',\n  'type',\n  'choices',\n  'answer',\n  'hint',\n  'points',\n  'explanation',\n  'explain',\n  'image_url',\n  'image',\n  'imageurl',\n  'level',\n  'level_id',\n  'subject',\n  'subject_id',\n  'quiz_type',\n  'group',\n  'tags',\n  'difficulty',\n  'estimated_time',\n  'time',\n  'creator',\n  'creator_id',\n  'creator_name',\n  'source',\n  'source_url',\n  'description',\n  'title',\n]);\n\nconst normalizeKey = (key = '') => key.trim().toLowerCase();\n\nconst collectChoiceValuesFromRow = (row) => {\n  const dynamicChoices = [];\n\n  Object.keys(row).forEach((originalKey) => {\n    const value = row[originalKey];\n    if (!value || !value.trim()) return;\n\n    const key = normalizeKey(originalKey);\n    if (key.startsWith('choice') || key.startsWith('option')) {\n      dynamicChoices.push(value.trim());\n      return;\n    }\n\n    if (!STANDARD_COLUMNS.has(key)) {\n      dynamicChoices.push(value.trim());\n    }\n  });\n\n  return dynamicChoices;\n};\n\n/**\n * Parse CSV string thành array of objects\n * @param {string} csvText - CSV text content\n * @param {boolean} hasHeader - Có header row không\n * @returns {Array<Object>} Array of objects\n */\nconst parseCSV = (csvText, hasHeader = true) => {\n  // Normalize line endings\n  const normalizedText = csvText.replace(/\\r\\n/g, '\\n').replace(/\\r/g, '\\n');\n  const lines = normalizedText.split('\\n').filter(line => line.trim());\n  \n  if (lines.length === 0) {\n    console.warn('CSV is empty');\n    return [];\n  }\n\n  // Parse header\n  const headers = hasHeader \n    ? parseCSVLine(lines[0]).map(h => h.trim().replace(/^\"|\"$/g, '').toLowerCase())\n    : null;\n\n  console.log('CSV Headers:', headers);\n\n  // Parse data rows\n  const data = [];\n  const startIndex = hasHeader ? 1 : 0;\n\n  for (let i = startIndex; i < lines.length; i++) {\n    const values = parseCSVLine(lines[i]);\n    if (values.length === 0 || values.every(v => !v || !v.trim())) {\n      continue; // Skip empty rows\n    }\n\n    if (hasHeader && headers) {\n      const obj = {};\n      headers.forEach((header, index) => {\n        obj[header] = (values[index] || '').trim();\n      });\n      data.push(obj);\n    } else {\n      data.push(values);\n    }\n  }\n\n  return data;\n};\n\n/**\n * Parse một dòng CSV, xử lý quotes và commas trong giá trị\n */\nconst parseCSVLine = (line) => {\n  const values = [];\n  let current = '';\n  let inQuotes = false;\n\n  for (let i = 0; i < line.length; i++) {\n    const char = line[i];\n    \n    if (char === '\"') {\n      if (inQuotes && line[i + 1] === '\"') {\n        // Escaped quote\n        current += '\"';\n        i++;\n      } else {\n        // Toggle quote state\n        inQuotes = !inQuotes;\n      }\n    } else if (char === ',' && !inQuotes) {\n      // End of value\n      values.push(current.trim());\n      current = '';\n    } else {\n      current += char;\n    }\n  }\n  \n  // Add last value\n  values.push(current.trim());\n  \n  return values;\n};\n\n/**\n * Convert Google Sheet row data thành question object\n * Expected columns: id, question, type, choices (comma-separated), answer, hint, points\n */\nconst convertRowToQuestion = (row, index) => {\n  // Nếu row là object (từ CSV với header)\n  if (typeof row === 'object' && !Array.isArray(row)) {\n    // Handle case-insensitive header keys\n    const getValue = (key) => {\n      const lowerKey = normalizeKey(key);\n      return row[lowerKey] || row[key] || '';\n    };\n\n    const id = getValue('id') || `q${index + 1}`;\n    const question = getValue('question') || '';\n    const type = (getValue('type') || 'choice').toLowerCase();\n    const answer = getValue('answer') || '';\n    const hint = getValue('hint') || '';\n    const points = parseInt(getValue('points')) || 10;\n    const explanation = getValue('explanation') || getValue('explain') || '';\n    const rawImageUrl = getValue('image_url') || getValue('image') || getValue('imageurl') || '';\n    const trimmedImageUrl = rawImageUrl.trim();\n    // Bỏ qua placeholder hoặc giá trị trống\n    // Giữ nguyên URL gốc - sẽ convert động khi hiển thị\n    const imageUrl =\n      !trimmedImageUrl ||\n      trimmedImageUrl === '[URL]' ||\n      trimmedImageUrl.toLowerCase() === 'url'\n        ? ''\n        : trimmedImageUrl;\n\n    // Parse choices - handle both quoted and unquoted formats\n    let choices = collectChoiceValuesFromRow(row);\n\n    if (choices.length === 0) {\n      const choicesStr = getValue('choices') || '';\n      if (choicesStr && choicesStr.trim()) {\n        const cleaned = choicesStr.replace(/^\"|\"$/g, '');\n        choices = cleaned.split(',').map(c => c.trim()).filter(c => c);\n      }\n    }\n\n    // Validate required fields\n    if (!question || !question.trim()) {\n      console.warn(`Row ${index + 1}: Missing question`, row);\n      return null;\n    }\n\n    if (type === 'choice' && choices.length === 0) {\n      console.warn(`Row ${index + 1}: Choice question without choices`, row);\n    }\n\n    if (!answer || !answer.trim()) {\n      console.warn(`Row ${index + 1}: Missing answer`, row);\n    }\n\n    return {\n      id,\n      question: question.trim(),\n      type,\n      choices: choices.length > 0 ? choices : undefined,\n      answer: answer.trim(),\n      hint: hint.trim(),\n      points,\n      explanation: explanation.trim() || undefined,\n      imageUrl: imageUrl || undefined,\n    };\n  }\n  \n  // Nếu row là array (từ CSV không có header)\n  // Format (mới): [id, question, type, answer, hint, points, explanation, image_url, choice1, choice2, ...]\n  // Format (cũ): [id, question, type, choices, answer, hint, points]\n  if (Array.isArray(row)) {\n    const id = row[0] || `q${index + 1}`;\n    const question = row[1] || '';\n    const type = (row[2] || 'choice').toLowerCase();\n\n    const looksLikeOldFormat = row[3] && row[3].includes(',');\n\n    if (looksLikeOldFormat) {\n      const legacyChoices = row[3]\n        ? row[3].split(',').map(c => c.trim()).filter(c => c)\n        : [];\n\n      return {\n        id,\n        question,\n        type,\n        choices: legacyChoices.length > 0 ? legacyChoices : undefined,\n        answer: row[4] || '',\n        hint: row[5] || '',\n        points: parseInt(row[6]) || 10,\n        explanation: row[7] || undefined,\n        imageUrl: row[8] || undefined,\n      };\n    }\n\n    const answer = row[3] || '';\n    const hint = row[4] || '';\n    const points = parseInt(row[5]) || 10;\n    const explanation = row[6] || '';\n    const imageUrl = row[7] || '';\n    const tailChoices = row.slice(8).map(choice => (choice || '').trim()).filter(Boolean);\n\n    return {\n      id,\n      question,\n      type,\n      choices: tailChoices.length > 0 ? tailChoices : undefined,\n      answer,\n      hint,\n      points,\n      explanation: explanation.trim() || undefined,\n      imageUrl: imageUrl.trim() || undefined,\n    };\n  }\n  \n  return null;\n};\n\n/**\n * Convert Google Sheet edit URL sang CSV export URL\n * @param {string} url - Google Sheet URL (có thể là edit hoặc export URL)\n * @returns {string} CSV export URL\n */\nconst convertToCSVExportUrl = (url) => {\n  if (!url) return url;\n  \n  // Nếu đã là export URL thì giữ nguyên\n  if (url.includes('/export?format=csv') || url.includes('/gviz/tq?tqx=out:csv')) {\n    return url;\n  }\n  \n  // Extract sheet ID và gid từ URL\n  // Pattern: https://docs.google.com/spreadsheets/d/{SHEET_ID}/edit#gid={GID}\n  // Hoặc: https://docs.google.com/spreadsheets/d/{SHEET_ID}/edit?gid={GID}\n  const sheetIdMatch = url.match(/\\/spreadsheets\\/d\\/([a-zA-Z0-9-_]+)/);\n  if (!sheetIdMatch) {\n    console.warn('Could not extract sheet ID from URL:', url);\n    return url; // Return original if can't parse\n  }\n  \n  const sheetId = sheetIdMatch[1];\n  \n  // Extract gid từ hash (#gid=) hoặc query (?gid=)\n  let gid = '0'; // Default\n  const gidHashMatch = url.match(/#gid=(\\d+)/);\n  const gidQueryMatch = url.match(/[?&]gid=(\\d+)/);\n  if (gidHashMatch) {\n    gid = gidHashMatch[1];\n  } else if (gidQueryMatch) {\n    gid = gidQueryMatch[1];\n  }\n  \n  // Build CSV export URL\n  return `https://docs.google.com/spreadsheets/d/${sheetId}/export?format=csv&gid=${gid}`;\n};\n\n/**\n * Fetch data từ Google Sheet CSV URL\n * @param {string} url - Google Sheet URL (có thể là edit hoặc export URL)\n * @returns {Promise<Array>} Array of questions\n */\nexport const fetchFromGoogleSheetCSV = async (url) => {\n  try {\n    if (!url) {\n      throw new Error('Google Sheet URL is required');\n    }\n\n    // Convert URL edit sang export CSV nếu cần\n    const csvUrl = convertToCSVExportUrl(url);\n    console.log('Original URL:', url);\n    console.log('Converted CSV URL:', csvUrl);\n\n    let response;\n    let csvText;\n    \n    try {\n      // Thử fetch trực tiếp trước\n      response = await fetch(csvUrl);\n      \n      if (!response.ok) {\n        throw new Error(`Failed to fetch Google Sheet: ${response.statusText}`);\n      }\n\n      csvText = await response.text();\n    } catch (directFetchError) {\n      // Nếu fetch trực tiếp thất bại (CORS), thử qua Worker proxy\n      console.warn('Direct fetch failed, trying proxy:', directFetchError);\n      \n      const API_BASE_URL = import.meta.env.VITE_CLOUDFLARE_API_URL || '';\n      if (!API_BASE_URL) {\n        throw new Error('Không thể fetch Google Sheet do CORS. Vui lòng publish sheet hoặc cấu hình VITE_CLOUDFLARE_API_URL để dùng proxy.');\n      }\n\n      const proxyUrl = `${API_BASE_URL}/api/proxy/sheet?url=${encodeURIComponent(url)}`;\n      response = await fetch(proxyUrl);\n      \n      if (!response.ok) {\n        const errorData = await response.json().catch(() => ({ error: response.statusText }));\n        throw new Error(errorData.error || `Failed to fetch via proxy: ${response.statusText}`);\n      }\n\n      csvText = await response.text();\n    }\n    console.log('CSV Text (first 500 chars):', csvText.substring(0, 500));\n    \n    const rows = parseCSV(csvText, true); // Assume first row is header\n    console.log('Parsed rows count:', rows.length);\n    console.log('First few rows:', rows.slice(0, 3));\n    \n    // Convert rows to questions\n    const questions = rows\n      .map((row, index) => {\n        try {\n          return convertRowToQuestion(row, index);\n        } catch (err) {\n          console.error(`Error converting row ${index}:`, err, row);\n          return null;\n        }\n      })\n      .filter(q => q && q.question && q.question.trim()); // Filter out invalid questions\n\n    console.log('Converted questions count:', questions.length);\n    if (questions.length > 0) {\n      console.log('Sample question:', questions[0]);\n    }\n\n    return questions;\n  } catch (error) {\n    console.error('Error fetching from Google Sheet CSV:', error);\n    throw error;\n  }\n};\n\n/**\n * Fetch data từ Google Sheet bằng Sheet ID và GID\n * @param {string} sheetId - Google Sheet ID\n * @param {string} gid - Sheet GID (tab ID)\n * @returns {Promise<Array>} Array of questions\n */\nexport const fetchFromGoogleSheetById = async (sheetId, gid = '0') => {\n  const url = buildSheetUrl(sheetId, gid);\n  if (!url) {\n    throw new Error('Sheet ID is required');\n  }\n  return fetchFromGoogleSheetCSV(url);\n};\n\n/**\n * Fetch data từ published Google Sheet\n * @param {string} sheetId - Google Sheet ID\n * @param {string} sheetName - Sheet name (tab name)\n * @returns {Promise<Array>} Array of questions\n */\nexport const fetchFromPublishedSheet = async (sheetId, sheetName = 'Sheet1') => {\n  const url = buildPublishedSheetUrl(sheetId, sheetName);\n  if (!url) {\n    throw new Error('Sheet ID is required');\n  }\n  return fetchFromGoogleSheetCSV(url);\n};\n\n/**\n * Load questions cho một subject\n * Ưu tiên Google Sheet, fallback về JSON local\n * @param {string} subjectId - Subject ID (math, vietnamese, english)\n * @returns {Promise<Array>} Array of questions\n */\nexport const loadQuestionsForSubject = async (subjectId) => {\n  const config = sheetsConfig[subjectId];\n  if (!config) {\n    console.warn(`No config found for subject: ${subjectId}`);\n    return [];\n  }\n\n  try {\n    // Thử load từ Google Sheet\n    let questions = [];\n\n    // Ưu tiên 1: Dùng URL trực tiếp\n    if (config.url) {\n      console.log(`Loading ${subjectId} from Google Sheet URL...`);\n      questions = await fetchFromGoogleSheetCSV(config.url);\n    }\n    // Ưu tiên 2: Dùng Sheet ID và GID\n    else if (config.sheetId) {\n      console.log(`Loading ${subjectId} from Google Sheet ID...`);\n      questions = await fetchFromGoogleSheetById(config.sheetId, config.gid);\n    }\n\n    if (questions && questions.length > 0) {\n      console.log(`✅ Loaded ${questions.length} questions from Google Sheet for ${subjectId}`);\n      return questions;\n    }\n  } catch (error) {\n    console.warn(`⚠️ Failed to load from Google Sheet for ${subjectId}, using fallback:`, error);\n  }\n\n  // Fallback: Load từ JSON local\n  try {\n    if (config.fallback) {\n      console.log(`Loading ${subjectId} from local JSON fallback...`);\n      const response = await fetch(config.fallback);\n      if (response.ok) {\n        const data = await response.json();\n        console.log(`✅ Loaded ${data.length} questions from local JSON for ${subjectId}`);\n        return Array.isArray(data) ? data : [];\n      }\n    }\n  } catch (error) {\n    console.error(`❌ Failed to load fallback JSON for ${subjectId}:`, error);\n  }\n\n  return [];\n};\n\n/**\n * Load tất cả questions cho tất cả subjects\n * @returns {Promise<Object>} Object với keys là subject IDs và values là arrays of questions\n */\nexport const loadAllQuestions = async () => {\n  const [math, vietnamese, english] = await Promise.all([\n    loadQuestionsForSubject('math'),\n    loadQuestionsForSubject('vietnamese'),\n    loadQuestionsForSubject('english'),\n  ]);\n\n  return {\n    math,\n    vietnamese,\n    english,\n  };\n};\n"],"names":["sheetsConfig","buildSheetUrl","sheetId","gid","STANDARD_COLUMNS","normalizeKey","key","collectChoiceValuesFromRow","row","dynamicChoices","originalKey","value","parseCSV","csvText","hasHeader","lines","line","headers","parseCSVLine","h","data","startIndex","values","v","obj","header","index","current","inQuotes","i","char","convertRowToQuestion","getValue","lowerKey","id","question","type","answer","hint","points","explanation","trimmedImageUrl","imageUrl","choices","choicesStr","c","legacyChoices","tailChoices","choice","convertToCSVExportUrl","url","sheetIdMatch","gidHashMatch","gidQueryMatch","fetchFromGoogleSheetCSV","csvUrl","response","directFetchError","API_BASE_URL","proxyUrl","errorData","rows","questions","err","q","error","fetchFromGoogleSheetById","loadQuestionsForSubject","subjectId","config","loadAllQuestions","math","vietnamese","english"],"mappings":"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"}