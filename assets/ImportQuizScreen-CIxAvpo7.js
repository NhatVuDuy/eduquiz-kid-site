import{_ as U,e as A,f as F,u as M,j as e,s as O}from"./index--ILSzZaw.js";import{r as o}from"./animation-vendor-B6fZrcjP.js";import{u as $}from"./playerStore-r_j1nxA9.js";import"./levelStore-XI9ZHSFN.js";import{Q as z,c as Y,a as H,b as Z}from"./quiz-BdS3L3uB.js";import{f as K}from"./googleSheetService-mjZez5jn.js";import{l as J,a as W}from"./levelService-DPZIrGbv.js";import{QUIZ_TYPES as w}from"./level-DpoHUSSg.js";import{g as X,c as ee}from"./userService-B-l4Ujv9.js";import{C as l}from"./Card-BK5bYxKM.js";import{B as Q}from"./Button-Bl6cuHxx.js";import{I as te}from"./Input-gL6nqdJo.js";import{H as T}from"./Header-DyyfoM7s.js";import{S as B}from"./ScreenContainer-21a-fcYA.js";import{B as I}from"./BackButton-BDaTWkU4.js";import{O as P}from"./OptionButton-CxVbMwJ3.js";import"./react-vendor-labSKdyf.js";import"./ui-vendor-B8QmJS74.js";const se=async(m,u,c,h,r,g=!1)=>{try{const a=await K(m);if(a.length===0)throw new Error("KhÃ´ng tÃ¬m tháº¥y cÃ¢u há»i nÃ o trong Google Sheet. Vui lÃ²ng kiá»ƒm tra format.");const{getLevelById:p}=await U(()=>import("./level-DpoHUSSg.js"),[]).catch(()=>({getLevelById:()=>null})),{getSubjectsForLevel:x}=await U(()=>import("./level-DpoHUSSg.js"),[]).catch(()=>({getSubjectsForLevel:()=>[]})),E=p?p(c):null,n=(x?x(c):[]).find(i=>i.id===h)?.name||h,S=E?.name||c,b=`quiz_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,d=u===z.OFFICIAL,y=u===z.COMMUNITY,C=u===z.PERSONAL,s=Y({id:b,title:`BÃ i test ${n}`,description:`${S} - ${n} - ÄÆ°á»£c import tá»« Google Sheet`,levelId:c,subjectId:h,quizType:u,source:H.GOOGLE_SHEET,sourceUrl:m,questionCount:a.length,creatorId:r,creatorName:r,createdAt:Date.now(),updatedAt:Date.now(),isPublic:d||y?!0:!!(g&&y),isVerified:d}),N=a.map((i,j)=>({...i,id:`${b}_q${j+1}`,originalId:i.id,order:i.order||j+1})),f=await A.createQuiz({id:s.id,title:s.title,description:s.description,level_id:s.levelId,subject_id:s.subjectId,quiz_type:s.quizType,source_type:s.source||"google_sheet",source_url:s.sourceUrl,question_count:s.questionCount,is_public:s.isPublic,is_verified:s.isVerified,difficulty:s.difficulty||"medium",estimated_time:s.estimatedTime||s.questionCount,tags:s.tags||[],questions:N.map(i=>({id:i.id,question:i.question,type:i.type,choices:i.choices,answer:i.answer,hint:i.hint,points:i.points,explanation:i.explanation,image_url:i.imageUrl,question_order:i.order}))});if(!f||f.error)throw new Error(f?.error||"Upload lÃªn cloud tháº¥t báº¡i");const v=Z({metadata:s,questions:N,cachedAt:Date.now()});return await F(v),v}catch(a){throw console.error("Error importing quiz from Google Sheet:",a),a}},ye=()=>{const{goToNext:m}=M(),{currentPlayer:u}=$(),[c,h]=o.useState(""),[r,g]=o.useState(null),[a,p]=o.useState(null),[x,E]=o.useState(w.PERSONAL),[k,L]=o.useState(!1),[n,S]=o.useState(!1),[b,d]=o.useState(null),[y,C]=o.useState(!1),[s,N]=o.useState([]),[f,v]=o.useState([]),i=X(u),j=ee(i);o.useEffect(()=>{G()},[]),o.useEffect(()=>{r&&R()},[r]);const G=async()=>{try{const t=await J();N(t);const _=t.find(q=>q.id==="grade3")||t[0];_&&g(_)}catch(t){console.error("Error loading levels:",t)}},R=async()=>{try{const t=await W(r.id);v(t),t.length>0&&p(t[0])}catch(t){console.error("Error loading subjects:",t)}},D=[{id:w.PERSONAL,name:"CÃ¡ nhÃ¢n",description:"Chá»‰ báº¡n má»›i tháº¥y",icon:"ðŸ‘¤"},{id:w.COMMUNITY,name:"Cá»™ng Ä‘á»“ng",description:"Chia sáº» vá»›i má»i ngÆ°á»i",icon:"ðŸ‘¥"}],V=async()=>{if(!c.trim()){d("Vui lÃ²ng nháº­p URL Google Sheet");return}if(!r||!a){d("Vui lÃ²ng chá»n cáº¥p Ä‘á»™ vÃ  mÃ´n há»c");return}if(!j){d("Báº¡n khÃ´ng cÃ³ quyá»n táº¡o bÃ i test");return}try{S(!0),d(null),C(!1);const t=await se(c.trim(),x,r.id,a.id,u.id,k);C(!0),O.playSuccess(),setTimeout(()=>{h(""),g(s.find(_=>_.id==="grade3")||s[0]),p(null),L(!1),C(!1)},2e3)}catch(t){console.error("Error importing quiz:",t),d(t.message||"CÃ³ lá»—i khi import bÃ i test. Vui lÃ²ng kiá»ƒm tra láº¡i URL."),O.playError()}finally{S(!1)}};return j?e.jsxs(B,{children:[e.jsx(I,{inline:!0,variant:"ghost",label:"â† Quay láº¡i",onClick:()=>m("home"),className:"mb-2"}),e.jsx(T,{title:"Táº¡o bÃ i test tá»« Google Sheet",subtitle:"Import cÃ¢u há»i tá»« Google Spreadsheet"}),b&&e.jsx(l,{className:"mb-4 p-4 bg-red-50 border border-red-200",children:e.jsxs("p",{className:"text-red-800 text-sm",children:["âš ï¸ ",b]})}),y&&e.jsx(l,{className:"mb-4 p-4 bg-green-50 border border-green-200",children:e.jsx("p",{className:"text-green-800 text-sm",children:"âœ… Import thÃ nh cÃ´ng! BÃ i test Ä‘Ã£ Ä‘Æ°á»£c lÆ°u."})}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs(l,{children:[e.jsx("label",{className:"block text-sm font-semibold text-gray-700 mb-2",children:"URL Google Sheet *"}),e.jsx(te,{type:"url",value:c,onChange:t=>h(t.target.value),placeholder:"https://docs.google.com/spreadsheets/d/...",className:"w-full",disabled:n}),e.jsx("p",{className:"text-xs text-gray-500 mt-2",children:"ðŸ“ LÆ°u Ã½: Sheet pháº£i Ä‘Æ°á»£c publish to web (CSV format)"})]}),e.jsxs(l,{children:[e.jsx("label",{className:"block text-sm font-semibold text-gray-700 mb-3",children:"Chá»n cáº¥p Ä‘á»™ *"}),e.jsx("div",{className:"grid grid-cols-3 gap-2 max-h-48 overflow-y-auto",children:s.map(t=>e.jsx(P,{label:t.name,description:t.description,icon:t.icon,selected:r?.id===t.id,onClick:()=>g(t),disabled:n,size:"sm"},t.id))})]}),r&&e.jsxs(l,{children:[e.jsx("label",{className:"block text-sm font-semibold text-gray-700 mb-3",children:"Chá»n mÃ´n há»c *"}),e.jsx("div",{className:"grid grid-cols-2 gap-3",children:f.map(t=>e.jsx(P,{label:t.name,description:t.description,icon:t.icon,selected:a?.id===t.id,onClick:()=>p(t),disabled:n},t.id))})]}),e.jsxs(l,{children:[e.jsx("label",{className:"block text-sm font-semibold text-gray-700 mb-3",children:"Chá»n loáº¡i bÃ i test"}),e.jsx("div",{className:"grid grid-cols-2 gap-3",children:D.map(t=>e.jsx(P,{label:t.name,description:t.description,icon:t.icon,selected:x===t.id,onClick:()=>E(t.id),disabled:n},t.id))})]}),x===w.COMMUNITY&&e.jsx(l,{children:e.jsxs("label",{className:"flex items-center space-x-3 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:k,onChange:t=>L(t.target.checked),disabled:n,className:"w-5 h-5 text-primary-600 rounded focus:ring-primary-500"}),e.jsxs("div",{children:[e.jsx("span",{className:"text-sm font-semibold text-gray-700",children:"Chia sáº» cÃ´ng khai"}),e.jsx("p",{className:"text-xs text-gray-500",children:"BÃ i test sáº½ hiá»ƒn thá»‹ trong nhÃ³m Cá»™ng Ä‘á»“ng cho má»i ngÆ°á»i"})]})]})}),e.jsxs("div",{className:"flex gap-4",children:[e.jsx(Q,{onClick:V,variant:"primary",size:"lg",disabled:n||!c.trim()||!r||!a,className:"flex-1",children:n?"â³ Äang import...":"ðŸ“¥ Import bÃ i test"}),e.jsx(Q,{onClick:()=>m("home"),variant:"outline",size:"lg",disabled:n,children:"Há»§y"})]})]}),e.jsxs(l,{className:"mt-6 bg-blue-50 border-blue-200",children:[e.jsx("h3",{className:"text-sm font-semibold text-blue-900 mb-2",children:"ðŸ“– HÆ°á»›ng dáº«n:"}),e.jsxs("ol",{className:"text-xs text-blue-800 space-y-1 list-decimal list-inside",children:[e.jsx("li",{children:"Táº¡o Google Sheet vá»›i format: id, question, type, choices, answer, hint, points"}),e.jsx("li",{children:"File â†’ Share â†’ Publish to web â†’ Chá»n CSV format"}),e.jsx("li",{children:"Copy link vÃ  paste vÃ o Ã´ trÃªn"}),e.jsx("li",{children:"Chá»n nhÃ³m vÃ  mÃ´n há»c, sau Ä‘Ã³ click Import"})]})]}),e.jsx(I,{onClick:()=>m("home")})]}):e.jsxs(B,{children:[e.jsx(T,{title:"Táº¡o bÃ i test",subtitle:"Báº¡n cáº§n quyá»n Ä‘á»ƒ táº¡o bÃ i test"}),e.jsxs(l,{className:"text-center py-8",children:[e.jsx("div",{className:"text-6xl mb-4",children:"ðŸ”’"}),e.jsx("p",{className:"text-xl text-gray-600 mb-4",children:"Báº¡n khÃ´ng cÃ³ quyá»n táº¡o bÃ i test"}),e.jsx("p",{className:"text-sm text-gray-500 mb-6",children:"Chá»‰ phá»¥ huynh vÃ  giÃ¡o viÃªn má»›i cÃ³ thá»ƒ táº¡o bÃ i test"}),e.jsx(I,{onClick:()=>m("home")})]})]})};export{ye as ImportQuizScreen};
//# sourceMappingURL=ImportQuizScreen-CIxAvpo7.js.map
