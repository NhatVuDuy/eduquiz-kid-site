{"version":3,"file":"QuizSharePreviewScreen-BX85VTPX.js","sources":["../../src/screens/QuizSharePreviewScreen.jsx"],"sourcesContent":["import React, { useEffect, useState } from 'react';\nimport { Button } from '../components/Button';\nimport { Card } from '../components/Card';\nimport { useFlowStore } from '../store/flowStore';\nimport { useQuizStore } from '../store/quizStore';\nimport { loadQuizData } from '../services/levelService';\nimport { copyShareLinkToClipboard, generateShareLink, shareViaWebAPI } from '../utils/shareHelper';\nimport { getLevelById } from '../models/level';\nimport { getQuizTypeMetadata } from '../models/level';\nimport { soundService } from '../services/soundService';\nimport { ScreenContainer, Header, InfoRow } from '../components/screen';\nimport { motion } from 'framer-motion';\n\n/**\n * QuizSharePreviewScreen Component\n * M√†n h√¨nh hi·ªÉn th·ªã th√¥ng tin b√†i test khi v√†o t·ª´ share link\n * Hi·ªÉn th·ªã ƒë·∫ßy ƒë·ªß th√¥ng tin tr∆∞·ªõc khi v√†o l√†m b√†i\n */\nexport const QuizSharePreviewScreen = ({ quizId }) => {\n  const { goToNext, goBack } = useFlowStore();\n  const { setCurrentLesson, setQuestionCount, sharedQuizId, setSharedQuizId } = useQuizStore();\n  const [quiz, setQuiz] = useState(null);\n  const [loading, setLoading] = useState(true);\n  const [error, setError] = useState(null);\n\n  const effectiveQuizId = quizId || sharedQuizId;\n\n  useEffect(() => {\n    if (effectiveQuizId) {\n      loadQuiz(effectiveQuizId);\n    }\n  }, [effectiveQuizId]);\n\n  const loadQuiz = async (id) => {\n    try {\n      setLoading(true);\n      setError(null);\n\n      // Load quiz data t·ª´ cloud ho·∫∑c local\n      const quizData = await loadQuizData(id);\n      \n      if (!quizData) {\n        setError('Kh√¥ng t√¨m th·∫•y b√†i test n√†y. C√≥ th·ªÉ b√†i test ƒë√£ b·ªã x√≥a ho·∫∑c kh√¥ng t·ªìn t·∫°i.');\n        return;\n      }\n\n      if (!quizData.questions || quizData.questions.length === 0) {\n        setError('B√†i test n√†y kh√¥ng c√≥ c√¢u h·ªèi n√†o.');\n        return;\n      }\n\n      // L∆∞u l·∫°i quizId hi·ªán t·∫°i v√†o store\n      setSharedQuizId(quizData.id || id);\n      setQuiz(quizData);\n    } catch (err) {\n      console.error('Error loading quiz:', err);\n      setError('C√≥ l·ªói khi t·∫£i b√†i test. Vui l√≤ng th·ª≠ l·∫°i sau.');\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const handleStart = () => {\n    if (!quiz) return;\n\n    soundService.playClick();\n\n    // Set current lesson ƒë·ªÉ c√≥ th·ªÉ l√†m b√†i\n    setCurrentLesson({\n      id: quiz.id,\n      name: quiz.title || quiz.id,\n      description: quiz.description || '',\n      icon: 'üìù',\n      questions: quiz.questions,\n    });\n\n    // Set default question count\n    const defaultCount = Math.min(10, quiz.questions.length);\n    setQuestionCount(defaultCount);\n\n    // Chuy·ªÉn ƒë·∫øn m√†n h√¨nh ch·ªçn s·ªë c√¢u h·ªèi\n    goToNext('questionCount');\n  };\n\n  const handleBack = () => {\n    soundService.playClick();\n    goBack();\n  };\n\n  if (loading) {\n    return (\n      <ScreenContainer maxWidth=\"2xl\" className=\"flex items-center justify-center\">\n        <div className=\"text-center\">\n          <div className=\"text-6xl mb-4 animate-spin\">‚è≥</div>\n          <p className=\"text-xl text-gray-600\">ƒêang t·∫£i b√†i test...</p>\n        </div>\n      </ScreenContainer>\n    );\n  }\n\n  if (error) {\n    return (\n      <ScreenContainer maxWidth=\"2xl\">\n        <Header\n          title=\"Kh√¥ng t√¨m th·∫•y b√†i test\"\n          titleClassName=\"text-4xl\"\n          showBackButton={true}\n          onBack={() => goToNext('home')}\n        />\n        <Card>\n          <div className=\"text-center py-8\">\n            <div className=\"text-6xl mb-4\">‚ö†Ô∏è</div>\n            <p className=\"text-xl text-gray-600 mb-4\">{error}</p>\n            <Button\n              onClick={() => goToNext('home')}\n              variant=\"primary\"\n              size=\"lg\"\n            >\n              V·ªÅ trang ch·ªß\n            </Button>\n          </div>\n        </Card>\n      </ScreenContainer>\n    );\n  }\n\n  if (!quiz) return null;\n\n  const levelInfo = quiz.levelId ? getLevelById(quiz.levelId) : null;\n  const typeInfo = quiz.quizType ? getQuizTypeMetadata(quiz.quizType) : null;\n\n  const handleShare = async () => {\n    if (!quiz) return;\n    const id = quiz.id || effectiveQuizId;\n    // Ch·ªâ share official/community\n    if (quiz.quizType !== 'official' && quiz.quizType !== 'community') {\n      alert('Ch·ªâ chia s·∫ª b√†i test ch√≠nh th·ª©c ho·∫∑c c·ªông ƒë·ªìng.');\n      return;\n    }\n\n    // Th·ª≠ Web Share API tr∆∞·ªõc\n    const shared = await shareViaWebAPI(id, quiz.title);\n    if (shared) return;\n\n    // Fallback copy clipboard\n    const copied = await copyShareLinkToClipboard(id);\n    if (copied) {\n      alert('‚úÖ ƒê√£ copy link chia s·∫ª v√†o clipboard!');\n    } else {\n      const link = generateShareLink(id);\n      prompt('Copy link n√†y ƒë·ªÉ chia s·∫ª:', link);\n    }\n  };\n\n  return (\n    <ScreenContainer maxWidth=\"2xl\">\n      <Header\n        title=\"B√†i test ƒë∆∞·ª£c chia s·∫ª\"\n        subtitle=\"Xem th√¥ng tin tr∆∞·ªõc khi l√†m b√†i\"\n        titleClassName=\"text-4xl\"\n        showBackButton={true}\n        onBack={handleBack}\n      />\n\n      <motion.div\n        initial={{ opacity: 0, y: 20 }}\n        animate={{ opacity: 1, y: 0 }}\n        transition={{ duration: 0.3 }}\n      >\n        <Card>\n          <div className=\"space-y-6\">\n            {/* Header v·ªõi icon v√† title */}\n            <div className=\"text-center\">\n              <div className=\"text-6xl mb-4\">{typeInfo?.icon || 'üìù'}</div>\n              <h2 className=\"text-3xl font-bold text-gray-800 mb-3\">\n                {quiz.title || quiz.id}\n              </h2>\n              {quiz.description && (\n                <p className=\"text-lg text-gray-600 mb-4 max-w-2xl mx-auto\">\n                  {quiz.description}\n                </p>\n              )}\n            </div>\n\n            {/* Metadata badges */}\n            <div className=\"flex flex-wrap items-center justify-center gap-2\">\n              {levelInfo && (\n                <span className=\"px-3 py-1.5 bg-blue-100 text-blue-700 rounded-full text-sm font-semibold\">\n                  {levelInfo.icon} {levelInfo.name}\n                </span>\n              )}\n              {typeInfo && (\n                <span className={`px-3 py-1.5 bg-gradient-to-r ${typeInfo.color} text-white rounded-full text-sm font-semibold`}>\n                  {typeInfo.icon} {typeInfo.name}\n                </span>\n              )}\n              {quiz.difficulty && (\n                <span className=\"px-3 py-1.5 bg-gray-100 text-gray-700 rounded-full text-sm\">\n                  {quiz.difficulty === 'easy' ? 'üü¢ D·ªÖ' : \n                   quiz.difficulty === 'medium' ? 'üü° Trung b√¨nh' : \n                   'üî¥ Kh√≥'}\n                </span>\n              )}\n            </div>\n\n            {/* Th√¥ng tin chi ti·∫øt */}\n            <div className=\"bg-gradient-to-br from-primary-50 to-secondary-50 rounded-xl p-6 space-y-4 border border-primary-100\">\n              <InfoRow\n                label=\"üìä S·ªë l∆∞·ª£ng c√¢u h·ªèi:\"\n                value={`${quiz.questions?.length || quiz.questionCount || 0} c√¢u`}\n                valueClassName=\"text-primary-600 font-bold text-lg\"\n              />\n              {quiz.estimatedTime > 0 && (\n                <InfoRow\n                  label=\"‚è±Ô∏è Th·ªùi gian ∆∞·ªõc t√≠nh:\"\n                  value={`${quiz.estimatedTime} ph√∫t`}\n                  valueClassName=\"text-gray-700 font-semibold\"\n                />\n              )}\n              {quiz.usageCount > 0 && (\n                <InfoRow\n                  label=\"üë• S·ªë l∆∞·ª£t l√†m:\"\n                  value={quiz.usageCount.toLocaleString('vi-VN')}\n                  valueClassName=\"text-gray-700 font-semibold\"\n                />\n              )}\n              {quiz.rating > 0 && quiz.ratingCount > 0 && (\n                <InfoRow\n                  label=\"‚≠ê ƒê√°nh gi√°:\"\n                  value={`${quiz.rating.toFixed(1)} / 5.0 (${quiz.ratingCount} ƒë√°nh gi√°)`}\n                  valueClassName=\"text-yellow-600 font-semibold\"\n                />\n              )}\n              {quiz.tags && quiz.tags.length > 0 && (\n                <div>\n                  <label className=\"block text-sm font-semibold text-gray-700 mb-2\">\n                    üè∑Ô∏è Tags:\n                  </label>\n                  <div className=\"flex flex-wrap gap-2\">\n                    {quiz.tags.map((tag, idx) => (\n                      <span\n                        key={idx}\n                        className=\"px-2 py-1 bg-white border border-gray-200 rounded text-xs text-gray-600\"\n                      >\n                        {tag}\n                      </span>\n                    ))}\n                  </div>\n                </div>\n              )}\n            </div>\n\n            {/* Action buttons */}\n            <div className=\"flex gap-4 pt-4\">\n              <Button\n                onClick={handleStart}\n                variant=\"primary\"\n                size=\"lg\"\n                className=\"flex-1\"\n              >\n                üöÄ B·∫Øt ƒë·∫ßu l√†m b√†i\n              </Button>\n              <div className=\"flex flex-1 gap-2\">\n                <Button\n                  onClick={handleShare}\n                  variant=\"outline\"\n                  size=\"lg\"\n                  className=\"flex-1\"\n                >\n                  üîó Chia s·∫ª\n                </Button>\n                <Button\n                  onClick={handleBack}\n                  variant=\"ghost\"\n                  size=\"lg\"\n                  className=\"flex-1\"\n                >\n                  H·ªßy b·ªè\n                </Button>\n              </div>\n            </div>\n          </div>\n        </Card>\n      </motion.div>\n\n      {/* N√∫t Back ·ªü footer */}\n      <div className=\"mt-8 text-center\">\n        <Button\n          onClick={handleBack}\n          variant=\"outline\"\n          size=\"md\"\n        >\n          ‚Üê Quay l·∫°i\n        </Button>\n      </div>\n    </ScreenContainer>\n  );\n};\n\n"],"names":["QuizSharePreviewScreen","quizId","goToNext","goBack","useFlowStore","setCurrentLesson","setQuestionCount","sharedQuizId","setSharedQuizId","useQuizStore","quiz","setQuiz","useState","loading","setLoading","error","setError","effectiveQuizId","useEffect","loadQuiz","id","quizData","loadQuizData","err","handleStart","soundService","defaultCount","handleBack","jsx","ScreenContainer","jsxs","Header","Card","Button","levelInfo","getLevelById","typeInfo","getQuizTypeMetadata","handleShare","shareViaWebAPI","copyShareLinkToClipboard","link","generateShareLink","motion","InfoRow","tag","idx"],"mappings":"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"}