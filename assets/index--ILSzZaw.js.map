{"version":3,"mappings":"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","names":["f","require$$0","k","l","m","n","p","q","c","a","g","b","d","e","h","reactJsxRuntime_production_min","jsxRuntimeModule","client","flowConfig","currentScreenId","screenHistory","initFlow","flow","error","getCurrentScreen","step","goToNext","nextId","currentScreen","targetId","nextScreen","id","goToScreen","screenId","screen","goBack","previousScreenId","candidateId","homeScreen","previousScreen","getPreviousScreenId","getFlowConfig","defaultFlowConfig","useFlowStore","create","set","get","instanceOfAny","object","constructors","idbProxyableTypes","cursorAdvanceMethods","getIdbProxyableTypes","getCursorAdvanceMethods","cursorRequestMap","transactionDoneMap","transactionStoreNamesMap","transformCache","reverseTransformCache","promisifyRequest","request","promise","resolve","reject","unlisten","success","wrap","value","cacheDonePromiseForTransaction","tx","done","complete","idbProxyTraps","target","prop","receiver","replaceTraps","callback","wrapFunction","func","storeNames","args","unwrap","transformCachableValue","newValue","openDB","name","version","blocked","upgrade","blocking","terminated","openPromise","event","db","readMethods","writeMethods","cachedMethods","getMethod","targetFuncName","useIndex","isWrite","method","storeName","oldTraps","DB_NAME","DB_VERSION","STORE_QUIZZES","STORE_RESULTS","STORE_PLAYERS","STORE_QUIZ_METADATA","initDB","oldVersion","quizzesStore","metadataStore","resultsStore","saveQuizResult","result","database","timestamp","resultData","getPlayerResults","playerId","getAllQuizResults","results","savePlayer","player","getAllPlayers","cacheQuiz","quizData","questions","cachedAt","metadata","getCachedQuiz","quizId","getAllCachedQuizzes","filter","store","quizzes","sortBy","SoundService","resumeAudio","frequency","duration","type","oscillator","gainNode","enabled","volume","soundService","DEFAULT_API_BASE_URL","API_BASE_URL","isCloudAvailable","apiRequest","endpoint","options","response","cloudQuizzes","filters","params","testConnection","parseJsonArray","parsed","transformQuizMetadata","quiz","transformQuizQuestions","question","index","syncOfficialQuizzes","quizzesResponse","syncedCount","quizMetadata","normalizedMetadata","fullQuiz","normalizedQuestions","normalizedQuiz","syncCommunityQuizzes","syncAllPublicQuizzes","official","community","getSyncStatus","status","generateShareLink","baseUrl","extractQuizIdFromUrl","url","targetUrl","copyShareLinkToClipboard","shareLink","textarea","fallbackError","shareViaWebAPI","quizTitle","test","testSync","count","IntroScreen","lazy","__vitePreload","SelectPlayerScreen","HomeScreen","LevelSelectScreen","SubjectSelectScreen","QuizTypeSelectScreen","QuizFilterScreen","QuizListScreen","QuizGroupSelectScreen","ImportQuizScreen","LessonSelectScreen","LessonDetailScreen","QuestionCountScreen","QuizSettingsScreen","QuizSharePreviewScreen","QuizScreen","ResultScreen","RewardScreen","SettingsScreen","screenComponents","App","shareQuizId","setShareQuizId","React","useEffect","newUrl","isMounted","runSync","handleVisibilityChange","CurrentScreenComponent","shouldRenderSharePreview","handlePopState","LoadingFallback","jsx","jsxs","AnimatePresence","Suspense","ReactDOM"],"ignoreList":[0,1,2,5,6],"sources":["../../node_modules/react/cjs/react-jsx-runtime.production.min.js","../../node_modules/react/jsx-runtime.js","../../node_modules/react-dom/client.js","../../src/services/flowManager.js","../../src/store/flowStore.js","../../node_modules/idb/build/wrap-idb-value.js","../../node_modules/idb/build/index.js","../../src/services/storageService.js","../../src/services/soundService.js","../../src/services/cloudService.js","../../src/services/syncService.js","../../src/utils/shareHelper.js","../../src/utils/testCloudConnection.js","../../src/App.jsx","../../src/main.jsx"],"sourcesContent":["/**\n * @license React\n * react-jsx-runtime.production.min.js\n *\n * Copyright (c) Facebook, Inc. and its affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n */\n'use strict';var f=require(\"react\"),k=Symbol.for(\"react.element\"),l=Symbol.for(\"react.fragment\"),m=Object.prototype.hasOwnProperty,n=f.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,p={key:!0,ref:!0,__self:!0,__source:!0};\nfunction q(c,a,g){var b,d={},e=null,h=null;void 0!==g&&(e=\"\"+g);void 0!==a.key&&(e=\"\"+a.key);void 0!==a.ref&&(h=a.ref);for(b in a)m.call(a,b)&&!p.hasOwnProperty(b)&&(d[b]=a[b]);if(c&&c.defaultProps)for(b in a=c.defaultProps,a)void 0===d[b]&&(d[b]=a[b]);return{$$typeof:k,type:c,key:e,ref:h,props:d,_owner:n.current}}exports.Fragment=l;exports.jsx=q;exports.jsxs=q;\n","'use strict';\n\nif (process.env.NODE_ENV === 'production') {\n  module.exports = require('./cjs/react-jsx-runtime.production.min.js');\n} else {\n  module.exports = require('./cjs/react-jsx-runtime.development.js');\n}\n","'use strict';\n\nvar m = require('react-dom');\nif (process.env.NODE_ENV === 'production') {\n  exports.createRoot = m.createRoot;\n  exports.hydrateRoot = m.hydrateRoot;\n} else {\n  var i = m.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED;\n  exports.createRoot = function(c, o) {\n    i.usingClientEntryPoint = true;\n    try {\n      return m.createRoot(c, o);\n    } finally {\n      i.usingClientEntryPoint = false;\n    }\n  };\n  exports.hydrateRoot = function(c, h, o) {\n    i.usingClientEntryPoint = true;\n    try {\n      return m.hydrateRoot(c, h, o);\n    } finally {\n      i.usingClientEntryPoint = false;\n    }\n  };\n}\n","/**\n * FlowManager Service\n * Quản lý flow điều hướng giữa các màn hình dựa trên flow.json\n */\n\nlet flowConfig = null;\nlet currentScreenId = null;\nlet screenHistory = []; // Lưu lịch sử các màn hình đã đi qua\n\n/**\n * Khởi tạo FlowManager với flow config\n * @param {Array} flow - Mảng các bước flow từ flow.json\n */\nexport const initFlow = async (flow) => {\n  try {\n    flowConfig = flow;\n    // Bắt đầu từ màn hình đầu tiên\n    if (flow && flow.length > 0) {\n      currentScreenId = flow[0].id;\n    }\n    return { success: true, currentScreen: currentScreenId };\n  } catch (error) {\n    console.error('Error initializing flow:', error);\n    return { success: false, error: error.message };\n  }\n};\n\n/**\n * Lấy màn hình hiện tại\n * @returns {Object|null} Thông tin màn hình hiện tại\n */\nexport const getCurrentScreen = () => {\n  if (!flowConfig || !currentScreenId) return null;\n  return flowConfig.find(step => step.id === currentScreenId);\n};\n\n/**\n * Chuyển đến màn hình tiếp theo\n * @param {string} nextId - ID của màn hình tiếp theo (optional)\n * @returns {Object|null} Thông tin màn hình tiếp theo\n */\nexport const goToNext = (nextId = null) => {\n  if (!flowConfig || !currentScreenId) return null;\n\n  const currentScreen = getCurrentScreen();\n  if (!currentScreen) return null;\n\n  let targetId = nextId;\n\n  // Nếu không có nextId, lấy từ currentScreen.next\n  if (!targetId) {\n    if (Array.isArray(currentScreen.next)) {\n      // Nếu next là mảng, lấy phần tử đầu tiên (có thể mở rộng logic sau)\n      targetId = currentScreen.next[0];\n    } else {\n      targetId = currentScreen.next;\n    }\n  }\n\n  // Tìm màn hình tiếp theo\n  const nextScreen = flowConfig.find(step => step.id === targetId);\n  if (nextScreen) {\n    // Lưu màn hình hiện tại vào history trước khi chuyển\n    // KHÔNG lưu QuizScreen vào history (không cho phép back khi đang làm bài)\n    if (currentScreenId && targetId !== 'quiz') {\n      screenHistory.push(currentScreenId);\n    }\n    // Nếu đang vào QuizScreen, xóa tất cả QuizScreen khỏi history\n    if (targetId === 'quiz') {\n      screenHistory = screenHistory.filter(id => id !== 'quiz');\n    }\n    currentScreenId = nextScreen.id;\n    return nextScreen;\n  }\n\n  return null;\n};\n\n/**\n * Chuyển đến màn hình cụ thể\n * @param {string} screenId - ID của màn hình cần chuyển đến\n * @returns {Object|null} Thông tin màn hình\n */\nexport const goToScreen = (screenId) => {\n  if (!flowConfig) return null;\n\n  const screen = flowConfig.find(step => step.id === screenId);\n  if (screen) {\n    // Lưu màn hình hiện tại vào history trước khi chuyển\n    // KHÔNG lưu QuizScreen vào history (không cho phép back khi đang làm bài)\n    if (currentScreenId && currentScreenId !== screenId && screenId !== 'quiz') {\n      screenHistory.push(currentScreenId);\n    }\n    // Nếu đang vào QuizScreen, xóa tất cả QuizScreen khỏi history\n    if (screenId === 'quiz') {\n      screenHistory = screenHistory.filter(id => id !== 'quiz');\n    }\n    currentScreenId = screen.id;\n    return screen;\n  }\n\n  return null;\n};\n\n/**\n * Quay về màn hình trước đó\n * @returns {Object|null} Thông tin màn hình trước đó\n */\nexport const goBack = () => {\n  if (!flowConfig || screenHistory.length === 0) return null;\n\n  // Không cho phép back về QuizScreen (đang làm bài test)\n  // Loại bỏ tất cả QuizScreen khỏi history trước khi back\n  let previousScreenId = null;\n  while (screenHistory.length > 0) {\n    const candidateId = screenHistory.pop();\n    if (candidateId !== 'quiz') {\n      previousScreenId = candidateId;\n      break;\n    }\n  }\n\n  // Nếu không tìm thấy màn hình hợp lệ, về home\n  if (!previousScreenId) {\n    const homeScreen = flowConfig.find(step => step.id === 'home');\n    if (homeScreen) {\n      currentScreenId = homeScreen.id;\n      return homeScreen;\n    }\n    return null;\n  }\n\n  const previousScreen = flowConfig.find(step => step.id === previousScreenId);\n  if (previousScreen) {\n    currentScreenId = previousScreen.id;\n    return previousScreen;\n  }\n\n  return null;\n};\n\n/**\n * Lấy màn hình trước đó (không xóa khỏi history)\n * @returns {string|null} ID của màn hình trước đó\n */\nexport const getPreviousScreenId = () => {\n  if (screenHistory.length === 0) return null;\n  return screenHistory[screenHistory.length - 1];\n};\n\n/**\n * Xóa lịch sử navigation\n */\nexport const clearHistory = () => {\n  screenHistory = [];\n};\n\n/**\n * Lấy tất cả các màn hình có thể điều hướng từ màn hình hiện tại\n * @returns {Array} Danh sách các màn hình có thể điều hướng\n */\nexport const getAvailableNextScreens = () => {\n  const currentScreen = getCurrentScreen();\n  if (!currentScreen || !currentScreen.next) return [];\n\n  if (Array.isArray(currentScreen.next)) {\n    return currentScreen.next.map(id => \n      flowConfig.find(step => step.id === id)\n    ).filter(Boolean);\n  }\n\n  const nextScreen = flowConfig.find(step => step.id === currentScreen.next);\n  return nextScreen ? [nextScreen] : [];\n};\n\n/**\n * Reset flow về màn hình đầu tiên\n */\nexport const resetFlow = () => {\n  if (flowConfig && flowConfig.length > 0) {\n    currentScreenId = flowConfig[0].id;\n  }\n};\n\n/**\n * Lấy toàn bộ flow config\n * @returns {Array} Flow config\n */\nexport const getFlowConfig = () => flowConfig;\n\n","import { create } from 'zustand';\nimport { initFlow, goToNext, goToScreen, goBack, getCurrentScreen, getFlowConfig, getPreviousScreenId } from '../services/flowManager';\n\n// Default flow config - phải match với flow.json\nconst defaultFlowConfig = [\n  { \"id\": \"intro\", \"component\": \"IntroScreen\", \"next\": \"selectPlayer\" },\n  { \"id\": \"selectPlayer\", \"component\": \"SelectPlayerScreen\", \"next\": \"home\" },\n  { \"id\": \"home\", \"component\": \"HomeScreen\", \"next\": [\"levelSelect\", \"quizFilter\", \"stats\", \"settings\"] },\n  { \"id\": \"levelSelect\", \"component\": \"LevelSelectScreen\", \"next\": \"subjectSelect\" },\n  { \"id\": \"subjectSelect\", \"component\": \"SubjectSelectScreen\", \"next\": \"quizTypeSelect\" },\n  { \"id\": \"quizTypeSelect\", \"component\": \"QuizTypeSelectScreen\", \"next\": \"quizList\" },\n  { \"id\": \"quizFilter\", \"component\": \"QuizFilterScreen\", \"next\": \"quizList\" },\n  { \"id\": \"quizGroupSelect\", \"component\": \"QuizGroupSelectScreen\", \"next\": \"subjectSelect\" },\n  { \"id\": \"quizList\", \"component\": \"QuizListScreen\", \"next\": \"questionCount\" },\n  { \"id\": \"quizSharePreview\", \"component\": \"QuizSharePreviewScreen\", \"next\": \"questionCount\" },\n  { \"id\": \"questionCount\", \"component\": \"QuestionCountScreen\", \"next\": \"quizSettings\" },\n  { \"id\": \"quizSettings\", \"component\": \"QuizSettingsScreen\", \"next\": \"quiz\" },\n  { \"id\": \"quiz\", \"component\": \"QuizScreen\", \"next\": \"result\" },\n  { \"id\": \"result\", \"component\": \"ResultScreen\", \"next\": \"reward\" },\n  { \"id\": \"reward\", \"component\": \"RewardScreen\", \"next\": \"home\" },\n  { \"id\": \"settings\", \"component\": \"SettingsScreen\", \"next\": \"home\" },\n  { \"id\": \"importQuiz\", \"component\": \"ImportQuizScreen\", \"next\": \"home\" },\n  { \"id\": \"lessonSelect\", \"component\": \"LessonSelectScreen\", \"next\": \"questionCount\" }\n];\n\n// Initialize flow config immediately\ninitFlow(defaultFlowConfig);\n\n/**\n * Flow Store\n * Quản lý state của flow navigation\n */\nexport const useFlowStore = create((set, get) => {\n  return {\n    currentScreen: getCurrentScreen(),\n    flowConfig: getFlowConfig(),\n\n    goToNext: (nextId = null) => {\n      const nextScreen = goToNext(nextId);\n      set({ currentScreen: nextScreen });\n      return nextScreen;\n    },\n\n    goToScreen: (screenId) => {\n      const screen = goToScreen(screenId);\n      set({ currentScreen: screen });\n      return screen;\n    },\n\n    goBack: () => {\n      const previousScreen = goBack();\n      set({ currentScreen: previousScreen });\n      return previousScreen;\n    },\n\n    getCurrentScreen: () => {\n      return getCurrentScreen();\n    },\n\n    getPreviousScreenId: () => {\n      return getPreviousScreenId();\n    },\n  };\n});\n","const instanceOfAny = (object, constructors) => constructors.some((c) => object instanceof c);\n\nlet idbProxyableTypes;\nlet cursorAdvanceMethods;\n// This is a function to prevent it throwing up in node environments.\nfunction getIdbProxyableTypes() {\n    return (idbProxyableTypes ||\n        (idbProxyableTypes = [\n            IDBDatabase,\n            IDBObjectStore,\n            IDBIndex,\n            IDBCursor,\n            IDBTransaction,\n        ]));\n}\n// This is a function to prevent it throwing up in node environments.\nfunction getCursorAdvanceMethods() {\n    return (cursorAdvanceMethods ||\n        (cursorAdvanceMethods = [\n            IDBCursor.prototype.advance,\n            IDBCursor.prototype.continue,\n            IDBCursor.prototype.continuePrimaryKey,\n        ]));\n}\nconst cursorRequestMap = new WeakMap();\nconst transactionDoneMap = new WeakMap();\nconst transactionStoreNamesMap = new WeakMap();\nconst transformCache = new WeakMap();\nconst reverseTransformCache = new WeakMap();\nfunction promisifyRequest(request) {\n    const promise = new Promise((resolve, reject) => {\n        const unlisten = () => {\n            request.removeEventListener('success', success);\n            request.removeEventListener('error', error);\n        };\n        const success = () => {\n            resolve(wrap(request.result));\n            unlisten();\n        };\n        const error = () => {\n            reject(request.error);\n            unlisten();\n        };\n        request.addEventListener('success', success);\n        request.addEventListener('error', error);\n    });\n    promise\n        .then((value) => {\n        // Since cursoring reuses the IDBRequest (*sigh*), we cache it for later retrieval\n        // (see wrapFunction).\n        if (value instanceof IDBCursor) {\n            cursorRequestMap.set(value, request);\n        }\n        // Catching to avoid \"Uncaught Promise exceptions\"\n    })\n        .catch(() => { });\n    // This mapping exists in reverseTransformCache but doesn't doesn't exist in transformCache. This\n    // is because we create many promises from a single IDBRequest.\n    reverseTransformCache.set(promise, request);\n    return promise;\n}\nfunction cacheDonePromiseForTransaction(tx) {\n    // Early bail if we've already created a done promise for this transaction.\n    if (transactionDoneMap.has(tx))\n        return;\n    const done = new Promise((resolve, reject) => {\n        const unlisten = () => {\n            tx.removeEventListener('complete', complete);\n            tx.removeEventListener('error', error);\n            tx.removeEventListener('abort', error);\n        };\n        const complete = () => {\n            resolve();\n            unlisten();\n        };\n        const error = () => {\n            reject(tx.error || new DOMException('AbortError', 'AbortError'));\n            unlisten();\n        };\n        tx.addEventListener('complete', complete);\n        tx.addEventListener('error', error);\n        tx.addEventListener('abort', error);\n    });\n    // Cache it for later retrieval.\n    transactionDoneMap.set(tx, done);\n}\nlet idbProxyTraps = {\n    get(target, prop, receiver) {\n        if (target instanceof IDBTransaction) {\n            // Special handling for transaction.done.\n            if (prop === 'done')\n                return transactionDoneMap.get(target);\n            // Polyfill for objectStoreNames because of Edge.\n            if (prop === 'objectStoreNames') {\n                return target.objectStoreNames || transactionStoreNamesMap.get(target);\n            }\n            // Make tx.store return the only store in the transaction, or undefined if there are many.\n            if (prop === 'store') {\n                return receiver.objectStoreNames[1]\n                    ? undefined\n                    : receiver.objectStore(receiver.objectStoreNames[0]);\n            }\n        }\n        // Else transform whatever we get back.\n        return wrap(target[prop]);\n    },\n    set(target, prop, value) {\n        target[prop] = value;\n        return true;\n    },\n    has(target, prop) {\n        if (target instanceof IDBTransaction &&\n            (prop === 'done' || prop === 'store')) {\n            return true;\n        }\n        return prop in target;\n    },\n};\nfunction replaceTraps(callback) {\n    idbProxyTraps = callback(idbProxyTraps);\n}\nfunction wrapFunction(func) {\n    // Due to expected object equality (which is enforced by the caching in `wrap`), we\n    // only create one new func per func.\n    // Edge doesn't support objectStoreNames (booo), so we polyfill it here.\n    if (func === IDBDatabase.prototype.transaction &&\n        !('objectStoreNames' in IDBTransaction.prototype)) {\n        return function (storeNames, ...args) {\n            const tx = func.call(unwrap(this), storeNames, ...args);\n            transactionStoreNamesMap.set(tx, storeNames.sort ? storeNames.sort() : [storeNames]);\n            return wrap(tx);\n        };\n    }\n    // Cursor methods are special, as the behaviour is a little more different to standard IDB. In\n    // IDB, you advance the cursor and wait for a new 'success' on the IDBRequest that gave you the\n    // cursor. It's kinda like a promise that can resolve with many values. That doesn't make sense\n    // with real promises, so each advance methods returns a new promise for the cursor object, or\n    // undefined if the end of the cursor has been reached.\n    if (getCursorAdvanceMethods().includes(func)) {\n        return function (...args) {\n            // Calling the original function with the proxy as 'this' causes ILLEGAL INVOCATION, so we use\n            // the original object.\n            func.apply(unwrap(this), args);\n            return wrap(cursorRequestMap.get(this));\n        };\n    }\n    return function (...args) {\n        // Calling the original function with the proxy as 'this' causes ILLEGAL INVOCATION, so we use\n        // the original object.\n        return wrap(func.apply(unwrap(this), args));\n    };\n}\nfunction transformCachableValue(value) {\n    if (typeof value === 'function')\n        return wrapFunction(value);\n    // This doesn't return, it just creates a 'done' promise for the transaction,\n    // which is later returned for transaction.done (see idbObjectHandler).\n    if (value instanceof IDBTransaction)\n        cacheDonePromiseForTransaction(value);\n    if (instanceOfAny(value, getIdbProxyableTypes()))\n        return new Proxy(value, idbProxyTraps);\n    // Return the same value back if we're not going to transform it.\n    return value;\n}\nfunction wrap(value) {\n    // We sometimes generate multiple promises from a single IDBRequest (eg when cursoring), because\n    // IDB is weird and a single IDBRequest can yield many responses, so these can't be cached.\n    if (value instanceof IDBRequest)\n        return promisifyRequest(value);\n    // If we've already transformed this value before, reuse the transformed value.\n    // This is faster, but it also provides object equality.\n    if (transformCache.has(value))\n        return transformCache.get(value);\n    const newValue = transformCachableValue(value);\n    // Not all types are transformed.\n    // These may be primitive types, so they can't be WeakMap keys.\n    if (newValue !== value) {\n        transformCache.set(value, newValue);\n        reverseTransformCache.set(newValue, value);\n    }\n    return newValue;\n}\nconst unwrap = (value) => reverseTransformCache.get(value);\n\nexport { reverseTransformCache as a, instanceOfAny as i, replaceTraps as r, unwrap as u, wrap as w };\n","import { w as wrap, r as replaceTraps } from './wrap-idb-value.js';\nexport { u as unwrap, w as wrap } from './wrap-idb-value.js';\n\n/**\n * Open a database.\n *\n * @param name Name of the database.\n * @param version Schema version.\n * @param callbacks Additional callbacks.\n */\nfunction openDB(name, version, { blocked, upgrade, blocking, terminated } = {}) {\n    const request = indexedDB.open(name, version);\n    const openPromise = wrap(request);\n    if (upgrade) {\n        request.addEventListener('upgradeneeded', (event) => {\n            upgrade(wrap(request.result), event.oldVersion, event.newVersion, wrap(request.transaction), event);\n        });\n    }\n    if (blocked) {\n        request.addEventListener('blocked', (event) => blocked(\n        // Casting due to https://github.com/microsoft/TypeScript-DOM-lib-generator/pull/1405\n        event.oldVersion, event.newVersion, event));\n    }\n    openPromise\n        .then((db) => {\n        if (terminated)\n            db.addEventListener('close', () => terminated());\n        if (blocking) {\n            db.addEventListener('versionchange', (event) => blocking(event.oldVersion, event.newVersion, event));\n        }\n    })\n        .catch(() => { });\n    return openPromise;\n}\n/**\n * Delete a database.\n *\n * @param name Name of the database.\n */\nfunction deleteDB(name, { blocked } = {}) {\n    const request = indexedDB.deleteDatabase(name);\n    if (blocked) {\n        request.addEventListener('blocked', (event) => blocked(\n        // Casting due to https://github.com/microsoft/TypeScript-DOM-lib-generator/pull/1405\n        event.oldVersion, event));\n    }\n    return wrap(request).then(() => undefined);\n}\n\nconst readMethods = ['get', 'getKey', 'getAll', 'getAllKeys', 'count'];\nconst writeMethods = ['put', 'add', 'delete', 'clear'];\nconst cachedMethods = new Map();\nfunction getMethod(target, prop) {\n    if (!(target instanceof IDBDatabase &&\n        !(prop in target) &&\n        typeof prop === 'string')) {\n        return;\n    }\n    if (cachedMethods.get(prop))\n        return cachedMethods.get(prop);\n    const targetFuncName = prop.replace(/FromIndex$/, '');\n    const useIndex = prop !== targetFuncName;\n    const isWrite = writeMethods.includes(targetFuncName);\n    if (\n    // Bail if the target doesn't exist on the target. Eg, getAll isn't in Edge.\n    !(targetFuncName in (useIndex ? IDBIndex : IDBObjectStore).prototype) ||\n        !(isWrite || readMethods.includes(targetFuncName))) {\n        return;\n    }\n    const method = async function (storeName, ...args) {\n        // isWrite ? 'readwrite' : undefined gzipps better, but fails in Edge :(\n        const tx = this.transaction(storeName, isWrite ? 'readwrite' : 'readonly');\n        let target = tx.store;\n        if (useIndex)\n            target = target.index(args.shift());\n        // Must reject if op rejects.\n        // If it's a write operation, must reject if tx.done rejects.\n        // Must reject with op rejection first.\n        // Must resolve with op value.\n        // Must handle both promises (no unhandled rejections)\n        return (await Promise.all([\n            target[targetFuncName](...args),\n            isWrite && tx.done,\n        ]))[0];\n    };\n    cachedMethods.set(prop, method);\n    return method;\n}\nreplaceTraps((oldTraps) => ({\n    ...oldTraps,\n    get: (target, prop, receiver) => getMethod(target, prop) || oldTraps.get(target, prop, receiver),\n    has: (target, prop) => !!getMethod(target, prop) || oldTraps.has(target, prop),\n}));\n\nexport { deleteDB, openDB };\n","/**\n * Storage Service\n * Lưu kết quả local bằng IndexedDB và đồng bộ Firebase (optional)\n */\n\nimport { openDB } from 'idb';\n\nconst DB_NAME = 'EduQuizDB';\nconst DB_VERSION = 3; // Increment version để upgrade schema (thêm levelId, subjectId)\nconst STORE_QUIZZES = 'quizzes';\nconst STORE_RESULTS = 'results';\nconst STORE_PLAYERS = 'players';\nconst STORE_QUIZ_METADATA = 'quizMetadata'; // Store riêng cho metadata\n\nlet db = null;\n\n/**\n * Khởi tạo IndexedDB\n * @returns {Promise<IDBDatabase>} Database instance\n */\nexport const initDB = async () => {\n  if (db) return db;\n\n  try {\n    db = await openDB(DB_NAME, DB_VERSION, {\n      upgrade(db, oldVersion) {\n        // Tạo store cho quizzes (full quiz data với questions)\n        if (!db.objectStoreNames.contains(STORE_QUIZZES)) {\n          const quizzesStore = db.createObjectStore(STORE_QUIZZES, { keyPath: 'id' });\n          // Old indexes (backward compatibility)\n          quizzesStore.createIndex('group', 'group');\n          quizzesStore.createIndex('subject', 'subject');\n          // New indexes\n          quizzesStore.createIndex('levelId', 'levelId');\n          quizzesStore.createIndex('subjectId', 'subjectId');\n          quizzesStore.createIndex('quizType', 'quizType');\n          quizzesStore.createIndex('levelSubject', ['levelId', 'subjectId']);\n          quizzesStore.createIndex('levelType', ['levelId', 'quizType']);\n          quizzesStore.createIndex('subjectType', ['subjectId', 'quizType']);\n          quizzesStore.createIndex('creatorId', 'creatorId');\n          quizzesStore.createIndex('cachedAt', 'cachedAt');\n        }\n\n        // Tạo store cho quiz metadata (chỉ metadata, không có questions)\n        if (!db.objectStoreNames.contains(STORE_QUIZ_METADATA)) {\n          const metadataStore = db.createObjectStore(STORE_QUIZ_METADATA, { keyPath: 'id' });\n          // Old indexes (backward compatibility)\n          metadataStore.createIndex('group', 'group');\n          metadataStore.createIndex('subject', 'subject');\n          // New indexes\n          metadataStore.createIndex('levelId', 'levelId');\n          metadataStore.createIndex('subjectId', 'subjectId');\n          metadataStore.createIndex('quizType', 'quizType');\n          metadataStore.createIndex('levelSubject', ['levelId', 'subjectId']);\n          metadataStore.createIndex('levelType', ['levelId', 'quizType']);\n          metadataStore.createIndex('subjectType', ['subjectId', 'quizType']);\n          metadataStore.createIndex('creatorId', 'creatorId');\n          metadataStore.createIndex('createdAt', 'createdAt');\n          metadataStore.createIndex('usageCount', 'usageCount');\n        }\n\n        // Tạo store cho results\n        if (!db.objectStoreNames.contains(STORE_RESULTS)) {\n          const resultsStore = db.createObjectStore(STORE_RESULTS, { keyPath: 'id', autoIncrement: true });\n          resultsStore.createIndex('playerId', 'playerId');\n          resultsStore.createIndex('quizId', 'quizId');\n          resultsStore.createIndex('timestamp', 'timestamp');\n        }\n\n        // Tạo store cho players\n        if (!db.objectStoreNames.contains(STORE_PLAYERS)) {\n          db.createObjectStore(STORE_PLAYERS, { keyPath: 'id' });\n        }\n\n        // Migration: Nếu upgrade từ version 1, migrate old quiz data\n        if (oldVersion < 2) {\n          // Migrate old quiz format to new format\n          // This will be handled by cacheQuiz function\n        }\n      },\n    });\n\n    return db;\n  } catch (error) {\n    console.error('Error initializing IndexedDB:', error);\n    throw error;\n  }\n};\n\n/**\n * Lưu kết quả quiz\n * @param {Object} result - Kết quả: { playerId, quizId, score, answers, timestamp }\n * @returns {Promise<string>} ID của kết quả đã lưu\n */\nexport const saveQuizResult = async (result) => {\n  try {\n    const database = await initDB();\n    const timestamp = result.timestamp || Date.now();\n    \n    const resultData = {\n      ...result,\n      timestamp,\n    };\n\n    const id = await database.add(STORE_RESULTS, resultData);\n    return id;\n  } catch (error) {\n    console.error('Error saving quiz result:', error);\n    throw error;\n  }\n};\n\n/**\n * Lấy lịch sử kết quả của player\n * @param {string} playerId - ID của player\n * @returns {Promise<Array>} Mảng các kết quả\n */\nexport const getPlayerResults = async (playerId) => {\n  try {\n    const database = await initDB();\n    const index = database.transaction(STORE_RESULTS).store.index('playerId');\n    const results = await index.getAll(playerId);\n    return results.sort((a, b) => b.timestamp - a.timestamp);\n  } catch (error) {\n    console.error('Error getting player results:', error);\n    return [];\n  }\n};\n\n/**\n * Lấy tất cả kết quả làm bài (dùng cho thống kê)\n * @returns {Promise<Array>}\n */\nexport const getAllQuizResults = async () => {\n  try {\n    const database = await initDB();\n    const store = database.transaction(STORE_RESULTS).store;\n    const results = await store.getAll();\n    return Array.isArray(results) ? results : [];\n  } catch (error) {\n    console.error('Error getting all quiz results:', error);\n    return [];\n  }\n};\n\n/**\n * Lưu player\n * @param {Object} player - Thông tin player: { id, name, avatar, createdAt }\n * @returns {Promise<void>}\n */\nexport const savePlayer = async (player) => {\n  try {\n    const database = await initDB();\n    await database.put(STORE_PLAYERS, player);\n  } catch (error) {\n    console.error('Error saving player:', error);\n    throw error;\n  }\n};\n\n/**\n * Lấy tất cả players\n * @returns {Promise<Array>} Mảng các players\n */\nexport const getAllPlayers = async () => {\n  try {\n    const database = await initDB();\n    return await database.getAll(STORE_PLAYERS);\n  } catch (error) {\n    console.error('Error getting players:', error);\n    return [];\n  }\n};\n\n/**\n * Lưu quiz vào cache (full data với metadata và questions)\n * @param {Object} quizData - Quiz data object (có metadata và questions)\n * @returns {Promise<void>}\n */\nexport const cacheQuiz = async (quizData) => {\n  try {\n    const database = await initDB();\n    \n    // Save full quiz data (với questions)\n    await database.put(STORE_QUIZZES, {\n      ...quizData,\n      cachedAt: quizData.cachedAt || Date.now(),\n    });\n\n    // Save metadata separately (không có questions để query nhanh)\n    const { questions, cachedAt, ...metadata } = quizData;\n    await database.put(STORE_QUIZ_METADATA, {\n      ...metadata,\n      cachedAt: cachedAt || Date.now(),\n    });\n  } catch (error) {\n    console.error('Error caching quiz:', error);\n    throw error;\n  }\n};\n\n/**\n * Lấy quiz từ cache (full data)\n * @param {string} quizId - ID của quiz\n * @returns {Promise<Object|null>} Quiz data hoặc null\n */\nexport const getCachedQuiz = async (quizId) => {\n  try {\n    const database = await initDB();\n    const quiz = await database.get(STORE_QUIZZES, quizId);\n    return quiz || null;\n  } catch (error) {\n    console.error('Error getting cached quiz:', error);\n    return null;\n  }\n};\n\n/**\n * Lấy tất cả quiz metadata (không có questions) theo filter\n * @param {Object} filter - Filter options: { levelId, subjectId, quizType, creatorId, group, subject (backward compat) }\n * @returns {Promise<Array>} Array of quiz metadata\n */\nexport const getAllCachedQuizzes = async (filter = {}) => {\n  try {\n    const database = await initDB();\n    const store = database.transaction(STORE_QUIZ_METADATA).store;\n    \n    let quizzes = [];\n    \n    // New filter system (levelId, subjectId, quizType)\n    if (filter.levelId && filter.subjectId && filter.quizType) {\n      // Query by level, subject, and type\n      const allQuizzes = await store.getAll();\n      quizzes = allQuizzes.filter(q => \n        q.levelId === filter.levelId &&\n        q.subjectId === filter.subjectId &&\n        (q.quizType || q.group) === filter.quizType\n      );\n    } else if (filter.levelId && filter.subjectId) {\n      // Query by level and subject\n      const allQuizzes = await store.getAll();\n      quizzes = allQuizzes.filter(q => \n        q.levelId === filter.levelId &&\n        q.subjectId === filter.subjectId\n      );\n    } else if (filter.levelId && filter.quizType) {\n      // Query by level and type\n      const allQuizzes = await store.getAll();\n      quizzes = allQuizzes.filter(q => \n        q.levelId === filter.levelId &&\n        (q.quizType || q.group) === filter.quizType\n      );\n    } else if (filter.subjectId && filter.quizType) {\n      // Query by subject and type\n      const allQuizzes = await store.getAll();\n      quizzes = allQuizzes.filter(q => \n        q.subjectId === filter.subjectId &&\n        (q.quizType || q.group) === filter.quizType\n      );\n    } else if (filter.levelId) {\n      // Query by level only\n      const allQuizzes = await store.getAll();\n      quizzes = allQuizzes.filter(q => q.levelId === filter.levelId);\n    } else if (filter.subjectId) {\n      // Query by subject only\n      const allQuizzes = await store.getAll();\n      quizzes = allQuizzes.filter(q => q.subjectId === filter.subjectId);\n    } else if (filter.quizType) {\n      // Query by type only\n      const allQuizzes = await store.getAll();\n      quizzes = allQuizzes.filter(q => (q.quizType || q.group) === filter.quizType);\n    }\n    // Backward compatibility: old filter system\n    else if (filter.group && filter.subject) {\n      const allQuizzes = await store.getAll();\n      quizzes = allQuizzes.filter(q => \n        (q.group || q.quizType) === filter.group &&\n        (q.subject || q.subjectId) === filter.subject\n      );\n    } else if (filter.group) {\n      const allQuizzes = await store.getAll();\n      quizzes = allQuizzes.filter(q => (q.group || q.quizType) === filter.group);\n    } else if (filter.creatorId) {\n      // Query by creator\n      const creatorIndex = store.index('creatorId');\n      quizzes = await creatorIndex.getAll(filter.creatorId);\n    } else {\n      // Get all\n      quizzes = await store.getAll();\n    }\n    \n    // Sort\n    const sortBy = filter.sortBy || 'createdAt';\n    if (sortBy === 'usage') {\n      quizzes.sort((a, b) => (b.usageCount || 0) - (a.usageCount || 0));\n    } else if (sortBy === 'rating') {\n      quizzes.sort((a, b) => (b.rating || 0) - (a.rating || 0));\n    } else {\n      quizzes.sort((a, b) => (b.createdAt || 0) - (a.createdAt || 0));\n    }\n    \n    return quizzes;\n  } catch (error) {\n    console.error('Error getting all cached quizzes:', error);\n    return [];\n  }\n};\n\n/**\n * Lấy quiz metadata (không có questions)\n * @param {string} quizId - ID của quiz\n * @returns {Promise<Object|null>} Quiz metadata hoặc null\n */\nexport const getQuizMetadata = async (quizId) => {\n  try {\n    const database = await initDB();\n    const metadata = await database.get(STORE_QUIZ_METADATA, quizId);\n    return metadata || null;\n  } catch (error) {\n    console.error('Error getting quiz metadata:', error);\n    return null;\n  }\n};\n\n/**\n * Xóa cache cũ (quá 7 ngày)\n * @returns {Promise<number>} Số lượng cache đã xóa\n */\nexport const clearOldCache = async () => {\n  try {\n    const database = await initDB();\n    const store = database.transaction(STORE_QUIZZES, 'readwrite').store;\n    const allQuizzes = await store.getAll();\n    const sevenDaysAgo = Date.now() - 7 * 24 * 60 * 60 * 1000;\n    \n    let deletedCount = 0;\n    for (const quiz of allQuizzes) {\n      if (quiz.cachedAt < sevenDaysAgo) {\n        await store.delete(quiz.id);\n        deletedCount++;\n      }\n    }\n    \n    return deletedCount;\n  } catch (error) {\n    console.error('Error clearing old cache:', error);\n    return 0;\n  }\n};\n\n","/**\n * Sound Service\n * Quản lý hiệu ứng âm thanh (đúng/sai, hoàn thành)\n */\n\nclass SoundService {\n  constructor() {\n    this.audioContext = null;\n    this.sounds = {};\n    this.enabled = true;\n    this.volume = 0.7;\n  }\n\n  /**\n   * Khởi tạo AudioContext\n   */\n  init() {\n    try {\n      this.audioContext = new (window.AudioContext || window.webkitAudioContext)();\n      // Resume AudioContext sau user gesture để tránh warning\n      if (this.audioContext.state === 'suspended') {\n        const resumeAudio = () => {\n          this.audioContext.resume().catch(() => {});\n        };\n        document.addEventListener('click', resumeAudio, { once: true });\n        document.addEventListener('touchstart', resumeAudio, { once: true });\n      }\n    } catch (error) {\n      console.warn('Web Audio API not supported:', error);\n    }\n  }\n\n  /**\n   * Tạo âm thanh đơn giản bằng Web Audio API\n   * @param {number} frequency - Tần số (Hz)\n   * @param {number} duration - Thời lượng (ms)\n   * @param {string} type - Loại sóng: 'sine', 'square', 'sawtooth', 'triangle'\n   */\n  playTone(frequency, duration = 200, type = 'sine') {\n    if (!this.enabled || !this.audioContext) return;\n\n    // Resume AudioContext nếu đang suspended\n    if (this.audioContext.state === 'suspended') {\n      this.audioContext.resume().catch(() => {});\n    }\n\n    try {\n      const oscillator = this.audioContext.createOscillator();\n      const gainNode = this.audioContext.createGain();\n\n      oscillator.connect(gainNode);\n      gainNode.connect(this.audioContext.destination);\n\n      oscillator.frequency.value = frequency;\n      oscillator.type = type;\n\n      gainNode.gain.setValueAtTime(0, this.audioContext.currentTime);\n      gainNode.gain.linearRampToValueAtTime(this.volume, this.audioContext.currentTime + 0.01);\n      gainNode.gain.exponentialRampToValueAtTime(0.01, this.audioContext.currentTime + duration / 1000);\n\n      oscillator.start(this.audioContext.currentTime);\n      oscillator.stop(this.audioContext.currentTime + duration / 1000);\n    } catch (error) {\n      console.warn('Error playing tone:', error);\n    }\n  }\n\n  /**\n   * Phát âm thanh \"đúng\"\n   */\n  playCorrect() {\n    // Chuỗi nốt nhạc vui tươi\n    this.playTone(523.25, 100, 'sine'); // C5\n    setTimeout(() => this.playTone(659.25, 100, 'sine'), 100); // E5\n    setTimeout(() => this.playTone(783.99, 150, 'sine'), 200); // G5\n  }\n\n  /**\n   * Phát âm thanh \"sai\"\n   */\n  playIncorrect() {\n    // Nốt thấp, buồn\n    this.playTone(200, 300, 'sawtooth');\n  }\n\n  /**\n   * Phát âm thanh \"hoàn thành\"\n   */\n  playComplete() {\n    // Chuỗi nốt nhạc chiến thắng\n    this.playTone(523.25, 150, 'sine'); // C5\n    setTimeout(() => this.playTone(659.25, 150, 'sine'), 150); // E5\n    setTimeout(() => this.playTone(783.99, 150, 'sine'), 300); // G5\n    setTimeout(() => this.playTone(1046.50, 300, 'sine'), 450); // C6\n  }\n\n  /**\n   * Phát âm thanh \"click\"\n   */\n  playClick() {\n    this.playTone(800, 50, 'square');\n  }\n\n  /**\n   * Phát âm thanh \"badge\"\n   */\n  playBadge() {\n    // Chuỗi nốt nhạc đặc biệt cho badge\n    this.playTone(659.25, 100, 'sine'); // E5\n    setTimeout(() => this.playTone(783.99, 100, 'sine'), 100); // G5\n    setTimeout(() => this.playTone(987.77, 200, 'sine'), 200); // B5\n  }\n\n  /**\n   * Phát âm thanh \"error\"\n   */\n  playError() {\n    // Nốt thấp, cảnh báo\n    this.playTone(150, 400, 'sawtooth');\n  }\n\n  /**\n   * Phát âm thanh \"success\"\n   */\n  playSuccess() {\n    // Chuỗi nốt nhạc thành công\n    this.playTone(523.25, 100, 'sine'); // C5\n    setTimeout(() => this.playTone(659.25, 100, 'sine'), 100); // E5\n    setTimeout(() => this.playTone(783.99, 200, 'sine'), 200); // G5\n  }\n\n  /**\n   * Bật/tắt âm thanh\n   * @param {boolean} enabled - Bật hoặc tắt\n   */\n  setEnabled(enabled) {\n    this.enabled = enabled;\n  }\n\n  /**\n   * Đặt âm lượng\n   * @param {number} volume - Âm lượng từ 0 đến 1\n   */\n  setVolume(volume) {\n    this.volume = Math.max(0, Math.min(1, volume));\n  }\n}\n\n// Export singleton instance\nexport const soundService = new SoundService();\n\n// Khởi tạo khi module được load\nif (typeof window !== 'undefined') {\n  soundService.init();\n}\n\n","/**\n * Cloud Service\n * Service để giao tiếp với Cloudflare D1 qua Worker API\n */\n\n// Fallback to production Worker URL nếu env không được inject (tránh build thiếu biến)\nconst DEFAULT_API_BASE_URL = 'https://eduquiz-api.eduquiz-api.workers.dev';\nconst API_BASE_URL =\n  (import.meta.env.VITE_CLOUDFLARE_API_URL && import.meta.env.VITE_CLOUDFLARE_API_URL.trim()) ||\n  DEFAULT_API_BASE_URL;\n\n/**\n * Check if cloud service is available\n */\nexport const isCloudAvailable = () => {\n  return !!API_BASE_URL && API_BASE_URL.trim() !== '';\n};\n\n/**\n * Make API request với error handling\n */\nconst apiRequest = async (endpoint, options = {}) => {\n  if (!isCloudAvailable()) {\n    throw new Error('Cloudflare API URL chưa được cấu hình. Vui lòng thêm VITE_CLOUDFLARE_API_URL vào .env');\n  }\n\n  try {\n    const response = await fetch(`${API_BASE_URL}${endpoint}`, {\n      ...options,\n      headers: {\n        'Content-Type': 'application/json',\n        ...options.headers,\n      },\n    });\n\n    if (!response.ok) {\n      const error = await response.json().catch(() => ({ error: response.statusText }));\n      throw new Error(error.error || `HTTP ${response.status}: ${response.statusText}`);\n    }\n\n    return await response.json();\n  } catch (error) {\n    console.error(`API Error (${endpoint}):`, error);\n    throw error;\n  }\n};\n\n/**\n * Quizzes API\n */\nexport const cloudQuizzes = {\n  /**\n   * Get quizzes với filters\n   * @param {Object} filters - { levelId, subjectId, quizType, creatorId, sortBy }\n   * @returns {Promise<Array>} Array of quizzes\n   */\n  async getQuizzes(filters = {}) {\n    const params = new URLSearchParams();\n    \n    if (filters.levelId) params.append('levelId', filters.levelId);\n    if (filters.subjectId) params.append('subjectId', filters.subjectId);\n    if (filters.quizType) params.append('quizType', filters.quizType);\n    if (filters.creatorId) params.append('creatorId', filters.creatorId);\n    if (filters.sortBy) params.append('sortBy', filters.sortBy);\n    \n    // Backward compatibility\n    if (filters.group) params.append('group', filters.group);\n    if (filters.subject) params.append('subject', filters.subject);\n\n    return apiRequest(`/api/quizzes?${params.toString()}`);\n  },\n\n  /**\n   * Get quiz by ID (với questions)\n   * @param {string} quizId - Quiz ID\n   * @returns {Promise<Object>} Quiz data với questions\n   */\n  async getQuiz(quizId) {\n    return apiRequest(`/api/quizzes/${quizId}`);\n  },\n\n  /**\n   * Create quiz\n   * @param {Object} quizData - Quiz data\n   * @returns {Promise<Object>} Created quiz\n   */\n  async createQuiz(quizData) {\n    return apiRequest('/api/quizzes', {\n      method: 'POST',\n      body: JSON.stringify(quizData),\n    });\n  },\n};\n\n/**\n * Results API\n */\nexport const cloudResults = {\n  /**\n   * Submit quiz result\n   * @param {Object} resultData - Result data\n   * @returns {Promise<Object>} Success response\n   */\n  async submitResult(resultData) {\n    return apiRequest('/api/results', {\n      method: 'POST',\n      body: JSON.stringify(resultData),\n    });\n  },\n};\n\n/**\n * Users API\n */\nexport const cloudUsers = {\n  /**\n   * Get users\n   * @returns {Promise<Array>} Array of users\n   */\n  async getUsers() {\n    return apiRequest('/api/users');\n  },\n};\n\n/**\n * Test connection\n */\nexport const testConnection = async () => {\n  try {\n    const response = await fetch(`${API_BASE_URL}/api/quizzes?limit=1`);\n    return response.ok;\n  } catch (error) {\n    console.error('Connection test failed:', error);\n    return false;\n  }\n};\n\n\n\n","/**\n * Sync Service\n * Đồng bộ dữ liệu giữa IndexedDB (local) và Cloudflare D1 (cloud)\n */\n\nimport { cloudQuizzes, cloudResults, isCloudAvailable, testConnection } from './cloudService.js';\nimport { cacheQuiz, getCachedQuiz } from './storageService.js';\n\nconst parseJsonArray = (value) => {\n  if (!value) return undefined;\n  if (Array.isArray(value)) return value;\n  try {\n    const parsed = JSON.parse(value);\n    return Array.isArray(parsed) ? parsed : undefined;\n  } catch (error) {\n    return undefined;\n  }\n};\n\nexport const transformQuizMetadata = (quiz = {}) => ({\n  id: quiz.id,\n  title: quiz.title || '',\n  description: quiz.description || '',\n  levelId: quiz.level_id || quiz.levelId || quiz.level || '',\n  subjectId: quiz.subject_id || quiz.subjectId || quiz.subject || '',\n  quizType: quiz.quiz_type || quiz.quizType || quiz.group || '',\n  source: quiz.source_type || quiz.source || 'database',\n  sourceUrl: quiz.source_url || quiz.sourceUrl || '',\n  questionCount: quiz.question_count || quiz.questionCount || 0,\n  creatorId: quiz.creator_id || quiz.creatorId || null,\n  creatorName: quiz.creator_name || quiz.creatorName || '',\n  createdAt: quiz.created_at || quiz.createdAt || Date.now(),\n  updatedAt: quiz.updated_at || quiz.updatedAt || Date.now(),\n  usageCount: quiz.usage_count || quiz.usageCount || 0,\n  rating: quiz.rating || 0,\n  ratingCount: quiz.rating_count || quiz.ratingCount || 0,\n  difficulty: quiz.difficulty || 'medium',\n  estimatedTime: quiz.estimated_time || quiz.estimatedTime || 0,\n  isPublic: Boolean(quiz.is_public || quiz.isPublic),\n  isVerified: Boolean(quiz.is_verified || quiz.isVerified),\n  tags: typeof quiz.tags === 'string'\n    ? JSON.parse(quiz.tags || '[]')\n    : quiz.tags || [],\n});\n\nexport const transformQuizQuestions = (questions = [], quizId) => {\n  return questions.map((question, index) => ({\n    id: question.id || `${quizId}_q${index + 1}`,\n    question: question.question_text || question.question || '',\n    type: (question.question_type || question.type || 'choice').toLowerCase(),\n    choices: parseJsonArray(question.choices),\n    answer: question.answer || '',\n    hint: question.hint || '',\n    points: question.points || 10,\n    explanation: question.explanation || question.explain || '',\n    imageUrl: question.image_url || question.imageUrl || '',\n    order: question.question_order || question.order || index + 1,\n  }));\n};\n\nconst hasMetadataChanged = (cached = {}, metadata = {}) => {\n  if (!cached || !metadata) return true;\n  const fields = ['levelId', 'subjectId', 'quizType', 'questionCount', 'title', 'description'];\n  return fields.some((field) => {\n    const cachedValue = cached[field];\n    const metaValue = metadata[field];\n    return cachedValue !== metaValue;\n  });\n};\n\n/**\n * Sync official quizzes từ cloud về local\n * @param {Object} filters - Filter options\n * @returns {Promise<number>} Số lượng quizzes đã sync\n */\nexport const syncOfficialQuizzes = async (filters = {}) => {\n  if (!isCloudAvailable()) {\n    console.warn('Cloud service không khả dụng, bỏ qua sync');\n    return 0;\n  }\n\n  try {\n    // Load quizzes từ cloud\n    const quizzesResponse = await cloudQuizzes.getQuizzes({\n      ...filters,\n      quizType: 'official',\n    });\n    const quizzes = Array.isArray(quizzesResponse)\n      ? quizzesResponse\n      : quizzesResponse?.results || [];\n\n    let syncedCount = 0;\n\n    // Load full data và cache vào local (luôn fetch, không skip)\n    for (const quizMetadata of quizzes) {\n      try {\n        const normalizedMetadata = transformQuizMetadata(quizMetadata);\n\n        // Load full quiz data từ cloud\n        const fullQuiz = await cloudQuizzes.getQuiz(normalizedMetadata.id);\n        \n        if (fullQuiz) {\n          const normalizedQuestions = transformQuizQuestions(\n            Array.isArray(fullQuiz.questions)\n              ? fullQuiz.questions\n              : fullQuiz.questions?.results || [],\n            normalizedMetadata.id\n          );\n\n          const normalizedQuiz = {\n            ...normalizedMetadata,\n            ...transformQuizMetadata(fullQuiz),\n            questions: normalizedQuestions,\n            cachedAt: Date.now(),\n          };\n\n          // Đảm bảo các key quan trọng luôn tồn tại\n          normalizedQuiz.id =\n            normalizedQuiz.id ||\n            normalizedMetadata.id ||\n            fullQuiz.id ||\n            quizMetadata.id;\n\n          normalizedQuiz.levelId = normalizedQuiz.levelId || normalizedMetadata.levelId;\n          normalizedQuiz.subjectId = normalizedQuiz.subjectId || normalizedMetadata.subjectId;\n          normalizedQuiz.quizType = normalizedQuiz.quizType || normalizedMetadata.quizType || 'official';\n\n          // Cache vào IndexedDB\n          await cacheQuiz(normalizedQuiz);\n          syncedCount++;\n        }\n      } catch (error) {\n        console.error(`Error syncing quiz ${quizMetadata.id}:`, error);\n      }\n    }\n\n    console.log(`✅ Synced ${syncedCount} official quizzes`);\n    return syncedCount;\n  } catch (error) {\n    console.error('Error syncing official quizzes:', error);\n    throw error;\n  }\n};\n\n/**\n * Sync community quizzes (public) từ cloud về local\n */\nexport const syncCommunityQuizzes = async (filters = {}) => {\n  if (!isCloudAvailable()) {\n    console.warn('Cloud service không khả dụng, bỏ qua sync community');\n    return 0;\n  }\n\n  try {\n    const quizzesResponse = await cloudQuizzes.getQuizzes({\n      ...filters,\n      quizType: 'community',\n    });\n    const quizzes = Array.isArray(quizzesResponse)\n      ? quizzesResponse\n      : quizzesResponse?.results || [];\n\n    let syncedCount = 0;\n\n    for (const quizMetadata of quizzes) {\n      try {\n        const normalizedMetadata = transformQuizMetadata(quizMetadata);\n\n        const fullQuiz = await cloudQuizzes.getQuiz(normalizedMetadata.id);\n        if (fullQuiz) {\n          const normalizedQuestions = transformQuizQuestions(\n            Array.isArray(fullQuiz.questions)\n              ? fullQuiz.questions\n              : fullQuiz.questions?.results || [],\n            normalizedMetadata.id\n          );\n\n          const normalizedQuiz = {\n            ...normalizedMetadata,\n            ...transformQuizMetadata(fullQuiz),\n            questions: normalizedQuestions,\n            cachedAt: Date.now(),\n          };\n\n          normalizedQuiz.id =\n            normalizedQuiz.id ||\n            normalizedMetadata.id ||\n            fullQuiz.id ||\n            quizMetadata.id;\n\n          normalizedQuiz.levelId = normalizedQuiz.levelId || normalizedMetadata.levelId;\n          normalizedQuiz.subjectId = normalizedQuiz.subjectId || normalizedMetadata.subjectId;\n          normalizedQuiz.quizType = normalizedQuiz.quizType || normalizedMetadata.quizType || 'community';\n\n          await cacheQuiz(normalizedQuiz);\n          syncedCount++;\n        }\n      } catch (error) {\n        console.error(`Error syncing community quiz ${quizMetadata.id}:`, error);\n      }\n    }\n\n    console.log(`✅ Synced ${syncedCount} community quizzes`);\n    return syncedCount;\n  } catch (error) {\n    console.error('Error syncing community quizzes:', error);\n    throw error;\n  }\n};\n\n/**\n * Sync tất cả quiz public (official + community)\n */\nexport const syncAllPublicQuizzes = async () => {\n  const official = await syncOfficialQuizzes();\n  const community = await syncCommunityQuizzes();\n  return official + community;\n};\n\n/**\n * Upload community quiz lên cloud\n * @param {Object} quizData - Quiz data\n * @returns {Promise<Object>} Uploaded quiz\n */\nexport const uploadCommunityQuiz = async (quizData) => {\n  if (!isCloudAvailable()) {\n    throw new Error('Cloud service không khả dụng');\n  }\n\n  try {\n    // Prepare quiz data for cloud\n    const cloudData = {\n      id: quizData.id,\n      title: quizData.title,\n      description: quizData.description,\n      level_id: quizData.levelId || quizData.level_id,\n      subject_id: quizData.subjectId || quizData.subject_id,\n      quiz_type: quizData.quizType || quizData.quiz_type || quizData.group,\n      source_type: quizData.source || quizData.source_type || 'google_sheet',\n      source_url: quizData.sourceUrl || quizData.source_url,\n      question_count: quizData.questionCount || quizData.question_count || 0,\n      // Tạm thời bỏ creator_id/creator_name để tránh FK lỗi cho tới khi users table có dữ liệu chuẩn\n      // creator_id: quizData.creatorId || quizData.creator_id,\n      // creator_name: quizData.creatorName || quizData.creator_name,\n      is_public: quizData.isPublic || quizData.is_public || false,\n      tags: quizData.tags || [],\n      difficulty: quizData.difficulty,\n      estimated_time: quizData.estimatedTime || quizData.estimated_time,\n      questions: quizData.questions || [],\n    };\n\n    const result = await cloudQuizzes.createQuiz(cloudData);\n    \n    // Update local cache với cloud metadata\n    if (quizData.questions) {\n      await cacheQuiz({\n        ...quizData,\n        cachedAt: Date.now(),\n      });\n    }\n\n    return result;\n  } catch (error) {\n    console.error('Error uploading community quiz:', error);\n    throw error;\n  }\n};\n\n/**\n * Submit quiz result lên cloud\n * @param {Object} resultData - Result data\n * @returns {Promise<void>}\n */\nexport const syncResult = async (resultData) => {\n  if (!isCloudAvailable()) {\n    console.warn('Cloud service không khả dụng, result sẽ được lưu local only');\n    return;\n  }\n\n  try {\n    await cloudResults.submitResult({\n      player_id: resultData.playerId,\n      quiz_id: resultData.quizId,\n      score: resultData.score,\n      total_questions: resultData.totalQuestions,\n      correct_answers: resultData.correctAnswers,\n      time_taken: resultData.timeTaken,\n      answers: resultData.answers || [],\n    });\n    console.log('✅ Result synced to cloud');\n  } catch (error) {\n    console.error('Error syncing result:', error);\n    // Không throw error, vì result đã được lưu local\n  }\n};\n\n/**\n * Sync all data (quizzes + results)\n * @param {Object} options - Sync options\n * @returns {Promise<Object>} Sync summary\n */\nexport const syncAll = async (options = {}) => {\n  const summary = {\n    quizzes: 0,\n    results: 0,\n    errors: [],\n  };\n\n  try {\n    // Test connection\n    const connected = await testConnection();\n    if (!connected) {\n      throw new Error('Không thể kết nối đến cloud service');\n    }\n\n    // Sync official quizzes\n    if (options.syncQuizzes !== false) {\n      try {\n        summary.quizzes = await syncOfficialQuizzes(options.filters);\n      } catch (error) {\n        summary.errors.push(`Quizzes sync: ${error.message}`);\n      }\n    }\n\n    // TODO: Sync results queue\n    // if (options.syncResults !== false) {\n    //   summary.results = await syncResultsQueue();\n    // }\n\n    return summary;\n  } catch (error) {\n    console.error('Error in syncAll:', error);\n    summary.errors.push(error.message);\n    throw error;\n  }\n};\n\n/**\n * Check sync status\n * @returns {Promise<Object>} Sync status\n */\nexport const getSyncStatus = async () => {\n  const status = {\n    cloudAvailable: isCloudAvailable(),\n    connected: false,\n    lastSync: null,\n    pendingSync: 0,\n  };\n\n  if (status.cloudAvailable) {\n    try {\n      status.connected = await testConnection();\n    } catch (error) {\n      console.error('Error checking connection:', error);\n    }\n  }\n\n  // TODO: Load last sync time từ IndexedDB\n  // const lastSync = await getLastSyncTime();\n  // status.lastSync = lastSync;\n\n  return status;\n};\n\n\n\n","/**\n * Share Helper\n * Utility để tạo và xử lý share links cho quizzes\n */\n\n/**\n * Tạo share link cho một quiz\n * @param {string} quizId - Quiz ID\n * @param {string} baseUrl - Base URL của app (optional, default: current origin)\n * @returns {string} Share link\n */\nexport const generateShareLink = (quizId, baseUrl = null) => {\n  const base = baseUrl || (typeof window !== 'undefined' ? window.location.origin : '');\n  return `${base}/?quiz=${encodeURIComponent(quizId)}`;\n};\n\n/**\n * Extract quiz ID từ URL\n * @param {string} url - URL string (optional, default: current URL)\n * @returns {string|null} Quiz ID hoặc null\n */\nexport const extractQuizIdFromUrl = (url = null) => {\n  if (typeof window === 'undefined') return null;\n\n  try {\n    // Nếu truyền url thì dùng url đó, nếu không dùng location.href\n    const targetUrl = url || window.location.href;\n    const urlObj = new URL(targetUrl);\n    const quizId = urlObj.searchParams.get('quiz');\n    return quizId ? decodeURIComponent(quizId) : null;\n  } catch (error) {\n    console.error('Failed to extract quizId from URL:', error);\n    return null;\n  }\n};\n\n/**\n * Copy share link to clipboard\n * @param {string} quizId - Quiz ID\n * @returns {Promise<boolean>} Success status\n */\nexport const copyShareLinkToClipboard = async (quizId) => {\n  try {\n    const shareLink = generateShareLink(quizId);\n    await navigator.clipboard.writeText(shareLink);\n    return true;\n  } catch (error) {\n    console.error('Failed to copy share link:', error);\n    // Fallback: tạo textarea và copy\n    try {\n      const shareLink = generateShareLink(quizId);\n      const textarea = document.createElement('textarea');\n      textarea.value = shareLink;\n      textarea.style.position = 'fixed';\n      textarea.style.opacity = '0';\n      document.body.appendChild(textarea);\n      textarea.select();\n      document.execCommand('copy');\n      document.body.removeChild(textarea);\n      return true;\n    } catch (fallbackError) {\n      console.error('Fallback copy also failed:', fallbackError);\n      return false;\n    }\n  }\n};\n\n/**\n * Share via Web Share API (nếu có)\n * @param {string} quizId - Quiz ID\n * @param {string} quizTitle - Quiz title\n * @returns {Promise<boolean>} Success status\n */\nexport const shareViaWebAPI = async (quizId, quizTitle = '') => {\n  if (typeof navigator === 'undefined' || !navigator.share) {\n    return false;\n  }\n\n  try {\n    const shareLink = generateShareLink(quizId);\n    await navigator.share({\n      title: quizTitle || 'Bài test EduQuiz',\n      text: `Hãy thử làm bài test này: ${quizTitle || 'Bài test thú vị'}`,\n      url: shareLink,\n    });\n    return true;\n  } catch (error) {\n    // User cancelled hoặc lỗi\n    if (error.name !== 'AbortError') {\n      console.error('Web Share API failed:', error);\n    }\n    return false;\n  }\n};\n\n","/**\n * Test Cloud Connection Utility\n * Chạy trong browser console để test kết nối cloud\n */\n\nimport { testConnection, cloudQuizzes } from '../services/cloudService.js';\nimport { syncOfficialQuizzes, getSyncStatus } from '../services/syncService.js';\n\n/**\n * Test connection\n */\nexport const test = async () => {\n  console.log('🔍 Testing cloud connection...');\n  \n  try {\n    const status = await getSyncStatus();\n    console.log('📊 Sync Status:', status);\n    \n    if (!status.cloudAvailable) {\n      console.warn('⚠️ Cloud service chưa được cấu hình');\n      console.log('💡 Thêm VITE_CLOUDFLARE_API_URL vào .env');\n      return;\n    }\n    \n    if (!status.connected) {\n      console.error('❌ Không thể kết nối đến cloud service');\n      return;\n    }\n    \n    console.log('✅ Connection successful!');\n    \n    // Test get quizzes\n    console.log('📥 Testing get quizzes...');\n    const quizzes = await cloudQuizzes.getQuizzes({ limit: 5 });\n    console.log(`✅ Loaded ${quizzes.length} quizzes:`, quizzes);\n    \n    return { success: true, quizzes };\n  } catch (error) {\n    console.error('❌ Test failed:', error);\n    return { success: false, error: error.message };\n  }\n};\n\n/**\n * Test sync\n */\nexport const testSync = async () => {\n  console.log('🔄 Testing sync...');\n  \n  try {\n    const count = await syncOfficialQuizzes();\n    console.log(`✅ Synced ${count} quizzes`);\n    return { success: true, count };\n  } catch (error) {\n    console.error('❌ Sync failed:', error);\n    return { success: false, error: error.message };\n  }\n};\n\n// Export for browser console\nif (typeof window !== 'undefined') {\n  window.testCloud = test;\n  window.testSync = testSync;\n  console.log('💡 Chạy testCloud() hoặc testSync() trong console để test');\n}\n\n\n\n","import React, { useEffect, Suspense, lazy } from 'react';\nimport { AnimatePresence } from 'framer-motion';\nimport { useFlowStore } from './store/flowStore';\nimport { initDB } from './services/storageService';\nimport { soundService } from './services/soundService';\nimport { syncAllPublicQuizzes } from './services/syncService.js';\nimport { extractQuizIdFromUrl } from './utils/shareHelper';\nimport './utils/testCloudConnection.js'; // Load test utilities\n\n// Lazy load screens để cải thiện initial load time\nconst IntroScreen = lazy(() => import('./screens/IntroScreen').then(m => ({ default: m.IntroScreen })));\nconst SelectPlayerScreen = lazy(() => import('./screens/SelectPlayerScreen').then(m => ({ default: m.SelectPlayerScreen })));\nconst HomeScreen = lazy(() => import('./screens/HomeScreen').then(m => ({ default: m.HomeScreen })));\nconst LevelSelectScreen = lazy(() => import('./screens/LevelSelectScreen').then(m => ({ default: m.LevelSelectScreen })));\nconst SubjectSelectScreen = lazy(() => import('./screens/SubjectSelectScreen').then(m => ({ default: m.SubjectSelectScreen })));\nconst QuizTypeSelectScreen = lazy(() => import('./screens/QuizTypeSelectScreen').then(m => ({ default: m.QuizTypeSelectScreen })));\nconst QuizFilterScreen = lazy(() => import('./screens/QuizFilterScreen').then(m => ({ default: m.QuizFilterScreen })));\nconst QuizListScreen = lazy(() => import('./screens/QuizListScreen').then(m => ({ default: m.QuizListScreen })));\nconst QuizGroupSelectScreen = lazy(() => import('./screens/QuizGroupSelectScreen').then(m => ({ default: m.QuizGroupSelectScreen })));\nconst ImportQuizScreen = lazy(() => import('./screens/ImportQuizScreen').then(m => ({ default: m.ImportQuizScreen })));\nconst LessonSelectScreen = lazy(() => import('./screens/LessonSelectScreen').then(m => ({ default: m.LessonSelectScreen })));\nconst LessonDetailScreen = lazy(() => import('./screens/LessonDetailScreen').then(m => ({ default: m.LessonDetailScreen })));\nconst QuestionCountScreen = lazy(() => import('./screens/QuestionCountScreen').then(m => ({ default: m.QuestionCountScreen })));\nconst QuizSettingsScreen = lazy(() => import('./screens/QuizSettingsScreen').then(m => ({ default: m.QuizSettingsScreen })));\nconst QuizSharePreviewScreen = lazy(() => import('./screens/QuizSharePreviewScreen').then(m => ({ default: m.QuizSharePreviewScreen })));\nconst QuizScreen = lazy(() => import('./screens/QuizScreen').then(m => ({ default: m.QuizScreen })));\nconst ResultScreen = lazy(() => import('./screens/ResultScreen').then(m => ({ default: m.ResultScreen })));\nconst RewardScreen = lazy(() => import('./screens/RewardScreen').then(m => ({ default: m.RewardScreen })));\nconst SettingsScreen = lazy(() => import('./screens/SettingsScreen').then(m => ({ default: m.SettingsScreen })));\n\n/**\n * Screen Component Map\n * Map component name to actual component\n */\nconst screenComponents = {\n  IntroScreen,\n  SelectPlayerScreen,\n  HomeScreen,\n  LevelSelectScreen,\n  SubjectSelectScreen,\n  QuizTypeSelectScreen,\n  QuizFilterScreen,\n  QuizListScreen,\n  QuizGroupSelectScreen,\n  ImportQuizScreen,\n  LessonSelectScreen,\n  LessonDetailScreen,\n  QuestionCountScreen,\n  QuizSettingsScreen,\n  QuizSharePreviewScreen,\n  QuizScreen,\n  ResultScreen,\n  RewardScreen,\n  SettingsScreen,\n};\n\n/**\n * App Component\n * Main application component với FlowManager integration\n */\nfunction App() {\n  const { currentScreen, goBack, goToScreen } = useFlowStore();\n  const [shareQuizId, setShareQuizId] = React.useState(null);\n\n  // Xử lý share link khi app load\n  useEffect(() => {\n    const quizId = extractQuizIdFromUrl();\n    if (quizId) {\n      setShareQuizId(quizId);\n      // Chuyển đến màn hình share preview\n      goToScreen('quizSharePreview');\n      // Xóa query param khỏi URL để tránh reload lại\n      if (window.history.replaceState) {\n        const newUrl = window.location.pathname;\n        window.history.replaceState({}, '', newUrl);\n      }\n    }\n  }, [goToScreen]);\n\n  useEffect(() => {\n    let isMounted = true;\n\n    // Khởi tạo IndexedDB (non-blocking)\n    initDB().catch(console.error);\n    \n    // Khởi tạo sound service (non-blocking)\n    soundService.init();\n\n    // Defer sync để không block initial render\n    // Chạy sau khi UI đã render (setTimeout với delay nhỏ)\n    const runSync = () => {\n      syncAllPublicQuizzes().catch((error) => {\n        console.error('Auto sync quizzes failed:', error);\n      });\n    };\n\n    // Sync sau khi UI đã render (defer để không block initial load)\n    // Sử dụng requestIdleCallback nếu có, nếu không thì setTimeout\n    if ('requestIdleCallback' in window) {\n      requestIdleCallback(() => {\n        if (isMounted) runSync();\n      }, { timeout: 2000 });\n    } else {\n      setTimeout(() => {\n        if (isMounted) runSync();\n      }, 100);\n    }\n\n    // Sync mỗi lần người dùng reload/xem lại tab (visibilitychange)\n    const handleVisibilityChange = () => {\n      if (document.visibilityState === 'visible' && isMounted) {\n        // Chỉ sync nếu đã qua initial load\n        if ('requestIdleCallback' in window) {\n          requestIdleCallback(runSync, { timeout: 1000 });\n        } else {\n          setTimeout(runSync, 100);\n        }\n      }\n    };\n    document.addEventListener('visibilitychange', handleVisibilityChange);\n\n    return () => {\n      isMounted = false;\n      document.removeEventListener('visibilitychange', handleVisibilityChange);\n    };\n  }, []);\n\n  // Lấy component tương ứng với currentScreen\n  const CurrentScreenComponent = currentScreen\n    ? screenComponents[currentScreen.component]\n    : null;\n\n  // Nếu là share preview screen, render với quizId prop\n  const shouldRenderSharePreview = currentScreen?.id === 'quizSharePreview' && shareQuizId;\n\n  // Xử lý browser back button và push state\n  useEffect(() => {\n    // Push state khi screen thay đổi\n    if (currentScreen) {\n      window.history.pushState({ screen: currentScreen.id }, '', window.location.href);\n    }\n  }, [currentScreen]);\n\n  // Xử lý popstate event (browser back button)\n  useEffect(() => {\n    const handlePopState = (event) => {\n      // Không cho phép back khi đang ở QuizScreen (đang làm bài test)\n      if (currentScreen?.id === 'quiz') {\n        event.preventDefault();\n        // Push lại state để giữ ở QuizScreen\n        window.history.pushState({ screen: 'quiz' }, '', window.location.href);\n        return;\n      }\n\n      // Quay về màn hình trước đó trong flow\n      const previousScreen = goBack();\n      if (!previousScreen) {\n        // Nếu không có màn hình trước, về home\n        const { goToScreen } = useFlowStore.getState();\n        goToScreen('home');\n      }\n    };\n    window.addEventListener('popstate', handlePopState);\n    return () => {\n      window.removeEventListener('popstate', handlePopState);\n    };\n  }, [goBack, currentScreen]);\n\n  // Debug log\n  useEffect(() => {\n    console.log('App currentScreen:', currentScreen);\n    if (currentScreen) {\n      console.log('Current screen component:', currentScreen.component);\n      console.log('Component exists:', !!screenComponents[currentScreen.component]);\n    }\n  }, [currentScreen]);\n\n  // Loading fallback component\n  const LoadingFallback = () => (\n    <div className=\"min-h-screen bg-gradient-to-br from-primary-100 to-secondary-100 flex items-center justify-center\">\n      <div className=\"text-center\">\n        <div className=\"text-6xl mb-4 animate-spin\">⏳</div>\n        <p className=\"text-xl text-gray-600\">Đang tải...</p>\n        {currentScreen && (\n          <p className=\"text-sm text-gray-500 mt-2\">\n            Screen: {currentScreen.id} ({currentScreen.component})\n          </p>\n        )}\n      </div>\n    </div>\n  );\n\n  return (\n    <div className=\"App min-h-screen\">\n      <AnimatePresence mode=\"wait\">\n        {shouldRenderSharePreview ? (\n          <Suspense fallback={<LoadingFallback />}>\n            <QuizSharePreviewScreen key=\"quizSharePreview\" quizId={shareQuizId} />\n          </Suspense>\n        ) : CurrentScreenComponent ? (\n          <Suspense fallback={<LoadingFallback />}>\n            <CurrentScreenComponent key={currentScreen.id} />\n          </Suspense>\n        ) : (\n          <LoadingFallback />\n        )}\n      </AnimatePresence>\n    </div>\n  );\n}\n\nexport default App;\n\n","import React from 'react';\nimport ReactDOM from 'react-dom/client';\nimport App from './App';\nimport './index.css';\n\nReactDOM.createRoot(document.getElementById('root')).render(\n  <React.StrictMode>\n    <App />\n  </React.StrictMode>\n);\n\n"],"file":"index--ILSzZaw.js"}