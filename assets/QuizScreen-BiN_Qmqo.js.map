{"version":3,"file":"QuizScreen-BiN_Qmqo.js","sources":["../../src/components/ProgressBar.jsx","../../src/components/quiz/QuizHeader.jsx","../../src/utils/imageUrlHelper.js","../../src/components/quiz/QuestionCard.jsx","../../src/components/quiz/ChoiceButton.jsx","../../src/components/quiz/InputAnswer.jsx","../../src/screens/QuizScreen.jsx"],"sourcesContent":["import React from 'react';\nimport { motion } from 'framer-motion';\nimport { cn } from '../utils';\n\n/**\n * ProgressBar Component\n * Thanh ti·∫øn tr√¨nh v·ªõi animation\n */\nexport const ProgressBar = ({\n  value = 0,\n  max = 100,\n  className = '',\n  showLabel = true,\n  color = 'primary',\n  ...props\n}) => {\n  const percentage = Math.min(Math.max((value / max) * 100, 0), 100);\n\n  const colors = {\n    primary: 'bg-primary-600',\n    secondary: 'bg-secondary-600',\n    success: 'bg-green-600',\n    warning: 'bg-yellow-600',\n    danger: 'bg-red-600',\n  };\n\n  return (\n    <div className={cn('w-full', className)} {...props}>\n      {showLabel && (\n        <div className=\"flex justify-between mb-2 text-sm text-gray-600\">\n          <span>Ti·∫øn ƒë·ªô</span>\n          <span>{Math.round(percentage)}%</span>\n        </div>\n      )}\n      <div className=\"w-full bg-gray-200 rounded-full h-3 overflow-hidden\">\n        <motion.div\n          className={cn('h-full rounded-full', colors[color])}\n          initial={{ width: 0 }}\n          animate={{ width: `${percentage}%` }}\n          transition={{ duration: 0.5, ease: 'easeOut' }}\n        />\n      </div>\n    </div>\n  );\n};\n\n","import React from 'react';\nimport { ProgressBar } from '../ProgressBar';\nimport { formatTime } from '../../utils';\nimport { cn } from '../../utils';\n\n/**\n * QuizHeader Component\n * Header for quiz screen with progress and timer\n */\nexport const QuizHeader = ({\n  currentIndex,\n  totalQuestions,\n  timeRemaining,\n  timeLimit,\n  className = '',\n  ...props\n}) => {\n  const progress = ((currentIndex + 1) / totalQuestions) * 100;\n\n  return (\n    <div className={cn('mb-6', className)} {...props}>\n      <div className=\"flex justify-between items-center mb-2\">\n        <span className=\"text-lg font-semibold text-gray-700\">\n          C√¢u {currentIndex + 1} / {totalQuestions}\n        </span>\n        {timeLimit > 0 && (\n          <span className=\"text-lg font-semibold text-primary-600\">\n            ‚è±Ô∏è {formatTime(timeRemaining * 1000)}\n          </span>\n        )}\n      </div>\n      <ProgressBar value={progress} color=\"primary\" />\n    </div>\n  );\n};\n\n","/**\n * Image URL Helper\n * Chuy·ªÉn ƒë·ªïi Google Drive URLs sang direct image URLs\n */\n\n/**\n * Extract file ID t·ª´ Google Drive URL\n * H·ªó tr·ª£ c√°c format:\n * - https://drive.google.com/file/d/FILE_ID/view\n * - https://drive.google.com/open?id=FILE_ID\n * - https://drive.google.com/uc?id=FILE_ID\n * - https://drive.usercontent.google.com/download?id=FILE_ID&export=view\n * - https://drive.google.com/drive/folders/FOLDER_ID (folder link - kh√¥ng h·ªó tr·ª£ tr·ª±c ti·∫øp)\n */\nconst extractFileId = (url) => {\n  if (!url || typeof url !== 'string') return null;\n\n  const trimmedUrl = url.trim();\n\n  // Pattern 1: drive.usercontent.google.com/download?id=FILE_ID (format m·ªõi)\n  let match = trimmedUrl.match(/drive\\.usercontent\\.google\\.com\\/download\\?id=([a-zA-Z0-9_-]+)/);\n  if (match) return match[1];\n\n  // Pattern 2: /file/d/FILE_ID/view ho·∫∑c /file/d/FILE_ID\n  match = trimmedUrl.match(/\\/file\\/d\\/([a-zA-Z0-9_-]+)/);\n  if (match) return match[1];\n\n  // Pattern 3: ?id=FILE_ID (t·ª´ b·∫•t k·ª≥ URL n√†o)\n  match = trimmedUrl.match(/[?&]id=([a-zA-Z0-9_-]+)/);\n  if (match) return match[1];\n\n  // Pattern 4: /open?id=FILE_ID\n  match = trimmedUrl.match(/\\/open\\?id=([a-zA-Z0-9_-]+)/);\n  if (match) return match[1];\n\n  // Pattern 5: /uc?id=FILE_ID\n  match = trimmedUrl.match(/\\/uc\\?id=([a-zA-Z0-9_-]+)/);\n  if (match) return match[1];\n\n  // Pattern 6: /drive/folders/FOLDER_ID (folder - kh√¥ng h·ªó tr·ª£ tr·ª±c ti·∫øp)\n  match = trimmedUrl.match(/\\/drive\\/folders\\/([a-zA-Z0-9_-]+)/);\n  if (match) {\n    console.warn('Google Drive folder link detected. Folder links cannot be converted to direct image URLs. Please use individual file links.');\n    return null;\n  }\n\n  return null;\n};\n\n/**\n * Chuy·ªÉn ƒë·ªïi Google Drive URL sang direct image URL\n * @param {string} url - Google Drive URL\n * @returns {string|null} Direct image URL ho·∫∑c null n·∫øu kh√¥ng th·ªÉ convert\n */\n/**\n * Chuy·ªÉn ƒë·ªïi Google Drive URL sang direct image URL\n * X·ª≠ l√Ω ƒë·ªông khi hi·ªÉn th·ªã, gi·ªØ nguy√™n URL g·ªëc trong database\n * @param {string} url - Google Drive URL (c√≥ th·ªÉ l√† b·∫•t k·ª≥ format n√†o)\n * @returns {string} Direct image URL ho·∫∑c URL g·ªëc n·∫øu kh√¥ng th·ªÉ convert\n */\nexport const convertGoogleDriveUrl = (url) => {\n  if (!url || typeof url !== 'string') return url;\n\n  const trimmedUrl = url.trim();\n  if (!trimmedUrl) return url;\n\n  // N·∫øu l√† ƒë∆∞·ªùng d·∫´n c·ª• th·ªÉ c·ªßa ·∫£nh (kh√¥ng ph·∫£i Google Drive), tr·∫£ v·ªÅ nguy√™n\n  if (trimmedUrl.startsWith('http://') || trimmedUrl.startsWith('https://')) {\n    // Ki·ªÉm tra xem c√≥ ph·∫£i Google Drive URL kh√¥ng\n    const isGoogleDrive = trimmedUrl.includes('drive.google.com') || \n                         trimmedUrl.includes('drive.usercontent.google.com');\n    \n    if (!isGoogleDrive) {\n      return trimmedUrl; // Kh√¥ng ph·∫£i Google Drive, tr·∫£ v·ªÅ nguy√™n (ƒë∆∞·ªùng d·∫´n c·ª• th·ªÉ)\n    }\n\n    // N·∫øu ƒë√£ l√† direct image URL (uc?export=view&id=...), tr·∫£ v·ªÅ nguy√™n\n    if (trimmedUrl.includes('/uc?export=view&id=') || trimmedUrl.includes('/uc?id=')) {\n      return trimmedUrl;\n    }\n\n    // N·∫øu l√† drive.usercontent.google.com v·ªõi export=view, th·ª≠ extract file ID\n    if (trimmedUrl.includes('drive.usercontent.google.com') && trimmedUrl.includes('export=view')) {\n      const fileId = extractFileId(trimmedUrl);\n      if (fileId) {\n        // Convert sang format uc?export=view\n        return `https://drive.google.com/uc?export=view&id=${fileId}`;\n      }\n    }\n  }\n\n  // Extract file ID t·ª´ b·∫•t k·ª≥ format n√†o\n  const fileId = extractFileId(trimmedUrl);\n  if (!fileId) {\n    // Kh√¥ng th·ªÉ extract file ID, c√≥ th·ªÉ l√† folder link ho·∫∑c URL kh√¥ng h·ª£p l·ªá\n    // Tr·∫£ v·ªÅ URL g·ªëc ƒë·ªÉ component c√≥ th·ªÉ th·ª≠ load tr·ª±c ti·∫øp\n    return trimmedUrl;\n  }\n\n  // Convert sang direct image URL\n  // Format: uc?export=view&id= (th∆∞·ªùng d√πng nh·∫•t, nh∆∞ng c·∫ßn file ƒë∆∞·ª£c share c√¥ng khai)\n  const directUrl = `https://drive.google.com/uc?export=view&id=${fileId}`;\n  \n  // Log ƒë·ªÉ debug (ch·ªâ trong development)\n  if (typeof window !== 'undefined' && (window.location.hostname === 'localhost' || window.location.hostname === '127.0.0.1')) {\n    console.log('Converting Google Drive URL:', {\n      original: trimmedUrl,\n      fileId,\n      converted: directUrl,\n      note: 'If image fails to load, ensure the file is shared publicly (Anyone with the link)'\n    });\n  }\n  \n  return directUrl;\n};\n\n/**\n * T·∫°o thumbnail URL t·ª´ Google Drive file ID\n * @param {string} fileId - Google Drive file ID\n * @param {string} size - Size (w1000, w500, etc.)\n * @returns {string} Thumbnail URL\n */\nexport const getGoogleDriveThumbnailUrl = (fileId, size = 'w1000') => {\n  return `https://drive.google.com/thumbnail?id=${fileId}&sz=${size}`;\n};\n\n/**\n * Chuy·ªÉn ƒë·ªïi nhi·ªÅu URLs c√πng l√∫c (cho m·∫£ng)\n * @param {string|string[]} urls - URL ho·∫∑c m·∫£ng URLs\n * @returns {string|string[]} Converted URL(s)\n */\nexport const convertGoogleDriveUrls = (urls) => {\n  if (Array.isArray(urls)) {\n    return urls.map(convertGoogleDriveUrl);\n  }\n  return convertGoogleDriveUrl(urls);\n};\n\n","import React, { useState, useEffect } from 'react';\nimport { motion } from 'framer-motion';\nimport { cn } from '../../utils';\nimport { convertGoogleDriveUrl, getGoogleDriveThumbnailUrl } from '../../utils/imageUrlHelper';\n\n/**\n * QuestionCard Component\n * Card for displaying question content\n */\nexport const QuestionCard = ({\n  question,\n  questionNumber,\n  imageUrl,\n  hint,\n  explanation,\n  showExplanation = false,\n  children,\n  className = '',\n  ...props\n}) => {\n  const [imageError, setImageError] = useState(false);\n  const [currentImageUrl, setCurrentImageUrl] = useState(null);\n  const [attemptedFormats, setAttemptedFormats] = useState(new Set());\n\n  // Convert URL ƒë·ªông khi component mount ho·∫∑c imageUrl thay ƒë·ªïi\n  useEffect(() => {\n    if (imageUrl) {\n      const converted = convertGoogleDriveUrl(imageUrl);\n      setCurrentImageUrl(converted);\n      setAttemptedFormats(new Set([converted]));\n      setImageError(false);\n    }\n  }, [imageUrl]);\n  return (\n    <motion.div\n      initial={{ opacity: 0, x: 100 }}\n      animate={{ opacity: 1, x: 0 }}\n      exit={{ opacity: 0, x: -100 }}\n      transition={{ duration: 0.3 }}\n      {...props}\n    >\n      <div className={cn(\n        'bg-white rounded-2xl shadow-xl p-6 mb-6 border border-gray-100',\n        'backdrop-blur-sm bg-white/95',\n        className\n      )}>\n        <div className=\"flex flex-col gap-3 mb-4\">\n          {typeof questionNumber === 'number' && (\n            <div className=\"text-sm font-semibold text-primary-600 uppercase tracking-wide\">\n              C√¢u {questionNumber}\n            </div>\n          )}\n\n          {imageUrl && (\n            <div className=\"w-full h-48 md:h-56 rounded-2xl border border-gray-200 bg-gray-50 flex items-center justify-center overflow-hidden shadow-sm\">\n              {!imageError ? (\n                <img\n                  src={currentImageUrl}\n                  alt={`Question illustration ${questionNumber || ''}`}\n                  className=\"max-h-full max-w-full object-contain\"\n                  loading=\"lazy\"\n                  onError={(e) => {\n                    const originalUrl = imageUrl;\n                    console.error('Failed to load image:', {\n                      original: originalUrl,\n                      converted: currentImageUrl,\n                      attempted: Array.from(attemptedFormats)\n                    });\n                    \n                    // Extract file ID t·ª´ URL g·ªëc (th·ª≠ nhi·ªÅu pattern)\n                    let fileId = null;\n                    const patterns = [\n                      /\\/file\\/d\\/([a-zA-Z0-9_-]+)/,\n                      /[?&]id=([a-zA-Z0-9_-]+)/,\n                      /drive\\.usercontent\\.google\\.com\\/download\\?id=([a-zA-Z0-9_-]+)/\n                    ];\n                    \n                    for (const pattern of patterns) {\n                      const match = originalUrl.match(pattern);\n                      if (match) {\n                        fileId = match[1];\n                        break;\n                      }\n                    }\n                    \n                    if (!fileId) {\n                      console.warn('Cannot extract file ID from URL:', originalUrl);\n                      setImageError(true);\n                      return;\n                    }\n                    \n                    // Th·ª≠ c√°c format kh√°c nhau theo th·ª© t·ª±\n                    const formats = [\n                      { name: 'thumbnail', url: getGoogleDriveThumbnailUrl(fileId, 'w1000') },\n                      { name: 'thumbnail-large', url: getGoogleDriveThumbnailUrl(fileId, 'w2000') },\n                      { name: 'download', url: `https://drive.google.com/uc?export=download&id=${fileId}` },\n                      { name: 'open', url: `https://drive.google.com/open?id=${fileId}` }\n                    ];\n                    \n                    // T√¨m format ch∆∞a th·ª≠\n                    const nextFormat = formats.find(f => !attemptedFormats.has(f.url));\n                    \n                    if (nextFormat) {\n                      console.log(`Trying alternative format (${nextFormat.name}):`, nextFormat.url);\n                      setAttemptedFormats(prev => new Set([...prev, nextFormat.url]));\n                      setCurrentImageUrl(nextFormat.url);\n                    } else {\n                      // ƒê√£ th·ª≠ h·∫øt c√°c format\n                      console.warn('All image formats failed for file ID:', fileId);\n                      setImageError(true);\n                    }\n                  }}\n                  onLoad={() => {\n                    console.log('Image loaded successfully:', currentImageUrl);\n                  }}\n                />\n              ) : (\n                <div className=\"text-center p-4 text-gray-500\">\n                  <p className=\"text-sm mb-2\">‚ö†Ô∏è Kh√¥ng th·ªÉ t·∫£i ·∫£nh</p>\n                  <p className=\"text-xs\">\n                    File Google Drive c·∫ßn ƒë∆∞·ª£c share c√¥ng khai (Anyone with the link)\n                  </p>\n                  <a\n                    href={imageUrl}\n                    target=\"_blank\"\n                    rel=\"noopener noreferrer\"\n                    className=\"text-xs text-primary-600 underline mt-2 inline-block\"\n                  >\n                    M·ªü ·∫£nh trong tab m·ªõi\n                  </a>\n                </div>\n              )}\n            </div>\n          )}\n\n          <h2 className=\"text-2xl font-bold bg-gradient-to-r from-gray-800 to-gray-700 bg-clip-text text-transparent\">\n            {question}\n          </h2>\n        </div>\n\n        {hint && (\n          <div className=\"bg-primary-50/50 border-l-4 border-primary-500 rounded-r-lg p-3 mb-4\">\n            <p className=\"text-sm text-gray-700 font-medium\">\n              üí° <span className=\"font-semibold\">G·ª£i √Ω:</span> {hint}\n            </p>\n          </div>\n        )}\n\n        {children}\n\n        {showExplanation && explanation && (\n          <div className=\"mt-6 bg-amber-50 border border-amber-200 rounded-2xl p-4\">\n            <p className=\"text-sm font-semibold text-amber-800 mb-2\">Gi·∫£i th√≠ch</p>\n            <p className=\"text-sm text-amber-900 leading-relaxed\">\n              {explanation}\n            </p>\n          </div>\n        )}\n      </div>\n    </motion.div>\n  );\n};\n\n","import React from 'react';\nimport { motion } from 'framer-motion';\nimport { cn } from '../../utils';\n\n/**\n * ChoiceButton Component\n * Button for multiple choice questions\n */\nexport const ChoiceButton = ({\n  choice,\n  isSelected = false,\n  isCorrect = false,\n  isAnswered = false,\n  onClick,\n  className = '',\n  ...props\n}) => {\n  const showResult = isAnswered;\n  \n  let buttonClass = 'w-full p-4 rounded-xl border-2 text-left transition-all duration-300 shadow-sm';\n  if (showResult) {\n    if (isCorrect) {\n      buttonClass += ' border-green-500 bg-gradient-to-r from-green-50 to-green-100 shadow-md shadow-green-200/50';\n    } else if (isSelected && !isCorrect) {\n      buttonClass += ' border-red-500 bg-gradient-to-r from-red-50 to-red-100 shadow-md shadow-red-200/50';\n    } else {\n      buttonClass += ' border-gray-300 bg-gray-50';\n    }\n  } else {\n    buttonClass += isSelected\n      ? ' border-primary-600 bg-gradient-to-r from-primary-50 to-primary-100 shadow-md shadow-primary-200/50'\n      : ' border-gray-300 bg-white hover:border-primary-400 hover:bg-primary-50/50 hover:shadow-md';\n  }\n\n  return (\n    <motion.button\n      onClick={onClick}\n      className={cn(buttonClass, className)}\n      disabled={isAnswered}\n      whileHover={!isAnswered ? { scale: 1.02 } : {}}\n      whileTap={!isAnswered ? { scale: 0.98 } : {}}\n      animate={\n        showResult && isCorrect\n          ? { scale: [1, 1.1, 1], rotate: [0, 5, -5, 0] }\n          : showResult && isSelected && !isCorrect\n          ? { x: [0, -10, 10, -10, 10, 0] }\n          : {}\n      }\n      {...props}\n    >\n      <div className=\"flex items-center justify-between\">\n        <span className=\"text-lg font-medium text-gray-800\">\n          {choice}\n        </span>\n        {showResult && isCorrect && (\n          <span className=\"text-2xl\">‚úÖ</span>\n        )}\n        {showResult && isSelected && !isCorrect && (\n          <span className=\"text-2xl\">‚ùå</span>\n        )}\n      </div>\n    </motion.button>\n  );\n};\n\n","import React from 'react';\nimport { motion } from 'framer-motion';\nimport { Button } from '../Button';\nimport { cn } from '../../utils';\n\n/**\n * InputAnswer Component\n * Input field for text-based questions\n */\nexport const InputAnswer = ({\n  value,\n  onChange,\n  onConfirm,\n  isAnswered = false,\n  isCorrect = false,\n  correctAnswer = '',\n  disabled = false,\n  className = '',\n  ...props\n}) => {\n  return (\n    <div className={cn('space-y-4', className)} {...props}>\n      <div className=\"relative\">\n        <input\n          type=\"text\"\n          value={value}\n          onChange={(e) => !isAnswered && onChange(e.target.value)}\n          onKeyPress={(e) => {\n            if (e.key === 'Enter' && value && !isAnswered) {\n              onConfirm();\n            }\n          }}\n          className={cn(\n            'w-full px-4 py-3 border-2 rounded-lg text-lg focus:outline-none transition-all',\n            isAnswered\n              ? isCorrect\n                ? 'border-green-500 bg-green-50'\n                : 'border-red-500 bg-red-50'\n              : 'border-gray-300 focus:border-primary-500'\n          )}\n          placeholder=\"Nh·∫≠p c√¢u tr·∫£ l·ªùi...\"\n          disabled={isAnswered || disabled}\n        />\n        {isAnswered && (\n          <motion.div\n            initial={{ opacity: 0, scale: 0.8 }}\n            animate={{ opacity: 1, scale: 1 }}\n            className=\"absolute right-3 top-1/2 -translate-y-1/2 text-2xl\"\n          >\n            {isCorrect ? (\n              <span className=\"text-green-600\">‚úÖ</span>\n            ) : (\n              <span className=\"text-red-600\">‚ùå</span>\n            )}\n          </motion.div>\n        )}\n      </div>\n\n      {isAnswered && (\n        <motion.div\n          initial={{ opacity: 0, y: -10 }}\n          animate={{ opacity: 1, y: 0 }}\n          className={cn(\n            'p-4 rounded-lg',\n            isCorrect\n              ? 'bg-green-50 border-2 border-green-200'\n              : 'bg-red-50 border-2 border-red-200'\n          )}\n        >\n          <div className=\"flex items-center gap-2 mb-2\">\n            <span className=\"text-lg font-semibold\">\n              {isCorrect ? 'ƒê√∫ng r·ªìi! üéâ' : 'Sai r·ªìi! üòî'}\n            </span>\n          </div>\n          {!isCorrect && correctAnswer && (\n            <div className=\"text-sm text-gray-700\">\n              <span className=\"font-medium\">ƒê√°p √°n ƒë√∫ng:</span>{' '}\n              <span className=\"font-semibold text-green-700\">{correctAnswer}</span>\n            </div>\n          )}\n        </motion.div>\n      )}\n\n      {!isAnswered && (\n        <Button\n          onClick={onConfirm}\n          variant=\"primary\"\n          size=\"lg\"\n          className=\"w-full\"\n          disabled={!value || disabled}\n        >\n          X√°c nh·∫≠n\n        </Button>\n      )}\n    </div>\n  );\n};\n\n","import React, { useState, useEffect, useRef, useMemo } from 'react';\nimport { AnimatePresence } from 'framer-motion';\nimport { Button } from '../components/Button';\nimport { useFlowStore } from '../store/flowStore';\nimport { useQuizStore } from '../store/quizStore';\nimport { calculateScore } from '../services/scoringService';\nimport { shuffleArray } from '../utils';\nimport { soundService } from '../services/soundService';\nimport { ScreenContainer } from '../components/screen';\nimport { QuizHeader, QuestionCard, ChoiceButton, InputAnswer } from '../components/quiz';\n\n/**\n * QuizScreen Component\n * M√†n h√¨nh l√†m b√†i quiz\n */\nexport const QuizScreen = () => {\n  console.log('QuizScreen component rendered!');\n  const { goToNext } = useFlowStore();\n  const {\n    currentLesson,\n    questionCount,\n    quizSettings,\n    setQuizResult,\n    setQuestionCount,\n    setQuizSettings,\n  } = useQuizStore();\n  const [currentQuestionIndex, setCurrentQuestionIndex] = useState(0);\n  const [selectedAnswer, setSelectedAnswer] = useState('');\n  const [userAnswers, setUserAnswers] = useState([]);\n  const [timeRemaining, setTimeRemaining] = useState(quizSettings?.timeLimit || 0);\n  const [isAnswered, setIsAnswered] = useState(false);\n  const timerRef = useRef(null);\n  const answeredRef = useRef(false);\n\n  // ƒê·∫£m b·∫£o questionCount c√≥ gi√° tr·ªã m·∫∑c ƒë·ªãnh\n  useEffect(() => {\n    if (!questionCount && currentLesson?.questions) {\n      const defaultCount = Math.min(10, currentLesson.questions.length);\n      setQuestionCount(defaultCount);\n      console.log('Setting default questionCount:', defaultCount);\n    }\n  }, [questionCount, currentLesson, setQuestionCount]);\n\n  const questions = currentLesson?.questions || [];\n  \n  // Ch·ªâ shuffle m·ªôt l·∫ßn khi component mount ho·∫∑c khi lesson thay ƒë·ªïi\n  // V√† ch·ªâ l·∫•y s·ªë l∆∞·ª£ng c√¢u h·ªèi ƒë√£ ch·ªçn\n  const shuffledQuestions = useMemo(() => {\n    console.log('Shuffling questions:', {\n      questionsLength: questions.length,\n      questionCount,\n      hasCurrentLesson: !!currentLesson\n    });\n    \n    if (!questions || questions.length === 0) {\n      console.warn('No questions available');\n      return [];\n    }\n    \n    const shuffled = shuffleArray([...questions]);\n    const count = questionCount || 10;\n    const result = shuffled.slice(0, Math.min(count, shuffled.length));\n    console.log('Shuffled result:', result.length, 'questions');\n    return result;\n  }, [currentLesson?.id, questions.length, questionCount]); // Shuffle l·∫°i khi lesson ho·∫∑c questionCount thay ƒë·ªïi\n  \n  const currentQuestion = shuffledQuestions && shuffledQuestions.length > 0 \n    ? shuffledQuestions[currentQuestionIndex] \n    : null;\n  \n  // Reset currentQuestionIndex khi lesson ho·∫∑c questionCount thay ƒë·ªïi\n  useEffect(() => {\n    setCurrentQuestionIndex(0);\n    setSelectedAnswer('');\n    setIsAnswered(false);\n    setUserAnswers([]);\n    setTimeRemaining(quizSettings?.timeLimit || 0);\n  }, [currentLesson?.id, questionCount]);\n\n  // Ch·ªâ shuffle choices m·ªôt l·∫ßn cho m·ªói c√¢u h·ªèi\n  const shuffledChoices = useMemo(() => {\n    if (!currentQuestion?.choices) return [];\n    return shuffleArray([...currentQuestion.choices]);\n  }, [currentQuestionIndex, currentQuestion?.id]); // Ch·ªâ shuffle l·∫°i khi chuy·ªÉn c√¢u h·ªèi\n\n  useEffect(() => {\n    // Reset state v√† c·ªù answered khi chuy·ªÉn c√¢u h·ªèi\n    answeredRef.current = false;\n    setSelectedAnswer('');\n    setIsAnswered(false);\n    setTimeRemaining(quizSettings?.timeLimit || 0);\n\n    if (timerRef.current) {\n      clearInterval(timerRef.current);\n      timerRef.current = null;\n    }\n    \n    if (quizSettings?.timeLimit > 0) {\n      timerRef.current = setInterval(() => {\n        setTimeRemaining((prev) => {\n          // Khi gi·∫£m v·ªÅ 0, gi·ªØ 0 trong 1 gi√¢y, tick ti·∫øp theo m·ªõi auto tr·∫£ l·ªùi\n          if (prev <= 0) {\n            // Khi h·∫øt gi·ªù: d·ª´ng timer v√† auto tr·∫£ l·ªùi n·∫øu ch∆∞a tr·∫£ l·ªùi\n            if (timerRef.current) {\n              clearInterval(timerRef.current);\n              timerRef.current = null;\n            }\n            if (!answeredRef.current) {\n              handleAnswer('');\n            }\n            return 0;\n          }\n          return prev - 1;\n        });\n      }, 1000);\n    }\n\n    return () => {\n      if (timerRef.current) {\n        clearInterval(timerRef.current);\n        timerRef.current = null;\n      }\n    };\n  }, [currentQuestionIndex, quizSettings?.timeLimit]);\n\n  const handleAnswer = (answer) => {\n    // ƒê·∫£m b·∫£o m·ªói c√¢u ch·ªâ x·ª≠ l√Ω answer m·ªôt l·∫ßn (tr√°nh nh·∫£y 2 c√¢u khi h·∫øt gi·ªù + ng∆∞·ªùi d√πng b·∫•m)\n    if (answeredRef.current) return;\n    answeredRef.current = true;\n    setIsAnswered(true);\n\n    if (timerRef.current) {\n      clearInterval(timerRef.current);\n      timerRef.current = null;\n    }\n    // Normalize answer ƒë·ªÉ so s√°nh (trim whitespace, lowercase)\n    const normalizedUserAnswer = answer.trim().toLowerCase();\n    const normalizedCorrectAnswer = currentQuestion.answer.trim().toLowerCase();\n    const isCorrect = normalizedUserAnswer === normalizedCorrectAnswer;\n    \n    if (isCorrect) {\n      soundService.playCorrect();\n    } else {\n      soundService.playIncorrect();\n    }\n\n    const answerData = {\n      questionId: currentQuestion.id,\n      question: currentQuestion.question,\n      userAnswer: answer,\n      correctAnswer: currentQuestion.answer,\n      isCorrect,\n      timeRemaining: timeRemaining,\n      maxTime: quizSettings?.timeLimit || 0,\n    };\n\n    setUserAnswers([...userAnswers, answerData]);\n\n    // N·∫øu autoNext: t·ª± ƒë·ªông chuy·ªÉn c√¢u sau khi hi·ªÉn th·ªã ƒë√°p √°n\n    // N·∫øu kh√¥ng: ƒë·ª£i ng∆∞·ªùi d√πng b·∫•m \"C√¢u ti·∫øp theo\"\n    if (quizSettings?.autoNext) {\n      setTimeout(() => {\n        if (currentQuestionIndex < shuffledQuestions.length - 1) {\n          // Reset state tr∆∞·ªõc khi chuy·ªÉn c√¢u\n          setSelectedAnswer('');\n          setIsAnswered(false);\n          setTimeRemaining(quizSettings?.timeLimit || 0);\n          // Chuy·ªÉn c√¢u h·ªèi sau khi reset state\n          setCurrentQuestionIndex((prev) => prev + 1);\n        } else {\n          finishQuiz();\n        }\n      }, 1500);\n    }\n  };\n\n  const finishQuiz = () => {\n    const correctAnswers = userAnswers.filter((a) => a.isCorrect).length + \n      (selectedAnswer === currentQuestion.answer ? 1 : 0);\n    const totalQuestions = shuffledQuestions.length;\n\n    const answers = [...userAnswers];\n    if (selectedAnswer) {\n      answers.push({\n        questionId: currentQuestion.id,\n        question: currentQuestion.question,\n        userAnswer: selectedAnswer,\n        correctAnswer: currentQuestion.answer,\n        isCorrect: selectedAnswer === currentQuestion.answer,\n        timeRemaining: timeRemaining,\n        maxTime: quizSettings?.timeLimit || 0,\n      });\n    }\n\n    const score = calculateScore(quizSettings?.scoringMode || 'basic', {\n      correctAnswers,\n      totalQuestions,\n      answers,\n    });\n\n    setQuizResult({\n      score,\n      totalQuestions,\n      correctAnswers,\n      answers,\n      questions: shuffledQuestions,\n    });\n\n    soundService.playComplete();\n    goToNext('result');\n  };\n\n  // Early return check v·ªõi log\n  if (!currentLesson || !currentLesson.questions || currentLesson.questions.length === 0) {\n    console.log('QuizScreen: No lesson or questions', {\n      hasCurrentLesson: !!currentLesson,\n      hasQuestions: !!currentLesson?.questions,\n      questionsLength: currentLesson?.questions?.length\n    });\n    return (\n      <ScreenContainer className=\"flex items-center justify-center\">\n        <div className=\"text-center\">\n          <p className=\"text-xl text-gray-600 mb-4\">Kh√¥ng c√≥ c√¢u h·ªèi n√†o!</p>\n          <Button onClick={() => goToNext('lessonSelect')} variant=\"primary\">\n            Quay l·∫°i ch·ªçn m√¥n\n          </Button>\n        </div>\n      </ScreenContainer>\n    );\n  }\n\n  // Debug: Log ƒë·ªÉ ki·ªÉm tra\n  useEffect(() => {\n    console.log('QuizScreen Debug:', {\n      hasCurrentLesson: !!currentLesson,\n      questionsCount: questions.length,\n      shuffledCount: shuffledQuestions?.length || 0,\n      questionCount,\n      currentQuestionIndex,\n      hasCurrentQuestion: !!currentQuestion\n    });\n  }, [currentLesson, questions.length, shuffledQuestions?.length, questionCount, currentQuestionIndex, currentQuestion]);\n\n  if (!currentQuestion || !shuffledQuestions || shuffledQuestions.length === 0) {\n    console.log('QuizScreen: No current question or shuffled questions', {\n      hasCurrentQuestion: !!currentQuestion,\n      shuffledLength: shuffledQuestions?.length || 0,\n      currentQuestionIndex,\n      questionCount\n    });\n    return (\n      <ScreenContainer className=\"flex items-center justify-center\">\n        <div className=\"text-center\">\n          <p className=\"text-xl text-gray-600 mb-4\">ƒêang t·∫£i c√¢u h·ªèi...</p>\n          <p className=\"text-sm text-gray-500\">\n            {!currentLesson ? 'Ch∆∞a ch·ªçn m√¥n h·ªçc' : \n             !shuffledQuestions || shuffledQuestions.length === 0 ? 'Kh√¥ng c√≥ c√¢u h·ªèi' : \n             'ƒêang x·ª≠ l√Ω...'}\n          </p>\n          <p className=\"text-xs text-gray-400 mt-2\">\n            Debug: shuffled={shuffledQuestions?.length || 0}, idx={currentQuestionIndex}, count={questionCount}\n          </p>\n          <Button \n            onClick={() => goToNext('lessonSelect')} \n            variant=\"outline\" \n            className=\"mt-4\"\n          >\n            Quay l·∫°i\n          </Button>\n        </div>\n      </ScreenContainer>\n    );\n  }\n\n  const isInputCorrect = selectedAnswer.trim().toLowerCase() === currentQuestion.answer.trim().toLowerCase();\n  const isLastQuestion = currentQuestionIndex === shuffledQuestions.length - 1;\n\n  return (\n    <ScreenContainer maxWidth=\"3xl\">\n      <div className=\"flex items-center justify-between mb-2\">\n        <QuizHeader\n          currentIndex={currentQuestionIndex}\n          totalQuestions={shuffledQuestions.length}\n          timeRemaining={timeRemaining}\n          timeLimit={quizSettings?.timeLimit || 0}\n        />\n        <button\n          type=\"button\"\n          onClick={() =>\n            setQuizSettings({\n              autoNext: !quizSettings?.autoNext,\n            })\n          }\n          className=\"ml-4 inline-flex items-center gap-2 rounded-full border border-gray-200 bg-white px-3 py-1 text-xs text-gray-600 hover:border-primary-400 hover:text-primary-600 transition-colors\"\n        >\n          <span\n            className={`inline-flex h-3 w-6 items-center rounded-full ${\n              quizSettings?.autoNext ? 'bg-primary-500' : 'bg-gray-300'\n            }`}\n          >\n            <span\n              className={`h-3 w-3 transform rounded-full bg-white shadow transition-transform ${\n                quizSettings?.autoNext ? 'translate-x-3' : 'translate-x-0'\n              }`}\n            />\n          </span>\n          <span>{quizSettings?.autoNext ? 'Auto next' : 'Manual next'}</span>\n        </button>\n      </div>\n\n      <AnimatePresence mode=\"wait\">\n        <QuestionCard\n          key={currentQuestionIndex}\n          question={currentQuestion.question}\n          questionNumber={currentQuestionIndex + 1}\n          hint={currentQuestion.hint}\n          imageUrl={currentQuestion.imageUrl}\n          explanation={currentQuestion.explanation}\n          showExplanation={isAnswered}\n        >\n          {currentQuestion.type === 'choice' ? (\n            <div className=\"space-y-4\">\n              <div\n                className=\"grid gap-3\"\n                style={{\n                  gridTemplateColumns: `repeat(${Math.max(shuffledChoices.length || 1, 1)}, minmax(0, 1fr))`,\n                }}\n              >\n                {shuffledChoices.map((choice, index) => {\n                  const isSelected = selectedAnswer === choice;\n                  const isCorrect = choice === currentQuestion.answer;\n\n                  return (\n                    <ChoiceButton\n                      key={index}\n                      choice={choice}\n                      isSelected={isSelected}\n                      isCorrect={isCorrect}\n                      isAnswered={isAnswered}\n                      onClick={() => !isAnswered && setSelectedAnswer(choice)}\n                    />\n                  );\n                })}\n              </div>\n              {!isAnswered && (\n                <Button\n                  onClick={() => selectedAnswer && handleAnswer(selectedAnswer)}\n                  variant=\"primary\"\n                  size=\"lg\"\n                  className=\"w-full\"\n                  disabled={!selectedAnswer}\n                >\n                  X√°c nh·∫≠n\n                </Button>\n              )}\n            </div>\n          ) : (\n            <InputAnswer\n              value={selectedAnswer}\n              onChange={setSelectedAnswer}\n              onConfirm={() => handleAnswer(selectedAnswer)}\n              isAnswered={isAnswered}\n              isCorrect={isInputCorrect}\n              correctAnswer={currentQuestion.answer}\n            />\n          )}\n\n          {/* N√∫t C√¢u ti·∫øp theo / Xem k·∫øt qu·∫£ khi kh√¥ng autoNext (√°p d·ª•ng cho c·∫£ tr·∫Øc nghi·ªám & t·ª± ƒëi·ªÅn) */}\n          {isAnswered &&\n            !quizSettings?.autoNext && (\n              <Button\n                onClick={() => {\n                  if (isLastQuestion) {\n                    // C√¢u cu·ªëi c√πng: chuy·ªÉn sang m√†n h√¨nh k·∫øt qu·∫£\n                    finishQuiz();\n                  } else {\n                    // chuy·ªÉn c√¢u th·ªß c√¥ng\n                    answeredRef.current = false;\n                    setSelectedAnswer('');\n                    setIsAnswered(false);\n                    setTimeRemaining(quizSettings?.timeLimit || 0);\n                    setCurrentQuestionIndex((prev) => prev + 1);\n                  }\n                }}\n                variant=\"outline\"\n                size=\"lg\"\n                className=\"w-full mt-2\"\n              >\n                {isLastQuestion ? 'Xem k·∫øt qu·∫£ üéØ' : 'C√¢u ti·∫øp theo ‚Üí'}\n              </Button>\n            )}\n        </QuestionCard>\n      </AnimatePresence>\n    </ScreenContainer>\n  );\n};\n\n"],"names":["ProgressBar","value","max","className","showLabel","color","props","percentage","colors","jsxs","cn","jsx","motion","QuizHeader","currentIndex","totalQuestions","timeRemaining","timeLimit","progress","formatTime","extractFileId","url","trimmedUrl","match","convertGoogleDriveUrl","fileId","directUrl","getGoogleDriveThumbnailUrl","size","QuestionCard","question","questionNumber","imageUrl","hint","explanation","showExplanation","children","imageError","setImageError","useState","currentImageUrl","setCurrentImageUrl","attemptedFormats","setAttemptedFormats","useEffect","converted","e","originalUrl","patterns","pattern","nextFormat","f","prev","ChoiceButton","choice","isSelected","isCorrect","isAnswered","onClick","showResult","buttonClass","InputAnswer","onChange","onConfirm","correctAnswer","disabled","Button","QuizScreen","goToNext","useFlowStore","currentLesson","questionCount","quizSettings","setQuizResult","setQuestionCount","setQuizSettings","useQuizStore","currentQuestionIndex","setCurrentQuestionIndex","selectedAnswer","setSelectedAnswer","userAnswers","setUserAnswers","setTimeRemaining","setIsAnswered","timerRef","useRef","answeredRef","defaultCount","questions","shuffledQuestions","useMemo","shuffled","shuffleArray","count","result","currentQuestion","shuffledChoices","handleAnswer","answer","normalizedUserAnswer","normalizedCorrectAnswer","soundService","answerData","finishQuiz","correctAnswers","a","answers","score","calculateScore","ScreenContainer","isInputCorrect","isLastQuestion","AnimatePresence","index"],"mappings":"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"}