const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/IntroScreen-JwBIY1JQ.js","assets/animation-vendor-B6fZrcjP.js","assets/react-vendor-labSKdyf.js","assets/Button-Bl6cuHxx.js","assets/ui-vendor-B8QmJS74.js","assets/SelectPlayerScreen-D9L2P5Us.js","assets/Input-gL6nqdJo.js","assets/Card-BK5bYxKM.js","assets/playerStore-r_j1nxA9.js","assets/Header-DyyfoM7s.js","assets/ScreenContainer-21a-fcYA.js","assets/HomeScreen-BRY1YI-v.js","assets/badgeService-DtuNOCm4.js","assets/userService-B-l4Ujv9.js","assets/LevelSelectScreen-CbpUwiNW.js","assets/levelStore-XI9ZHSFN.js","assets/level-DpoHUSSg.js","assets/levelService-DPZIrGbv.js","assets/numberFormat-tpWeNAYq.js","assets/SubjectCard-D_FbafxL.js","assets/BackButton-BDaTWkU4.js","assets/SubjectSelectScreen-Chn3aMFv.js","assets/QuizTypeSelectScreen-Df9Oabs9.js","assets/QuizFilterScreen-xZ5DHtIR.js","assets/OptionButton-CxVbMwJ3.js","assets/QuizListScreen-Mz3b84_c.js","assets/quizStore-Chk_mg7S.js","assets/QuizGroupSelectScreen-DSi2PIx0.js","assets/quiz-BdS3L3uB.js","assets/ImportQuizScreen-CIxAvpo7.js","assets/googleSheetService-mjZez5jn.js","assets/LessonSelectScreen-B0pF4EGU.js","assets/LessonDetailScreen-DzRDUosD.js","assets/QuestionCountScreen-BACXtMgL.js","assets/QuizSettingsScreen-C0GGZYsH.js","assets/InfoRow-0klGmtIO.js","assets/QuizSharePreviewScreen-BX85VTPX.js","assets/QuizScreen-BiN_Qmqo.js","assets/scoringService-jD34FX5V.js","assets/ResultScreen-Bh3KmYwc.js","assets/RewardScreen-guOiiOlp.js","assets/SettingsScreen-Cb8zJH19.js"])))=>i.map(i=>d[i]);
import{r as de,a as pe,g as ye}from"./react-vendor-labSKdyf.js";import{r as l,R as te,A as me}from"./animation-vendor-B6fZrcjP.js";import{c as fe}from"./ui-vendor-B8QmJS74.js";(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))o(i);new MutationObserver(i=>{for(const s of i)if(s.type==="childList")for(const n of s.addedNodes)n.tagName==="LINK"&&n.rel==="modulepreload"&&o(n)}).observe(document,{childList:!0,subtree:!0});function r(i){const s={};return i.integrity&&(s.integrity=i.integrity),i.referrerPolicy&&(s.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?s.credentials="include":i.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function o(i){if(i.ep)return;i.ep=!0;const s=r(i);fetch(i.href,s)}})();var L={exports:{}},_={};var W;function he(){if(W)return _;W=1;var e=de(),t=Symbol.for("react.element"),r=Symbol.for("react.fragment"),o=Object.prototype.hasOwnProperty,i=e.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,s={key:!0,ref:!0,__self:!0,__source:!0};function n(u,c,a){var d,m={},h=null,x=null;a!==void 0&&(h=""+a),c.key!==void 0&&(h=""+c.key),c.ref!==void 0&&(x=c.ref);for(d in c)o.call(c,d)&&!s.hasOwnProperty(d)&&(m[d]=c[d]);if(u&&u.defaultProps)for(d in c=u.defaultProps,c)m[d]===void 0&&(m[d]=c[d]);return{$$typeof:t,type:u,key:h,ref:x,props:m,_owner:i.current}}return _.Fragment=r,_.jsx=n,_.jsxs=n,_}var J;function Se(){return J||(J=1,L.exports=he()),L.exports}var y=Se(),E={},H;function ge(){if(H)return E;H=1;var e=pe();return E.createRoot=e.createRoot,E.hydrateRoot=e.hydrateRoot,E}var ze=ge();const Ie=ye(ze),we="modulepreload",_e=function(e){return"/eduquiz-kid-site/"+e},G={},p=function(t,r,o){let i=Promise.resolve();if(r&&r.length>0){let c=function(a){return Promise.all(a.map(d=>Promise.resolve(d).then(m=>({status:"fulfilled",value:m}),m=>({status:"rejected",reason:m}))))};document.getElementsByTagName("link");const n=document.querySelector("meta[property=csp-nonce]"),u=n?.nonce||n?.getAttribute("nonce");i=c(r.map(a=>{if(a=_e(a),a in G)return;G[a]=!0;const d=a.endsWith(".css"),m=d?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${a}"]${m}`))return;const h=document.createElement("link");if(h.rel=d?"stylesheet":we,d||(h.as="script"),h.crossOrigin="",h.href=a,u&&h.setAttribute("nonce",u),document.head.appendChild(h),d)return new Promise((x,le)=>{h.addEventListener("load",x),h.addEventListener("error",()=>le(new Error(`Unable to preload CSS for ${a}`)))})}))}function s(n){const u=new Event("vite:preloadError",{cancelable:!0});if(u.payload=n,window.dispatchEvent(u),!u.defaultPrevented)throw n}return i.then(n=>{for(const u of n||[])u.status==="rejected"&&s(u.reason);return t().catch(s)})};let g=null,f=null,S=[];const be=async e=>{try{return g=e,e&&e.length>0&&(f=e[0].id),{success:!0,currentScreen:f}}catch(t){return console.error("Error initializing flow:",t),{success:!1,error:t.message}}},O=()=>!g||!f?null:g.find(e=>e.id===f),ve=(e=null)=>{if(!g||!f)return null;const t=O();if(!t)return null;let r=e;r||(Array.isArray(t.next)?r=t.next[0]:r=t.next);const o=g.find(i=>i.id===r);return o?(f&&r!=="quiz"&&S.push(f),r==="quiz"&&(S=S.filter(i=>i!=="quiz")),f=o.id,o):null},Te=e=>{if(!g)return null;const t=g.find(r=>r.id===e);return t?(f&&f!==e&&e!=="quiz"&&S.push(f),e==="quiz"&&(S=S.filter(r=>r!=="quiz")),f=t.id,t):null},xe=()=>{if(!g||S.length===0)return null;let e=null;for(;S.length>0;){const r=S.pop();if(r!=="quiz"){e=r;break}}if(!e){const r=g.find(o=>o.id==="home");return r?(f=r.id,r):null}const t=g.find(r=>r.id===e);return t?(f=t.id,t):null},Ee=()=>S.length===0?null:S[S.length-1],Ae=()=>g,je=[{id:"intro",component:"IntroScreen",next:"selectPlayer"},{id:"selectPlayer",component:"SelectPlayerScreen",next:"home"},{id:"home",component:"HomeScreen",next:["levelSelect","quizFilter","stats","settings"]},{id:"levelSelect",component:"LevelSelectScreen",next:"subjectSelect"},{id:"subjectSelect",component:"SubjectSelectScreen",next:"quizTypeSelect"},{id:"quizTypeSelect",component:"QuizTypeSelectScreen",next:"quizList"},{id:"quizFilter",component:"QuizFilterScreen",next:"quizList"},{id:"quizGroupSelect",component:"QuizGroupSelectScreen",next:"subjectSelect"},{id:"quizList",component:"QuizListScreen",next:"questionCount"},{id:"quizSharePreview",component:"QuizSharePreviewScreen",next:"questionCount"},{id:"questionCount",component:"QuestionCountScreen",next:"quizSettings"},{id:"quizSettings",component:"QuizSettingsScreen",next:"quiz"},{id:"quiz",component:"QuizScreen",next:"result"},{id:"result",component:"ResultScreen",next:"reward"},{id:"reward",component:"RewardScreen",next:"home"},{id:"settings",component:"SettingsScreen",next:"home"},{id:"importQuiz",component:"ImportQuizScreen",next:"home"},{id:"lessonSelect",component:"LessonSelectScreen",next:"questionCount"}];be(je);const K=fe((e,t)=>({currentScreen:O(),flowConfig:Ae(),goToNext:(r=null)=>{const o=ve(r);return e({currentScreen:o}),o},goToScreen:r=>{const o=Te(r);return e({currentScreen:o}),o},goBack:()=>{const r=xe();return e({currentScreen:r}),r},getCurrentScreen:()=>O(),getPreviousScreenId:()=>Ee()})),Ce=(e,t)=>t.some(r=>e instanceof r);let Z,Y;function Pe(){return Z||(Z=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function Le(){return Y||(Y=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const re=new WeakMap,k=new WeakMap,ne=new WeakMap,R=new WeakMap,M=new WeakMap;function Re(e){const t=new Promise((r,o)=>{const i=()=>{e.removeEventListener("success",s),e.removeEventListener("error",n)},s=()=>{r(I(e.result)),i()},n=()=>{o(e.error),i()};e.addEventListener("success",s),e.addEventListener("error",n)});return t.then(r=>{r instanceof IDBCursor&&re.set(r,e)}).catch(()=>{}),M.set(t,e),t}function Qe(e){if(k.has(e))return;const t=new Promise((r,o)=>{const i=()=>{e.removeEventListener("complete",s),e.removeEventListener("error",n),e.removeEventListener("abort",n)},s=()=>{r(),i()},n=()=>{o(e.error||new DOMException("AbortError","AbortError")),i()};e.addEventListener("complete",s),e.addEventListener("error",n),e.addEventListener("abort",n)});k.set(e,t)}let B={get(e,t,r){if(e instanceof IDBTransaction){if(t==="done")return k.get(e);if(t==="objectStoreNames")return e.objectStoreNames||ne.get(e);if(t==="store")return r.objectStoreNames[1]?void 0:r.objectStore(r.objectStoreNames[0])}return I(e[t])},set(e,t,r){return e[t]=r,!0},has(e,t){return e instanceof IDBTransaction&&(t==="done"||t==="store")?!0:t in e}};function qe(e){B=e(B)}function De(e){return e===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype)?function(t,...r){const o=e.call(Q(this),t,...r);return ne.set(o,t.sort?t.sort():[t]),I(o)}:Le().includes(e)?function(...t){return e.apply(Q(this),t),I(re.get(this))}:function(...t){return I(e.apply(Q(this),t))}}function Oe(e){return typeof e=="function"?De(e):(e instanceof IDBTransaction&&Qe(e),Ce(e,Pe())?new Proxy(e,B):e)}function I(e){if(e instanceof IDBRequest)return Re(e);if(R.has(e))return R.get(e);const t=Oe(e);return t!==e&&(R.set(e,t),M.set(t,e)),t}const Q=e=>M.get(e);function ke(e,t,{blocked:r,upgrade:o,blocking:i,terminated:s}={}){const n=indexedDB.open(e,t),u=I(n);return o&&n.addEventListener("upgradeneeded",c=>{o(I(n.result),c.oldVersion,c.newVersion,I(n.transaction),c)}),r&&n.addEventListener("blocked",c=>r(c.oldVersion,c.newVersion,c)),u.then(c=>{s&&c.addEventListener("close",()=>s()),i&&c.addEventListener("versionchange",a=>i(a.oldVersion,a.newVersion,a))}).catch(()=>{}),u}const Be=["get","getKey","getAll","getAllKeys","count"],Ve=["put","add","delete","clear"],q=new Map;function X(e,t){if(!(e instanceof IDBDatabase&&!(t in e)&&typeof t=="string"))return;if(q.get(t))return q.get(t);const r=t.replace(/FromIndex$/,""),o=t!==r,i=Ve.includes(r);if(!(r in(o?IDBIndex:IDBObjectStore).prototype)||!(i||Be.includes(r)))return;const s=async function(n,...u){const c=this.transaction(n,i?"readwrite":"readonly");let a=c.store;return o&&(a=a.index(u.shift())),(await Promise.all([a[r](...u),i&&c.done]))[0]};return q.set(t,s),s}qe(e=>({...e,get:(t,r,o)=>X(t,r)||e.get(t,r,o),has:(t,r)=>!!X(t,r)||e.has(t,r)}));const Me="EduQuizDB",Ne=3,j="quizzes",b="results",C="players",P="quizMetadata";let A=null;const z=async()=>{if(A)return A;try{return A=await ke(Me,Ne,{upgrade(e,t){if(!e.objectStoreNames.contains(j)){const r=e.createObjectStore(j,{keyPath:"id"});r.createIndex("group","group"),r.createIndex("subject","subject"),r.createIndex("levelId","levelId"),r.createIndex("subjectId","subjectId"),r.createIndex("quizType","quizType"),r.createIndex("levelSubject",["levelId","subjectId"]),r.createIndex("levelType",["levelId","quizType"]),r.createIndex("subjectType",["subjectId","quizType"]),r.createIndex("creatorId","creatorId"),r.createIndex("cachedAt","cachedAt")}if(!e.objectStoreNames.contains(P)){const r=e.createObjectStore(P,{keyPath:"id"});r.createIndex("group","group"),r.createIndex("subject","subject"),r.createIndex("levelId","levelId"),r.createIndex("subjectId","subjectId"),r.createIndex("quizType","quizType"),r.createIndex("levelSubject",["levelId","subjectId"]),r.createIndex("levelType",["levelId","quizType"]),r.createIndex("subjectType",["subjectId","quizType"]),r.createIndex("creatorId","creatorId"),r.createIndex("createdAt","createdAt"),r.createIndex("usageCount","usageCount")}if(!e.objectStoreNames.contains(b)){const r=e.createObjectStore(b,{keyPath:"id",autoIncrement:!0});r.createIndex("playerId","playerId"),r.createIndex("quizId","quizId"),r.createIndex("timestamp","timestamp")}e.objectStoreNames.contains(C)||e.createObjectStore(C,{keyPath:"id"}),t<2}}),A}catch(e){throw console.error("Error initializing IndexedDB:",e),e}},Ue=async e=>{try{const t=await z(),r=e.timestamp||Date.now(),o={...e,timestamp:r};return await t.add(b,o)}catch(t){throw console.error("Error saving quiz result:",t),t}},Fe=async e=>{try{return(await(await z()).transaction(b).store.index("playerId").getAll(e)).sort((i,s)=>s.timestamp-i.timestamp)}catch(t){return console.error("Error getting player results:",t),[]}},$e=async()=>{try{const r=await(await z()).transaction(b).store.getAll();return Array.isArray(r)?r:[]}catch(e){return console.error("Error getting all quiz results:",e),[]}},We=async e=>{try{await(await z()).put(C,e)}catch(t){throw console.error("Error saving player:",t),t}},Je=async()=>{try{return await(await z()).getAll(C)}catch(e){return console.error("Error getting players:",e),[]}},N=async e=>{try{const t=await z();await t.put(j,{...e,cachedAt:e.cachedAt||Date.now()});const{questions:r,cachedAt:o,...i}=e;await t.put(P,{...i,cachedAt:o||Date.now()})}catch(t){throw console.error("Error caching quiz:",t),t}},He=async e=>{try{return await(await z()).get(j,e)||null}catch(t){return console.error("Error getting cached quiz:",t),null}},Ge=async(e={})=>{try{const r=(await z()).transaction(P).store;let o=[];e.levelId&&e.subjectId&&e.quizType?o=(await r.getAll()).filter(n=>n.levelId===e.levelId&&n.subjectId===e.subjectId&&(n.quizType||n.group)===e.quizType):e.levelId&&e.subjectId?o=(await r.getAll()).filter(n=>n.levelId===e.levelId&&n.subjectId===e.subjectId):e.levelId&&e.quizType?o=(await r.getAll()).filter(n=>n.levelId===e.levelId&&(n.quizType||n.group)===e.quizType):e.subjectId&&e.quizType?o=(await r.getAll()).filter(n=>n.subjectId===e.subjectId&&(n.quizType||n.group)===e.quizType):e.levelId?o=(await r.getAll()).filter(n=>n.levelId===e.levelId):e.subjectId?o=(await r.getAll()).filter(n=>n.subjectId===e.subjectId):e.quizType?o=(await r.getAll()).filter(n=>(n.quizType||n.group)===e.quizType):e.group&&e.subject?o=(await r.getAll()).filter(n=>(n.group||n.quizType)===e.group&&(n.subject||n.subjectId)===e.subject):e.group?o=(await r.getAll()).filter(n=>(n.group||n.quizType)===e.group):e.creatorId?o=await r.index("creatorId").getAll(e.creatorId):o=await r.getAll();const i=e.sortBy||"createdAt";return i==="usage"?o.sort((s,n)=>(n.usageCount||0)-(s.usageCount||0)):i==="rating"?o.sort((s,n)=>(n.rating||0)-(s.rating||0)):o.sort((s,n)=>(n.createdAt||0)-(s.createdAt||0)),o}catch(t){return console.error("Error getting all cached quizzes:",t),[]}},vt=Object.freeze(Object.defineProperty({__proto__:null,cacheQuiz:N,getAllCachedQuizzes:Ge,getAllPlayers:Je,getAllQuizResults:$e,getCachedQuiz:He,getPlayerResults:Fe,initDB:z,savePlayer:We,saveQuizResult:Ue},Symbol.toStringTag,{value:"Module"}));class Ke{constructor(){this.audioContext=null,this.sounds={},this.enabled=!0,this.volume=.7}init(){try{if(this.audioContext=new(window.AudioContext||window.webkitAudioContext),this.audioContext.state==="suspended"){const t=()=>{this.audioContext.resume().catch(()=>{})};document.addEventListener("click",t,{once:!0}),document.addEventListener("touchstart",t,{once:!0})}}catch(t){console.warn("Web Audio API not supported:",t)}}playTone(t,r=200,o="sine"){if(!(!this.enabled||!this.audioContext)){this.audioContext.state==="suspended"&&this.audioContext.resume().catch(()=>{});try{const i=this.audioContext.createOscillator(),s=this.audioContext.createGain();i.connect(s),s.connect(this.audioContext.destination),i.frequency.value=t,i.type=o,s.gain.setValueAtTime(0,this.audioContext.currentTime),s.gain.linearRampToValueAtTime(this.volume,this.audioContext.currentTime+.01),s.gain.exponentialRampToValueAtTime(.01,this.audioContext.currentTime+r/1e3),i.start(this.audioContext.currentTime),i.stop(this.audioContext.currentTime+r/1e3)}catch(i){console.warn("Error playing tone:",i)}}}playCorrect(){this.playTone(523.25,100,"sine"),setTimeout(()=>this.playTone(659.25,100,"sine"),100),setTimeout(()=>this.playTone(783.99,150,"sine"),200)}playIncorrect(){this.playTone(200,300,"sawtooth")}playComplete(){this.playTone(523.25,150,"sine"),setTimeout(()=>this.playTone(659.25,150,"sine"),150),setTimeout(()=>this.playTone(783.99,150,"sine"),300),setTimeout(()=>this.playTone(1046.5,300,"sine"),450)}playClick(){this.playTone(800,50,"square")}playBadge(){this.playTone(659.25,100,"sine"),setTimeout(()=>this.playTone(783.99,100,"sine"),100),setTimeout(()=>this.playTone(987.77,200,"sine"),200)}playError(){this.playTone(150,400,"sawtooth")}playSuccess(){this.playTone(523.25,100,"sine"),setTimeout(()=>this.playTone(659.25,100,"sine"),100),setTimeout(()=>this.playTone(783.99,200,"sine"),200)}setEnabled(t){this.enabled=t}setVolume(t){this.volume=Math.max(0,Math.min(1,t))}}const oe=new Ke;typeof window<"u"&&oe.init();const Ze="https://eduquiz-api.eduquiz-api.workers.dev",U="https://eduquiz-api.eduquiz-api.workers.dev".trim()||Ze,T=()=>U.trim()!=="",D=async(e,t={})=>{if(!T())throw new Error("Cloudflare API URL ch∆∞a ƒë∆∞·ª£c c·∫•u h√¨nh. Vui l√≤ng th√™m VITE_CLOUDFLARE_API_URL v√†o .env");try{const r=await fetch(`${U}${e}`,{...t,headers:{"Content-Type":"application/json",...t.headers}});if(!r.ok){const o=await r.json().catch(()=>({error:r.statusText}));throw new Error(o.error||`HTTP ${r.status}: ${r.statusText}`)}return await r.json()}catch(r){throw console.error(`API Error (${e}):`,r),r}},w={async getQuizzes(e={}){const t=new URLSearchParams;return e.levelId&&t.append("levelId",e.levelId),e.subjectId&&t.append("subjectId",e.subjectId),e.quizType&&t.append("quizType",e.quizType),e.creatorId&&t.append("creatorId",e.creatorId),e.sortBy&&t.append("sortBy",e.sortBy),e.group&&t.append("group",e.group),e.subject&&t.append("subject",e.subject),D(`/api/quizzes?${t.toString()}`)},async getQuiz(e){return D(`/api/quizzes/${e}`)},async createQuiz(e){return D("/api/quizzes",{method:"POST",body:JSON.stringify(e)})}},se=async()=>{try{return(await fetch(`${U}/api/quizzes?limit=1`)).ok}catch(e){return console.error("Connection test failed:",e),!1}},Tt=Object.freeze(Object.defineProperty({__proto__:null,cloudQuizzes:w,isCloudAvailable:T,testConnection:se},Symbol.toStringTag,{value:"Module"})),Ye=e=>{if(e){if(Array.isArray(e))return e;try{const t=JSON.parse(e);return Array.isArray(t)?t:void 0}catch{return}}},v=(e={})=>({id:e.id,title:e.title||"",description:e.description||"",levelId:e.level_id||e.levelId||e.level||"",subjectId:e.subject_id||e.subjectId||e.subject||"",quizType:e.quiz_type||e.quizType||e.group||"",source:e.source_type||e.source||"database",sourceUrl:e.source_url||e.sourceUrl||"",questionCount:e.question_count||e.questionCount||0,creatorId:e.creator_id||e.creatorId||null,creatorName:e.creator_name||e.creatorName||"",createdAt:e.created_at||e.createdAt||Date.now(),updatedAt:e.updated_at||e.updatedAt||Date.now(),usageCount:e.usage_count||e.usageCount||0,rating:e.rating||0,ratingCount:e.rating_count||e.ratingCount||0,difficulty:e.difficulty||"medium",estimatedTime:e.estimated_time||e.estimatedTime||0,isPublic:!!(e.is_public||e.isPublic),isVerified:!!(e.is_verified||e.isVerified),tags:typeof e.tags=="string"?JSON.parse(e.tags||"[]"):e.tags||[]}),F=(e=[],t)=>e.map((r,o)=>({id:r.id||`${t}_q${o+1}`,question:r.question_text||r.question||"",type:(r.question_type||r.type||"choice").toLowerCase(),choices:Ye(r.choices),answer:r.answer||"",hint:r.hint||"",points:r.points||10,explanation:r.explanation||r.explain||"",imageUrl:r.image_url||r.imageUrl||"",order:r.question_order||r.order||o+1})),$=async(e={})=>{if(!T())return console.warn("Cloud service kh√¥ng kh·∫£ d·ª•ng, b·ªè qua sync"),0;try{const t=await w.getQuizzes({...e,quizType:"official"}),r=Array.isArray(t)?t:t?.results||[];let o=0;for(const i of r)try{const s=v(i),n=await w.getQuiz(s.id);if(n){const u=F(Array.isArray(n.questions)?n.questions:n.questions?.results||[],s.id),c={...s,...v(n),questions:u,cachedAt:Date.now()};c.id=c.id||s.id||n.id||i.id,c.levelId=c.levelId||s.levelId,c.subjectId=c.subjectId||s.subjectId,c.quizType=c.quizType||s.quizType||"official",await N(c),o++}}catch(s){console.error(`Error syncing quiz ${i.id}:`,s)}return console.log(`‚úÖ Synced ${o} official quizzes`),o}catch(t){throw console.error("Error syncing official quizzes:",t),t}},ie=async(e={})=>{if(!T())return console.warn("Cloud service kh√¥ng kh·∫£ d·ª•ng, b·ªè qua sync community"),0;try{const t=await w.getQuizzes({...e,quizType:"community"}),r=Array.isArray(t)?t:t?.results||[];let o=0;for(const i of r)try{const s=v(i),n=await w.getQuiz(s.id);if(n){const u=F(Array.isArray(n.questions)?n.questions:n.questions?.results||[],s.id),c={...s,...v(n),questions:u,cachedAt:Date.now()};c.id=c.id||s.id||n.id||i.id,c.levelId=c.levelId||s.levelId,c.subjectId=c.subjectId||s.subjectId,c.quizType=c.quizType||s.quizType||"community",await N(c),o++}}catch(s){console.error(`Error syncing community quiz ${i.id}:`,s)}return console.log(`‚úÖ Synced ${o} community quizzes`),o}catch(t){throw console.error("Error syncing community quizzes:",t),t}},ce=async()=>{const e=await $(),t=await ie();return e+t},ae=async()=>{const e={cloudAvailable:T(),connected:!1,lastSync:null,pendingSync:0};if(e.cloudAvailable)try{e.connected=await se()}catch(t){console.error("Error checking connection:",t)}return e},xt=Object.freeze(Object.defineProperty({__proto__:null,getSyncStatus:ae,syncAllPublicQuizzes:ce,syncCommunityQuizzes:ie,syncOfficialQuizzes:$,transformQuizMetadata:v,transformQuizQuestions:F},Symbol.toStringTag,{value:"Module"})),V=(e,t=null)=>`${t||(typeof window<"u"?window.location.origin:"")}/?quiz=${encodeURIComponent(e)}`,Xe=(e=null)=>{if(typeof window>"u")return null;try{const t=e||window.location.href,o=new URL(t).searchParams.get("quiz");return o?decodeURIComponent(o):null}catch(t){return console.error("Failed to extract quizId from URL:",t),null}},Et=async e=>{try{const t=V(e);return await navigator.clipboard.writeText(t),!0}catch(t){console.error("Failed to copy share link:",t);try{const r=V(e),o=document.createElement("textarea");return o.value=r,o.style.position="fixed",o.style.opacity="0",document.body.appendChild(o),o.select(),document.execCommand("copy"),document.body.removeChild(o),!0}catch(r){return console.error("Fallback copy also failed:",r),!1}}},At=async(e,t="")=>{if(typeof navigator>"u"||!navigator.share)return!1;try{const r=V(e);return await navigator.share({title:t||"B√†i test EduQuiz",text:`H√£y th·ª≠ l√†m b√†i test n√†y: ${t||"B√†i test th√∫ v·ªã"}`,url:r}),!0}catch(r){return r.name!=="AbortError"&&console.error("Web Share API failed:",r),!1}},et=async()=>{console.log("üîç Testing cloud connection...");try{const e=await ae();if(console.log("üìä Sync Status:",e),!e.cloudAvailable){console.warn("‚ö†Ô∏è Cloud service ch∆∞a ƒë∆∞·ª£c c·∫•u h√¨nh"),console.log("üí° Th√™m VITE_CLOUDFLARE_API_URL v√†o .env");return}if(!e.connected){console.error("‚ùå Kh√¥ng th·ªÉ k·∫øt n·ªëi ƒë·∫øn cloud service");return}console.log("‚úÖ Connection successful!"),console.log("üì• Testing get quizzes...");const t=await w.getQuizzes({limit:5});return console.log(`‚úÖ Loaded ${t.length} quizzes:`,t),{success:!0,quizzes:t}}catch(e){return console.error("‚ùå Test failed:",e),{success:!1,error:e.message}}},tt=async()=>{console.log("üîÑ Testing sync...");try{const e=await $();return console.log(`‚úÖ Synced ${e} quizzes`),{success:!0,count:e}}catch(e){return console.error("‚ùå Sync failed:",e),{success:!1,error:e.message}}};typeof window<"u"&&(window.testCloud=et,window.testSync=tt,console.log("üí° Ch·∫°y testCloud() ho·∫∑c testSync() trong console ƒë·ªÉ test"));const rt=l.lazy(()=>p(()=>import("./IntroScreen-JwBIY1JQ.js"),__vite__mapDeps([0,1,2,3,4])).then(e=>({default:e.IntroScreen}))),nt=l.lazy(()=>p(()=>import("./SelectPlayerScreen-D9L2P5Us.js"),__vite__mapDeps([5,1,2,3,6,7,8,4,9,10])).then(e=>({default:e.SelectPlayerScreen}))),ot=l.lazy(()=>p(()=>import("./HomeScreen-BRY1YI-v.js"),__vite__mapDeps([11,1,2,8,4,12,7,3,13,9,10])).then(e=>({default:e.HomeScreen}))),st=l.lazy(()=>p(()=>import("./LevelSelectScreen-CbpUwiNW.js"),__vite__mapDeps([14,1,2,15,4,16,17,18,9,3,10,19,7,20])).then(e=>({default:e.LevelSelectScreen}))),it=l.lazy(()=>p(()=>import("./SubjectSelectScreen-Chn3aMFv.js"),__vite__mapDeps([21,1,2,15,4,16,17,18,9,3,10,19,7,20])).then(e=>({default:e.SubjectSelectScreen}))),ct=l.lazy(()=>p(()=>import("./QuizTypeSelectScreen-Df9Oabs9.js"),__vite__mapDeps([22,1,2,15,4,16,8,18,9,3,10,19,7,20])).then(e=>({default:e.QuizTypeSelectScreen}))),at=l.lazy(()=>p(()=>import("./QuizFilterScreen-xZ5DHtIR.js"),__vite__mapDeps([23,1,2,15,4,16,17,7,3,9,10,20,24])).then(e=>({default:e.QuizFilterScreen}))),ut=l.lazy(()=>p(()=>import("./QuizListScreen-Mz3b84_c.js"),__vite__mapDeps([25,1,2,15,4,16,8,26,17,7,3,6,9,10,20,24])).then(e=>({default:e.QuizListScreen}))),lt=l.lazy(()=>p(()=>import("./QuizGroupSelectScreen-DSi2PIx0.js"),__vite__mapDeps([27,1,2,4,28,9,3,10,19,7,20])).then(e=>({default:e.QuizGroupSelectScreen}))),dt=l.lazy(()=>p(()=>import("./ImportQuizScreen-CIxAvpo7.js"),__vite__mapDeps([29,1,2,8,4,15,16,28,30,17,13,7,3,6,9,10,20,24])).then(e=>({default:e.ImportQuizScreen}))),pt=l.lazy(()=>p(()=>import("./LessonSelectScreen-B0pF4EGU.js"),__vite__mapDeps([31,1,2,26,4,30,3,9,10,19,7,20])).then(e=>({default:e.LessonSelectScreen}))),yt=l.lazy(()=>p(()=>import("./LessonDetailScreen-DzRDUosD.js"),__vite__mapDeps([32,1,2,3,7,26,4,10])).then(e=>({default:e.LessonDetailScreen}))),mt=l.lazy(()=>p(()=>import("./QuestionCountScreen-BACXtMgL.js"),__vite__mapDeps([33,1,2,3,7,26,4,9,10,24])).then(e=>({default:e.QuestionCountScreen}))),ft=l.lazy(()=>p(()=>import("./QuizSettingsScreen-C0GGZYsH.js"),__vite__mapDeps([34,1,2,3,7,26,4,9,10,35])).then(e=>({default:e.QuizSettingsScreen}))),ue=l.lazy(()=>p(()=>import("./QuizSharePreviewScreen-BX85VTPX.js"),__vite__mapDeps([36,1,2,3,7,26,4,17,16,9,10,35])).then(e=>({default:e.QuizSharePreviewScreen}))),ht=l.lazy(()=>p(()=>import("./QuizScreen-BiN_Qmqo.js"),__vite__mapDeps([37,1,2,3,26,4,38,10])).then(e=>({default:e.QuizScreen}))),St=l.lazy(()=>p(()=>import("./ResultScreen-Bh3KmYwc.js"),__vite__mapDeps([39,1,2,3,7,26,4,8,38,12,10])).then(e=>({default:e.ResultScreen}))),gt=l.lazy(()=>p(()=>import("./RewardScreen-guOiiOlp.js"),__vite__mapDeps([40,1,2,3,26,4])).then(e=>({default:e.RewardScreen}))),zt=l.lazy(()=>p(()=>import("./SettingsScreen-Cb8zJH19.js"),__vite__mapDeps([41,1,2,3,7,26,4,9,10,24])).then(e=>({default:e.SettingsScreen}))),ee={IntroScreen:rt,SelectPlayerScreen:nt,HomeScreen:ot,LevelSelectScreen:st,SubjectSelectScreen:it,QuizTypeSelectScreen:ct,QuizFilterScreen:at,QuizListScreen:ut,QuizGroupSelectScreen:lt,ImportQuizScreen:dt,LessonSelectScreen:pt,LessonDetailScreen:yt,QuestionCountScreen:mt,QuizSettingsScreen:ft,QuizSharePreviewScreen:ue,QuizScreen:ht,ResultScreen:St,RewardScreen:gt,SettingsScreen:zt};function It(){const{currentScreen:e,goBack:t,goToScreen:r}=K(),[o,i]=te.useState(null);l.useEffect(()=>{const c=Xe();if(c&&(i(c),r("quizSharePreview"),window.history.replaceState)){const a=window.location.pathname;window.history.replaceState({},"",a)}},[r]),l.useEffect(()=>{let c=!0;z().catch(console.error),oe.init();const a=()=>{ce().catch(m=>{console.error("Auto sync quizzes failed:",m)})};"requestIdleCallback"in window?requestIdleCallback(()=>{c&&a()},{timeout:2e3}):setTimeout(()=>{c&&a()},100);const d=()=>{document.visibilityState==="visible"&&c&&("requestIdleCallback"in window?requestIdleCallback(a,{timeout:1e3}):setTimeout(a,100))};return document.addEventListener("visibilitychange",d),()=>{c=!1,document.removeEventListener("visibilitychange",d)}},[]);const s=e?ee[e.component]:null,n=e?.id==="quizSharePreview"&&o;l.useEffect(()=>{e&&window.history.pushState({screen:e.id},"",window.location.href)},[e]),l.useEffect(()=>{const c=a=>{if(e?.id==="quiz"){a.preventDefault(),window.history.pushState({screen:"quiz"},"",window.location.href);return}if(!t()){const{goToScreen:m}=K.getState();m("home")}};return window.addEventListener("popstate",c),()=>{window.removeEventListener("popstate",c)}},[t,e]),l.useEffect(()=>{console.log("App currentScreen:",e),e&&(console.log("Current screen component:",e.component),console.log("Component exists:",!!ee[e.component]))},[e]);const u=()=>y.jsx("div",{className:"min-h-screen bg-gradient-to-br from-primary-100 to-secondary-100 flex items-center justify-center",children:y.jsxs("div",{className:"text-center",children:[y.jsx("div",{className:"text-6xl mb-4 animate-spin",children:"‚è≥"}),y.jsx("p",{className:"text-xl text-gray-600",children:"ƒêang t·∫£i..."}),e&&y.jsxs("p",{className:"text-sm text-gray-500 mt-2",children:["Screen: ",e.id," (",e.component,")"]})]})});return y.jsx("div",{className:"App min-h-screen",children:y.jsx(me,{mode:"wait",children:n?y.jsx(l.Suspense,{fallback:y.jsx(u,{}),children:y.jsx(ue,{quizId:o},"quizSharePreview")}):s?y.jsx(l.Suspense,{fallback:y.jsx(u,{}),children:y.jsx(s,{},e.id)}):y.jsx(u,{})})})}Ie.createRoot(document.getElementById("root")).render(y.jsx(te.StrictMode,{children:y.jsx(It,{})}));export{p as _,We as a,Fe as b,Ge as c,$e as d,w as e,N as f,Je as g,At as h,Et as i,y as j,V as k,He as l,Ue as m,vt as n,Tt as o,xt as p,oe as s,K as u};
//# sourceMappingURL=index--ILSzZaw.js.map
