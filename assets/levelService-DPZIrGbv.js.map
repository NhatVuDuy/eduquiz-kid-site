{"version":3,"mappings":";kIAYY,MAACA,EAAa,SAEjBC,EAAY,EAMRC,EAAuB,MAAOC,GAElCC,EAAoBD,CAAO,EAOvBE,EAAe,MAAOC,EAAU,KAAO,CAClD,GAAI,CAKF,IAAIC,EAHY,MAAMC,EAAmB,EAKzC,OAAIF,EAAQ,UACVC,EAAWA,EAAS,OAAOE,GAAKA,EAAE,UAAYH,EAAQ,OAAO,GAG3DA,EAAQ,YACVC,EAAWA,EAAS,OAAOE,GAAKA,EAAE,YAAcH,EAAQ,SAAS,GAG/DA,EAAQ,WACVC,EAAWA,EAAS,OAAOE,GAAKA,EAAE,WAAaH,EAAQ,QAAQ,GAG7DA,EAAQ,YACVC,EAAWA,EAAS,OAAOE,GAAKA,EAAE,YAAcH,EAAQ,SAAS,GAInEC,EAAS,KAAK,CAACG,EAAGC,IACZL,EAAQ,SAAW,SACbK,EAAE,YAAc,IAAMD,EAAE,YAAc,GAE5CJ,EAAQ,SAAW,UACbK,EAAE,QAAU,IAAMD,EAAE,QAAU,IAEhCC,EAAE,WAAa,IAAMD,EAAE,WAAa,EAC7C,EAEMH,CACT,OAASK,EAAO,CACd,eAAQ,MAAM,2BAA4BA,CAAK,EACxC,EACT,CACF,EAMaC,EAAe,MAAOC,GAAW,CAC5C,GAAI,CAEF,MAAMC,EAAa,MAAMC,EAAcF,CAAM,EAC7C,GAAIC,GAAcA,EAAW,WAAaA,EAAW,UAAU,OAAS,EAGtE,OAAOA,EAIT,GAAI,CACF,KAAM,CAAE,aAAAE,CAAY,EAAK,MAAKC,EAAA,6BAAAD,GAAA,KAAC,QAAO,qBAAgB,OAAAE,KAAA,uBAAAF,CAAA,iCAChDG,EAAY,MAAMH,EAAa,QAAQH,CAAM,EAEnD,GAAIM,EAAW,CAEb,KAAM,CAAE,sBAAAC,EAAuB,uBAAAC,GAA2B,MAAKJ,EAAA,sCAAAG,EAAA,uBAAAC,CAAA,OAAC,QAAO,qBAAe,OAAAH,KAAA,gCAAAE,EAAA,uBAAAC,CAAA,iCAChFC,EAAqBF,EAAsBD,CAAS,EAGpDI,EAAiB,MAAM,QAAQJ,EAAU,SAAS,EACpDA,EAAU,UACVA,EAAU,WAAW,SAAW,GAE9BK,EAAsBH,EAAuBE,EAAgBV,CAAM,EAEnEY,EAAiB,CACrB,GAAGH,EACH,UAAWE,EACX,SAAU,KAAK,IAAG,CAC5B,EAGc,CAAE,UAAAE,CAAS,EAAK,MAAKT,EAAA,0BAAAS,GAAA,KAAC,QAAO,qBAAkB,OAAAR,KAAA,oBAAAQ,CAAA,iCACrD,aAAMA,EAAUD,CAAc,EAEvBA,CACT,CACF,OAASE,EAAY,CACnB,QAAQ,KAAK,oDAAqDA,CAAU,CAC9E,CAEA,OAAO,IACT,OAAShB,EAAO,CACd,cAAQ,MAAM,2BAA4BA,CAAK,EACzCA,CACR,CACF,EAKaiB,EAAgB,MAAOC,EAASxB,EAAU,KAAO,CAC5D,GAAI,CACF,MAAMyB,EAAU,MAAM1B,EAAaC,CAAO,EAE1C,GAAI,CAACwB,GAAW,CAACA,EAAQ,KAAI,EAC3B,OAAOC,EAGT,MAAMC,EAAeF,EAAQ,YAAW,EACxC,OAAOC,EAAQ,OAAOE,GAElBA,EAAK,OAAO,cAAc,SAASD,CAAY,GAC/CC,EAAK,aAAa,cAAc,SAASD,CAAY,GACrDC,EAAK,aAAa,cAAc,SAASD,CAAY,GACpDC,EAAK,MAAQ,MAAM,QAAQA,EAAK,IAAI,GACpCA,EAAK,KAAK,KAAKC,GAAOA,EAAI,YAAW,EAAG,SAASF,CAAY,CAAC,CAElE,CACH,OAASpB,EAAO,CACd,eAAQ,MAAM,2BAA4BA,CAAK,EACxC,EACT,CACF","names":["loadLevels","getAllLevels","loadSubjectsForLevel","levelId","getSubjectsForLevel","loadQuizList","filters","filtered","getAllCachedQuizzes","q","a","b","error","loadQuizData","quizId","cachedQuiz","getCachedQuiz","cloudQuizzes","__vitePreload","n","cloudQuiz","transformQuizMetadata","transformQuizQuestions","normalizedMetadata","questionsArray","normalizedQuestions","normalizedQuiz","cacheQuiz","cloudError","searchQuizzes","keyword","quizzes","lowerKeyword","quiz","tag"],"ignoreList":[],"sources":["../../src/services/levelService.js"],"sourcesContent":["/**\n * Level Service\n * Service quản lý levels, subjects, và quizzes theo hierarchy mới\n */\n\nimport { getAllLevels, getLevelById, getSubjectsForLevel } from '../models/level.js';\nimport { QUIZ_TYPES } from '../models/level.js';\nimport { getAllCachedQuizzes, getCachedQuiz } from './storageService.js';\n\n/**\n * Load danh sách levels\n */\nexport const loadLevels = async () => {\n  // Có thể load từ cloud hoặc dùng local config\n  return getAllLevels();\n};\n\n/**\n * Load subjects cho một level\n */\nexport const loadSubjectsForLevel = async (levelId) => {\n  // Có thể load từ cloud hoặc dùng local config\n  return getSubjectsForLevel(levelId);\n};\n\n/**\n * Load quiz list với filters\n * @param {Object} filters - { levelId, subjectId, quizType, creatorId }\n */\nexport const loadQuizList = async (filters = {}) => {\n  try {\n    // Load từ IndexedDB local (đã cache)\n    const quizzes = await getAllCachedQuizzes();\n    \n    // Apply filters\n    let filtered = quizzes;\n    \n    if (filters.levelId) {\n      filtered = filtered.filter(q => q.levelId === filters.levelId);\n    }\n    \n    if (filters.subjectId) {\n      filtered = filtered.filter(q => q.subjectId === filters.subjectId);\n    }\n    \n    if (filters.quizType) {\n      filtered = filtered.filter(q => q.quizType === filters.quizType);\n    }\n    \n    if (filters.creatorId) {\n      filtered = filtered.filter(q => q.creatorId === filters.creatorId);\n    }\n    \n    // Sort by usage count (popularity) or created date\n    filtered.sort((a, b) => {\n      if (filters.sortBy === 'usage') {\n        return (b.usageCount || 0) - (a.usageCount || 0);\n      }\n      if (filters.sortBy === 'rating') {\n        return (b.rating || 0) - (a.rating || 0);\n      }\n      return (b.createdAt || 0) - (a.createdAt || 0);\n    });\n    \n    return filtered;\n  } catch (error) {\n    console.error('Error loading quiz list:', error);\n    return [];\n  }\n};\n\n/**\n * Load quiz với full data (bao gồm questions)\n * Thử load từ cache trước, nếu không có thì load từ cloud\n */\nexport const loadQuizData = async (quizId) => {\n  try {\n    // Thử load từ cache trước\n    const cachedQuiz = await getCachedQuiz(quizId);\n    if (cachedQuiz && cachedQuiz.questions && cachedQuiz.questions.length > 0) {\n      // Update usage count\n      // TODO: Update in cloud\n      return cachedQuiz;\n    }\n\n    // Nếu chưa có trong cache, load từ cloud\n    try {\n      const { cloudQuizzes } = await import('./cloudService');\n      const cloudQuiz = await cloudQuizzes.getQuiz(quizId);\n      \n      if (cloudQuiz) {\n        // Transform và cache quiz từ cloud\n        const { transformQuizMetadata, transformQuizQuestions } = await import('./syncService');\n        const normalizedMetadata = transformQuizMetadata(cloudQuiz);\n        \n        // Handle questions - có thể là array hoặc object với results\n        const questionsArray = Array.isArray(cloudQuiz.questions) \n          ? cloudQuiz.questions \n          : cloudQuiz.questions?.results || [];\n        \n        const normalizedQuestions = transformQuizQuestions(questionsArray, quizId);\n        \n        const normalizedQuiz = {\n          ...normalizedMetadata,\n          questions: normalizedQuestions,\n          cachedAt: Date.now(),\n        };\n\n        // Cache vào IndexedDB\n        const { cacheQuiz } = await import('./storageService');\n        await cacheQuiz(normalizedQuiz);\n\n        return normalizedQuiz;\n      }\n    } catch (cloudError) {\n      console.warn('Failed to load quiz from cloud, using cache only:', cloudError);\n    }\n\n    return null;\n  } catch (error) {\n    console.error('Error loading quiz data:', error);\n    throw error;\n  }\n};\n\n/**\n * Search quizzes với keyword\n */\nexport const searchQuizzes = async (keyword, filters = {}) => {\n  try {\n    const quizzes = await loadQuizList(filters);\n    \n    if (!keyword || !keyword.trim()) {\n      return quizzes;\n    }\n    \n    const lowerKeyword = keyword.toLowerCase();\n    return quizzes.filter(quiz => {\n      return (\n        quiz.title?.toLowerCase().includes(lowerKeyword) ||\n        quiz.description?.toLowerCase().includes(lowerKeyword) ||\n        quiz.creatorName?.toLowerCase().includes(lowerKeyword) ||\n        (quiz.tags && Array.isArray(quiz.tags) && \n         quiz.tags.some(tag => tag.toLowerCase().includes(lowerKeyword)))\n      );\n    });\n  } catch (error) {\n    console.error('Error searching quizzes:', error);\n    return [];\n  }\n};\n\n\n\n"],"file":"levelService-DPZIrGbv.js"}